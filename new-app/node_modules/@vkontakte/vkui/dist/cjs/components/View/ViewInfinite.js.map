{"version":3,"sources":["../../../../src/components/View/ViewInfinite.tsx"],"names":["warn","SwipeBackResults","scrollsCache","ViewInfiniteComponent","props","undefined","e","includes","animationName","state","prevPanel","flushTransition","Boolean","isBack","propertyName","target","pickPanel","swipeBackNextPanel","swipeBackResult","fail","onSwipeBackCancel","success","onSwipeBackSuccess","window","platform","configProvider","IOS","isWebView","startX","innerWidth","browserSwipe","setState","onSwipeBack","animated","swipingBack","history","length","activePanel","prevScrolls","scrolls","scroll","getScroll","y","swipebackStartX","swipeBackPrevPanel","slice","swipeBackShift","shiftX","speed","duration","visiblePanels","nextPanel","document","React","Children","toArray","children","id","prevProps","prevState","popout","blurActiveElement","modal","isBackCheck","from","to","firstLayerId","panels","map","panel","find","shouldDisableTransitionMotion","animationEvent","supported","animationFinishTimeout","clearTimeout","setTimeout","transitionEndHandler","ANDROID","VKCOM","scrollPosition","prevPanelScrolls","newPanelScrolls","pop","scrollTo","onTransition","onSwipeBackStart","waitTransitionFinish","swipingBackTransitionEndHandler","transitionMotionEnabled","splitCol","animate","elem","eventHandler","transitionEvent","name","removeEventListener","addEventListener","transitionFinishTimeout","activeElement","blur","panelNodes","panelId","canUseDOM","isPrev","isNext","prevPanelTranslate","nextPanelTranslate","prevPanelShadow","boxShadow","transform","WebkitTransform","_1","nav","restProps","hasPopout","hasModal","filter","sort","isPrevPanel","isNextPanel","disableAnimation","modifiers","onMoveX","onEnd","compensateScroll","isTransitionTarget","scrollList","el","calcPanelSwipeStyles","marginTop","Component","ViewInfinite","SplitColContext","ConfigProviderContext","ScrollContext"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { classNames } from \"../../lib/classNames\";\nimport { transitionEvent, animationEvent } from \"../../lib/supportEvents\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { IOS, ANDROID, VKCOM } from \"../../lib/platform\";\nimport { Touch, TouchEvent } from \"../Touch/Touch\";\nimport { HasPlatform } from \"../../types\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport { withContext } from \"../../hoc/withContext\";\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n} from \"../ConfigProvider/ConfigProviderContext\";\nimport { SplitColContext, SplitColContextProps } from \"../SplitCol/SplitCol\";\nimport { AppRootPortal } from \"../AppRoot/AppRootPortal\";\nimport { canUseDOM, withDOM, DOMProps } from \"../../lib/dom\";\nimport {\n  ScrollContext,\n  ScrollContextInterface,\n} from \"../AppRoot/ScrollContext\";\nimport { NavTransitionProvider } from \"../NavTransitionContext/NavTransitionContext\";\nimport { getNavId, NavIdProps } from \"../../lib/getNavId\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { swipeBackExcluded } from \"./utils\";\nimport \"./View.css\";\n\nconst warn = warnOnce(\"ViewInfinite\");\n\nenum SwipeBackResults {\n  fail = 1,\n  success,\n}\n\ninterface Scrolls {\n  [index: string]: Array<number | undefined>;\n}\n\ninterface ViewsScrolls {\n  [index: string]: Scrolls;\n}\n\ntype TransitionEventHandler = (e?: TransitionEvent) => void;\n\nlet scrollsCache: ViewsScrolls = {};\n\nexport type TransitionParams = { from: string | null; to: string | null };\n\nexport interface ViewInfiniteProps\n  extends React.HTMLAttributes<HTMLElement>,\n    HasPlatform,\n    NavIdProps {\n  activePanel: string;\n  popout?: React.ReactNode;\n  modal?: React.ReactNode;\n  onTransition?(params: TransitionParams & { isBack: boolean }): void;\n  /**\n   * callback свайпа назад\n   */\n  onSwipeBack?(): void;\n  /**\n   * callback начала анимации свайпа назад.\n   */\n  onSwipeBackStart?(): void;\n  /**\n   * callback завершения анимации отмененного пользователем свайпа\n   */\n  onSwipeBackCancel?(): void;\n  history?: string[];\n  isBackCheck?(params: TransitionParams): boolean;\n  /**\n   * @ignore\n   */\n  splitCol?: SplitColContextProps;\n  /**\n   * @ignore\n   */\n  configProvider?: ConfigProviderContextInterface;\n  /**\n   * @ignore\n   */\n  scroll?: ScrollContextInterface;\n}\n\nexport interface ViewInfiniteState {\n  animated: boolean;\n\n  visiblePanels: Array<string | null>;\n  activePanel: string | null;\n  isBack?: boolean;\n  prevPanel: string | null;\n  nextPanel: string | null;\n\n  swipingBack: boolean;\n  swipebackStartX: number;\n  swipeBackShift: number;\n  swipeBackNextPanel: string | null;\n  swipeBackPrevPanel: string | null;\n  swipeBackResult: SwipeBackResults | null;\n\n  browserSwipe: boolean;\n}\n\nclass ViewInfiniteComponent extends React.Component<\n  ViewInfiniteProps & DOMProps,\n  ViewInfiniteState\n> {\n  constructor(props: ViewInfiniteProps) {\n    super(props);\n\n    this.state = {\n      animated: false,\n\n      visiblePanels: [props.activePanel],\n      activePanel: props.activePanel,\n      isBack: undefined,\n      prevPanel: null,\n      nextPanel: null,\n\n      swipingBack: false,\n      swipebackStartX: 0,\n      swipeBackShift: 0,\n      swipeBackNextPanel: null,\n      swipeBackPrevPanel: null,\n      swipeBackResult: null,\n\n      browserSwipe: false,\n    };\n  }\n\n  static defaultProps: Partial<ViewInfiniteProps> = {\n    history: [],\n  };\n\n  private scrolls = scrollsCache[getNavId(this.props, warn) as string] || {};\n  private transitionFinishTimeout: number | undefined = undefined;\n  private animationFinishTimeout: number | undefined = undefined;\n\n  get document() {\n    return this.props.document;\n  }\n\n  get window() {\n    return this.props.window;\n  }\n\n  get panels() {\n    return React.Children.toArray(this.props.children) as React.ReactElement[];\n  }\n\n  panelNodes: { [id: string]: HTMLDivElement | null } = {};\n\n  componentWillUnmount() {\n    const id = getNavId(this.props);\n    if (id) {\n      scrollsCache[id] = this.scrolls;\n    }\n  }\n\n  componentDidUpdate(\n    prevProps: ViewInfiniteProps,\n    prevState: ViewInfiniteState\n  ) {\n    this.props.popout && !prevProps.popout && this.blurActiveElement();\n    this.props.modal && !prevProps.modal && this.blurActiveElement();\n\n    // Нужен переход\n    if (\n      prevProps.activePanel !== this.props.activePanel &&\n      !prevState.swipingBack &&\n      !prevState.browserSwipe\n    ) {\n      let isBack = false;\n\n      if (this.props.isBackCheck) {\n        isBack = this.props.isBackCheck({\n          from: prevProps.activePanel,\n          to: this.props.activePanel,\n        });\n      } else {\n        const firstLayerId = this.panels\n          .map((panel) => getNavId(panel.props, warn))\n          .find(\n            (id) =>\n              id === prevProps.activePanel || id === this.props.activePanel\n          );\n        isBack = firstLayerId === this.props.activePanel;\n      }\n\n      this.blurActiveElement();\n\n      const prevScrolls = this.scrolls[prevProps.activePanel] || [];\n      const scrolls = {\n        ...this.scrolls,\n        [prevProps.activePanel]: [\n          ...prevScrolls,\n          this.props.scroll?.getScroll().y,\n        ],\n      };\n      this.scrolls = scrolls;\n\n      if (this.shouldDisableTransitionMotion()) {\n        this.flushTransition(prevProps.activePanel, isBack);\n      } else {\n        this.setState({\n          visiblePanels: [prevProps.activePanel, this.props.activePanel],\n          prevPanel: prevProps.activePanel,\n          nextPanel: this.props.activePanel,\n          activePanel: null,\n          animated: true,\n          isBack,\n        });\n\n        // Фолбек анимации перехода\n        if (!animationEvent.supported) {\n          if (this.animationFinishTimeout) {\n            clearTimeout(this.animationFinishTimeout);\n          }\n          this.animationFinishTimeout = setTimeout(\n            this.transitionEndHandler,\n            this.props.platform === ANDROID || this.props.platform === VKCOM\n              ? 300\n              : 600\n          );\n        }\n      }\n    }\n\n    // Закончилась анимация свайпа назад\n    if (\n      prevProps.activePanel !== this.props.activePanel &&\n      prevState.swipingBack\n    ) {\n      const nextPanel = this.state.swipeBackNextPanel;\n      const prevPanel = this.state.swipeBackPrevPanel;\n      let scrollPosition: undefined | number = undefined;\n\n      this.scrolls = {\n        ...this.scrolls,\n      };\n\n      if (prevPanel !== null) {\n        const prevPanelScrolls = [...(this.scrolls[prevPanel] || [])].slice(\n          0,\n          -1\n        );\n        this.scrolls[prevPanel] = prevPanelScrolls;\n      }\n      if (nextPanel !== null) {\n        const newPanelScrolls = [...(this.scrolls[nextPanel] || [])];\n        scrollPosition = newPanelScrolls.pop();\n        this.scrolls[nextPanel] = newPanelScrolls;\n      }\n\n      this.setState(\n        {\n          swipeBackPrevPanel: null,\n          swipeBackNextPanel: null,\n          swipingBack: false,\n          swipeBackResult: null,\n          swipebackStartX: 0,\n          swipeBackShift: 0,\n          activePanel: nextPanel,\n          visiblePanels: [nextPanel],\n        },\n        () => {\n          this.props.scroll?.scrollTo(0, scrollPosition);\n          prevProps.onTransition &&\n            prevProps.onTransition({\n              isBack: true,\n              from: prevPanel,\n              to: nextPanel,\n            });\n        }\n      );\n    }\n\n    // Начался свайп назад\n    if (!prevState.swipingBack && this.state.swipingBack) {\n      this.props.onSwipeBackStart && this.props.onSwipeBackStart();\n    }\n\n    // Началась анимация завершения свайпа назад.\n    if (!prevState.swipeBackResult && this.state.swipeBackResult) {\n      this.waitTransitionFinish(\n        this.pickPanel(this.state.swipeBackNextPanel),\n        this.swipingBackTransitionEndHandler\n      );\n    }\n\n    // Если свайп назад отменился (когда пользователь недостаточно сильно свайпнул)\n    if (\n      prevState.swipeBackResult === SwipeBackResults.fail &&\n      !this.state.swipeBackResult &&\n      this.state.activePanel !== null\n    ) {\n      const newPanelScrolls = [...(this.scrolls[this.state.activePanel] || [])];\n      const scrollPosition = newPanelScrolls.pop();\n      this.scrolls = {\n        ...this.scrolls,\n        [this.state.activePanel]: newPanelScrolls,\n      };\n\n      this.props.scroll?.scrollTo(0, scrollPosition);\n    }\n\n    // Закончился Safari свайп\n    if (\n      prevProps.activePanel !== this.props.activePanel &&\n      this.state.browserSwipe\n    ) {\n      this.setState({\n        browserSwipe: false,\n        nextPanel: null,\n        prevPanel: null,\n        animated: false,\n        visiblePanels: [this.props.activePanel],\n        activePanel: this.props.activePanel,\n      });\n    }\n  }\n\n  shouldDisableTransitionMotion(): boolean {\n    return (\n      this.props.configProvider?.transitionMotionEnabled === false ||\n      !this.props.splitCol?.animate\n    );\n  }\n\n  waitTransitionFinish(\n    elem: HTMLElement | null | undefined,\n    eventHandler: TransitionEventHandler\n  ): void {\n    if (transitionEvent.supported && transitionEvent.name && elem) {\n      elem.removeEventListener(\n        transitionEvent.name as keyof HTMLElementEventMap,\n        eventHandler as EventListener\n      );\n      elem.addEventListener(\n        transitionEvent.name as keyof HTMLElementEventMap,\n        eventHandler as EventListener\n      );\n    } else {\n      if (this.transitionFinishTimeout) {\n        clearTimeout(this.transitionFinishTimeout);\n      }\n\n      this.transitionFinishTimeout = setTimeout(\n        eventHandler,\n        this.props.platform === ANDROID || this.props.platform === VKCOM\n          ? 300\n          : 600\n      );\n    }\n  }\n\n  blurActiveElement(): void {\n    if (typeof this.window !== \"undefined\" && this.document?.activeElement) {\n      (this.document.activeElement as HTMLElement).blur();\n    }\n  }\n\n  pickPanel(id: string | null) {\n    if (id === null) {\n      return undefined;\n    }\n    return this.panelNodes[id];\n  }\n\n  flushTransition(prevPanel: string, isBack: boolean) {\n    const activePanel = this.props.activePanel;\n\n    const prevPanelScrolls = [...(this.scrolls[prevPanel] || [])].slice(0, -1);\n    const newPanelScrolls = [...(this.scrolls[activePanel] || [])];\n    const scrollPosition = isBack ? newPanelScrolls.pop() : 0;\n    if (isBack) {\n      this.scrolls = {\n        ...this.scrolls,\n        [prevPanel]: prevPanelScrolls,\n        [activePanel]: newPanelScrolls,\n      };\n    }\n\n    this.setState(\n      {\n        prevPanel: null,\n        nextPanel: null,\n        visiblePanels: [activePanel],\n        activePanel: activePanel,\n        animated: false,\n        isBack: undefined,\n      },\n      () => {\n        this.props.scroll?.scrollTo(0, isBack ? scrollPosition : 0);\n        this.props.onTransition &&\n          this.props.onTransition({ isBack, from: prevPanel, to: activePanel });\n      }\n    );\n  }\n\n  transitionEndHandler = (e?: React.AnimationEvent): void => {\n    if (\n      (!e ||\n        [\n          \"vkui-animation-ios-next-forward\",\n          \"vkui-animation-ios-prev-back\",\n          \"vkui-animation-view-next-forward\",\n          \"vkui-animation-view-prev-back\",\n        ].includes(e.animationName)) &&\n      this.state.prevPanel !== null\n    ) {\n      this.flushTransition(this.state.prevPanel, Boolean(this.state.isBack));\n    }\n  };\n\n  swipingBackTransitionEndHandler = (e?: TransitionEvent): void => {\n    // indexOf because of vendor prefixes in old browsers\n    if (\n      !e ||\n      (e.propertyName.includes(\"transform\") &&\n        e.target === this.pickPanel(this.state.swipeBackNextPanel))\n    ) {\n      switch (this.state.swipeBackResult) {\n        case SwipeBackResults.fail:\n          this.onSwipeBackCancel();\n          break;\n        case SwipeBackResults.success:\n          this.onSwipeBackSuccess();\n      }\n    }\n  };\n\n  onSwipeBackSuccess(): void {\n    this.props.onSwipeBack && this.props.onSwipeBack();\n  }\n\n  onSwipeBackCancel(): void {\n    this.props.onSwipeBackCancel && this.props.onSwipeBackCancel();\n    this.setState({\n      swipeBackPrevPanel: null,\n      swipeBackNextPanel: null,\n      swipingBack: false,\n      swipeBackResult: null,\n      swipebackStartX: 0,\n      swipeBackShift: 0,\n    });\n  }\n\n  onMoveX = (e: TouchEvent): void => {\n    if (swipeBackExcluded(e) || !this.window) {\n      return;\n    }\n\n    const { platform, configProvider } = this.props;\n\n    if (\n      platform === IOS &&\n      !configProvider?.isWebView &&\n      (e.startX <= 70 || e.startX >= this.window.innerWidth - 70) &&\n      !this.state.browserSwipe\n    ) {\n      this.setState({ browserSwipe: true });\n    }\n\n    if (\n      platform === IOS &&\n      configProvider?.isWebView &&\n      this.props.onSwipeBack\n    ) {\n      if (this.state.animated && e.startX <= 70) {\n        return;\n      }\n\n      if (\n        e.startX <= 70 &&\n        !this.state.swipingBack &&\n        (this.props.history?.length ?? 0) > 1\n      ) {\n        if (this.state.activePanel !== null) {\n          const prevScrolls = this.scrolls[this.state.activePanel] || [];\n          this.scrolls = {\n            ...this.scrolls,\n            [this.state.activePanel]: [\n              ...prevScrolls,\n              this.props.scroll?.getScroll().y,\n            ],\n          };\n        }\n\n        this.setState({\n          swipingBack: true,\n          swipebackStartX: e.startX,\n          swipeBackPrevPanel: this.state.activePanel,\n          swipeBackNextPanel: this.props.history!.slice(-2)[0],\n        });\n      }\n      if (this.state.swipingBack) {\n        let swipeBackShift;\n        if (e.shiftX < 0) {\n          swipeBackShift = 0;\n        } else if (\n          e.shiftX >\n          this.window.innerWidth - this.state.swipebackStartX\n        ) {\n          swipeBackShift = this.window.innerWidth;\n        } else {\n          swipeBackShift = e.shiftX;\n        }\n        this.setState({ swipeBackShift });\n      }\n    }\n  };\n\n  onEnd = (e: TouchEvent): void => {\n    if (this.state.swipingBack && this.window) {\n      const speed = (this.state.swipeBackShift / e.duration) * 1000;\n      if (this.state.swipeBackShift === 0) {\n        this.onSwipeBackCancel();\n      } else if (this.state.swipeBackShift >= this.window.innerWidth) {\n        this.onSwipeBackSuccess();\n      } else if (\n        speed > 250 ||\n        this.state.swipebackStartX + this.state.swipeBackShift >\n          this.window.innerWidth / 2\n      ) {\n        this.setState({ swipeBackResult: SwipeBackResults.success });\n      } else {\n        this.setState({ swipeBackResult: SwipeBackResults.fail });\n      }\n    }\n  };\n\n  calcPanelSwipeStyles(panelId: string | undefined): React.CSSProperties {\n    if (!canUseDOM || !this.window) {\n      return {};\n    }\n\n    const isPrev = panelId === this.state.swipeBackPrevPanel;\n    const isNext = panelId === this.state.swipeBackNextPanel;\n\n    if ((!isPrev && !isNext) || this.state.swipeBackResult) {\n      return {};\n    }\n\n    let prevPanelTranslate = `${this.state.swipeBackShift}px`;\n    let nextPanelTranslate = `${\n      -50 + (this.state.swipeBackShift * 100) / this.window.innerWidth / 2\n    }%`;\n    let prevPanelShadow =\n      (0.3 * (this.window.innerWidth - this.state.swipeBackShift)) /\n      this.window.innerWidth;\n\n    if (this.state.swipeBackResult) {\n      return isPrev\n        ? { boxShadow: `-2px 0 12px rgba(0, 0, 0, ${prevPanelShadow})` }\n        : {};\n    }\n\n    if (isNext) {\n      return {\n        transform: `translate3d(${nextPanelTranslate}, 0, 0)`,\n        WebkitTransform: `translate3d(${nextPanelTranslate}, 0, 0)`,\n      };\n    }\n    if (isPrev) {\n      return {\n        transform: `translate3d(${prevPanelTranslate}, 0, 0)`,\n        WebkitTransform: `translate3d(${prevPanelTranslate}, 0, 0)`,\n        boxShadow: `-2px 0 12px rgba(0, 0, 0, ${prevPanelShadow})`,\n      };\n    }\n\n    return {};\n  }\n\n  render() {\n    const {\n      popout,\n      modal,\n      platform,\n      activePanel: _1,\n      splitCol,\n      configProvider,\n      history,\n      id,\n      nav,\n      onTransition,\n      onSwipeBack,\n      onSwipeBackStart,\n      onSwipeBackCancel,\n      window,\n      document,\n      scroll,\n      isBackCheck,\n      ...restProps\n    } = this.props;\n    const {\n      prevPanel,\n      nextPanel,\n      activePanel,\n      isBack,\n      animated,\n      swipeBackPrevPanel,\n      swipeBackNextPanel,\n      swipeBackResult,\n      swipingBack,\n    } = this.state;\n\n    const hasPopout = !!popout;\n    const hasModal = !!modal;\n\n    const panels = this.panels\n      .filter((panel) => {\n        const panelId = getNavId(panel.props, warn);\n\n        return (\n          (panelId !== undefined &&\n            this.state.visiblePanels.includes(panelId)) ||\n          panelId === swipeBackPrevPanel ||\n          panelId === swipeBackNextPanel\n        );\n      })\n      .sort((panel) => {\n        const panelId = getNavId(panel.props, warn);\n        const isPrevPanel =\n          panelId === prevPanel || panelId === swipeBackPrevPanel;\n        const isNextPanel =\n          panelId === nextPanel || panelId === swipeBackNextPanel;\n\n        if (isNextPanel) {\n          return swipingBack || this.state.isBack ? -1 : 1;\n        }\n\n        if (isPrevPanel) {\n          return swipingBack || this.state.isBack ? 1 : -1;\n        }\n\n        return 0;\n      });\n\n    const disableAnimation = this.shouldDisableTransitionMotion();\n\n    const modifiers = {\n      \"View--animated\": !disableAnimation && this.state.animated,\n      \"View--swiping-back\": !disableAnimation && this.state.swipingBack,\n      \"View--no-motion\": disableAnimation,\n    };\n\n    return (\n      <Touch\n        Component=\"section\"\n        {...restProps}\n        vkuiClass={classNames(getClassName(\"View\", platform), modifiers)}\n        onMoveX={this.onMoveX}\n        onEnd={this.onEnd}\n      >\n        <div vkuiClass=\"View__panels\">\n          {panels.map((panel: React.ReactElement) => {\n            const panelId = getNavId(panel.props, warn);\n            const isPrev =\n              panelId === prevPanel || panelId === swipeBackPrevPanel;\n            const compensateScroll =\n              isPrev ||\n              panelId === swipeBackNextPanel ||\n              (panelId === nextPanel && isBack);\n            const isTransitionTarget =\n              animated && panelId === (isBack ? prevPanel : nextPanel);\n            const scrollList = (panelId && this.scrolls[panelId]) || [];\n            const scroll = scrollList[scrollList.length - 1] || 0;\n\n            return (\n              <div\n                vkuiClass={classNames(\"View__panel\", {\n                  \"View__panel--active\": panelId === activePanel,\n                  \"View__panel--prev\": panelId === prevPanel,\n                  \"View__panel--next\": panelId === nextPanel,\n                  \"View__panel--swipe-back-prev\":\n                    panelId === swipeBackPrevPanel,\n                  \"View__panel--swipe-back-next\":\n                    panelId === swipeBackNextPanel,\n                  \"View__panel--swipe-back-success\":\n                    swipeBackResult === SwipeBackResults.success,\n                  \"View__panel--swipe-back-failed\":\n                    swipeBackResult === SwipeBackResults.fail,\n                })}\n                onAnimationEnd={\n                  isTransitionTarget ? this.transitionEndHandler : undefined\n                }\n                ref={(el) =>\n                  panelId !== undefined && (this.panelNodes[panelId] = el)\n                }\n                style={this.calcPanelSwipeStyles(panelId)}\n                key={panelId}\n              >\n                <div\n                  vkuiClass=\"View__panel-in\"\n                  style={{ marginTop: compensateScroll ? -scroll : undefined }}\n                >\n                  <NavTransitionProvider\n                    entering={\n                      panelId === nextPanel || panelId === swipeBackNextPanel\n                    }\n                  >\n                    {panel}\n                  </NavTransitionProvider>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n        <AppRootPortal>\n          {hasPopout && <div vkuiClass=\"View__popout\">{popout}</div>}\n          {hasModal && <div vkuiClass=\"View__modal\">{modal}</div>}\n        </AppRootPortal>\n      </Touch>\n    );\n  }\n}\n\nexport const ViewInfinite = withContext(\n  withContext(\n    withContext(\n      withPlatform(withDOM<ViewInfiniteProps>(ViewInfiniteComponent)),\n      SplitColContext,\n      \"splitCol\"\n    ),\n    ConfigProviderContext,\n    \"configProvider\"\n  ),\n  ScrollContext,\n  \"scroll\"\n);\n"],"file":"ViewInfinite.js"}