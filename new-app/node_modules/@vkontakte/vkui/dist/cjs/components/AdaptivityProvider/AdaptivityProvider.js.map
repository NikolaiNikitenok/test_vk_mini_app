{"version":3,"sources":["../../../../src/components/AdaptivityProvider/AdaptivityProvider.tsx"],"names":["DESKTOP_SIZE","TABLET_SIZE","SMALL_TABLET_SIZE","MOBILE_SIZE","MOBILE_LANDSCAPE_HEIGHT","MEDIUM_HEIGHT","AdaptivityProvider","props","adaptivityRef","React","useRef","useState","updateAdaptivity","window","current","calculateAdaptivity","innerWidth","innerHeight","useEffect","onResize","calculated","viewWidth","viewHeight","sizeX","sizeY","hasMouse","deviceHasHover","addEventListener","removeEventListener","children","windowWidth","windowHeight","ViewWidth","SMALL_MOBILE","ViewHeight","SMALL","SizeType","REGULAR","_hasMouse","_hasHover","DESKTOP","TABLET","SMALL_TABLET","MOBILE","MEDIUM","EXTRA_SMALL","COMPACT"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { hasMouse as _hasMouse, hasHover as _hasHover } from \"@vkontakte/vkjs\";\nimport {\n  AdaptivityContext,\n  AdaptivityProps,\n  SizeType,\n  ViewHeight,\n  ViewWidth,\n} from \"./AdaptivityContext\";\nimport { useDOM } from \"../../lib/dom\";\n\nexport const DESKTOP_SIZE = 1280;\nexport const TABLET_SIZE = 1024;\nexport const SMALL_TABLET_SIZE = 768;\nexport const MOBILE_SIZE = 320;\n\nexport const MOBILE_LANDSCAPE_HEIGHT = 414;\nexport const MEDIUM_HEIGHT = 720;\n\nconst AdaptivityProvider: React.FC<AdaptivityProps> = (props) => {\n  const adaptivityRef = React.useRef<ReturnType<\n    typeof calculateAdaptivity\n  > | null>(null);\n  const [, updateAdaptivity] = React.useState({});\n\n  const { window } = useDOM();\n\n  if (!adaptivityRef.current) {\n    adaptivityRef.current = calculateAdaptivity(\n      window ? window.innerWidth : 0,\n      window ? window.innerHeight : 0,\n      props\n    );\n  }\n\n  React.useEffect(() => {\n    function onResize() {\n      if (adaptivityRef.current === null) {\n        return;\n      }\n      const calculated = calculateAdaptivity(\n        window!.innerWidth,\n        window!.innerHeight,\n        props\n      );\n      const { viewWidth, viewHeight, sizeX, sizeY, hasMouse, deviceHasHover } =\n        adaptivityRef.current;\n\n      if (\n        viewWidth !== calculated.viewWidth ||\n        viewHeight !== calculated.viewHeight ||\n        sizeX !== calculated.sizeX ||\n        sizeY !== calculated.sizeY ||\n        hasMouse !== calculated.hasMouse ||\n        deviceHasHover !== calculated.deviceHasHover\n      ) {\n        adaptivityRef.current = calculated;\n        updateAdaptivity({});\n      }\n    }\n\n    onResize();\n    window!.addEventListener(\"resize\", onResize, false);\n\n    return () => {\n      window!.removeEventListener(\"resize\", onResize, false);\n    };\n  }, [\n    props.viewWidth,\n    props.viewHeight,\n    props.sizeX,\n    props.sizeY,\n    props.hasMouse,\n    props.deviceHasHover,\n    window,\n    props,\n  ]);\n\n  return (\n    <AdaptivityContext.Provider value={adaptivityRef.current}>\n      {props.children}\n    </AdaptivityContext.Provider>\n  );\n};\n\nfunction calculateAdaptivity(\n  windowWidth: number,\n  windowHeight: number,\n  props: AdaptivityProps\n) {\n  let viewWidth = ViewWidth.SMALL_MOBILE;\n  let viewHeight = ViewHeight.SMALL;\n  let sizeY = SizeType.REGULAR;\n  let sizeX = SizeType.REGULAR;\n  let hasMouse = props.hasMouse ?? _hasMouse;\n  let deviceHasHover = props.deviceHasHover ?? _hasHover;\n\n  if (windowWidth >= DESKTOP_SIZE) {\n    viewWidth = ViewWidth.DESKTOP;\n  } else if (windowWidth >= TABLET_SIZE) {\n    viewWidth = ViewWidth.TABLET;\n  } else if (windowWidth >= SMALL_TABLET_SIZE) {\n    viewWidth = ViewWidth.SMALL_TABLET;\n  } else if (windowWidth >= MOBILE_SIZE) {\n    viewWidth = ViewWidth.MOBILE;\n  } else {\n    viewWidth = ViewWidth.SMALL_MOBILE;\n  }\n\n  if (windowHeight >= MEDIUM_HEIGHT) {\n    viewHeight = ViewHeight.MEDIUM;\n  } else if (windowHeight > MOBILE_LANDSCAPE_HEIGHT) {\n    viewHeight = ViewHeight.SMALL;\n  } else {\n    viewHeight = ViewHeight.EXTRA_SMALL;\n  }\n\n  props.viewWidth && (viewWidth = props.viewWidth);\n  props.viewHeight && (viewHeight = props.viewHeight);\n\n  if (viewWidth <= ViewWidth.MOBILE) {\n    sizeX = SizeType.COMPACT;\n  }\n\n  if (\n    (viewWidth >= ViewWidth.SMALL_TABLET && hasMouse) ||\n    viewHeight <= ViewHeight.EXTRA_SMALL\n  ) {\n    sizeY = SizeType.COMPACT;\n  }\n\n  props.sizeX && (sizeX = props.sizeX);\n  props.sizeY && (sizeY = props.sizeY);\n\n  return { viewWidth, viewHeight, sizeX, sizeY, hasMouse, deviceHasHover };\n}\n\nexport { AdaptivityProvider };\n"],"file":"AdaptivityProvider.js"}