{"version":3,"sources":["../../../../src/components/ModalRoot/ModalRootContext.tsx"],"names":["React","useIsomorphicLayoutEffect","ModalRootContext","createContext","updateModalHeight","undefined","registerModal","isInsideModal","useModalRegistry","id","type","modalContext","useContext","elements","useRef","current","reset","Object","keys","reduce","acc","k","refs","modalElement","e","innerElement","headerElement","contentElement"],"mappings":";;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAASC,yBAAT;AAcA,OAAO,IAAMC,gBAAgB,gBAAGF,KAAK,CAACG,aAAN,CAA+C;AAC7EC,EAAAA,iBAAiB,EAAE;AAAA,WAAMC,SAAN;AAAA,GAD0D;AAE7EC,EAAAA,aAAa,EAAE;AAAA,WAAMD,SAAN;AAAA,GAF8D;AAG7EE,EAAAA,aAAa,EAAE;AAH8D,CAA/C,CAAzB;AAMP;AACA;AACA;;AACA,OAAO,SAASC,gBAAT,CAA0BC,EAA1B,EAAkDC,IAAlD,EAAmE;AACxE,MAAMC,YAAY,GAAGX,KAAK,CAACY,UAAN,CAAiBV,gBAAjB,CAArB;AACA,MAAMW,QAAQ,GAAGb,KAAK,CAACc,MAAN,CAA4B,EAA5B,EAAgCC,OAAjD;AACAd,EAAAA,yBAAyB,CAAC,YAAM;AAC9B,QAAIQ,EAAE,KAAKJ,SAAX,EAAsB;AACpBM,MAAAA,YAAY,CAACL,aAAb,iCAAgCO,QAAhC;AAA0CH,QAAAA,IAAI,EAAJA,IAA1C;AAAgDD,QAAAA,EAAE,EAAFA;AAAhD,UADoB,CAEpB;;AACA,UAAMO,KAAK,GAAGC,MAAM,CAACC,IAAP,CAAYL,QAAZ,EAAsBM,MAAtB,CACZ,UAACC,GAAD,EAAMC,CAAN;AAAA,+CAAkBD,GAAlB,2BAAwBC,CAAxB,EAA4B,IAA5B;AAAA,OADY,EAEZ;AAAEX,QAAAA,IAAI,EAAJA,IAAF;AAAQD,QAAAA,EAAE,EAAFA;AAAR,OAFY,CAAd;AAIA,aAAO;AAAA,eAAME,YAAY,CAACL,aAAb,CAA2BU,KAA3B,CAAN;AAAA,OAAP;AACD;;AACD,WAAOX,SAAP;AACD,GAXwB,EAWtB,EAXsB,CAAzB;AAaA,MAAMiB,IAAI,GAAGtB,KAAK,CAACc,MAAN,CAAkC;AAC7CS,IAAAA,YAAY,EAAE,sBAACC,CAAD;AAAA,aAAQX,QAAQ,CAACU,YAAT,GAAwBC,CAAhC;AAAA,KAD+B;AAE7CC,IAAAA,YAAY,EAAE,sBAACD,CAAD;AAAA,aAAQX,QAAQ,CAACY,YAAT,GAAwBD,CAAhC;AAAA,KAF+B;AAG7CE,IAAAA,aAAa,EAAE,uBAACF,CAAD;AAAA,aAAQX,QAAQ,CAACa,aAAT,GAAyBF,CAAjC;AAAA,KAH8B;AAI7CG,IAAAA,cAAc,EAAE,wBAACH,CAAD;AAAA,aAAQX,QAAQ,CAACc,cAAT,GAA0BH,CAAlC;AAAA;AAJ6B,GAAlC,EAKVT,OALH;AAMA,SAAO;AAAEO,IAAAA,IAAI,EAAJA;AAAF,GAAP;AACD,C,CAED;;AACA,eAAepB,gBAAf","sourcesContent":["import * as React from \"react\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { ModalElements, ModalsStateEntry, ModalType } from \"./types\";\n\nexport type ModalRegistryEntry = ModalElements &\n  Required<Pick<ModalsStateEntry, \"type\" | \"id\">>;\ntype ModalRefs = { [k in keyof ModalElements]: (e: ModalElements[k]) => void };\n\nexport interface ModalRootContextInterface {\n  updateModalHeight: VoidFunction;\n  registerModal(data: ModalRegistryEntry): void;\n  onClose?: VoidFunction;\n  isInsideModal: boolean;\n}\n\nexport const ModalRootContext = React.createContext<ModalRootContextInterface>({\n  updateModalHeight: () => undefined,\n  registerModal: () => undefined,\n  isInsideModal: false,\n});\n\n/**\n * All referenced elements must be static\n */\nexport function useModalRegistry(id: string | undefined, type: ModalType) {\n  const modalContext = React.useContext(ModalRootContext);\n  const elements = React.useRef<ModalElements>({}).current;\n  useIsomorphicLayoutEffect(() => {\n    if (id !== undefined) {\n      modalContext.registerModal({ ...elements, type, id });\n      // unset refs on  unmount to prevent leak\n      const reset = Object.keys(elements).reduce<ModalRegistryEntry>(\n        (acc, k) => ({ ...acc, [k]: null }),\n        { type, id }\n      );\n      return () => modalContext.registerModal(reset);\n    }\n    return undefined;\n  }, []);\n\n  const refs = React.useRef<Required<ModalRefs>>({\n    modalElement: (e) => (elements.modalElement = e),\n    innerElement: (e) => (elements.innerElement = e),\n    headerElement: (e) => (elements.headerElement = e),\n    contentElement: (e) => (elements.contentElement = e),\n  }).current;\n  return { refs };\n}\n\n// eslint-disable-next-line import/no-default-export\nexport default ModalRootContext;\n"],"file":"ModalRootContext.js"}