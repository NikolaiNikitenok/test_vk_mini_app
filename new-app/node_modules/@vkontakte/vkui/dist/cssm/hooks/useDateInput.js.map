{"version":3,"sources":["../../../src/hooks/useDateInput.ts"],"names":["React","useBooleanState","useGlobalEventListener","useDOM","useDateInput","maxElement","refs","autoFocus","disabled","elementsConfig","onChange","onInternalValueChange","getInternalValue","value","document","open","openCalendar","setTrue","closeCalendar","setFalse","rootRef","useRef","calendarRef","useState","internalValue","setInternalValue","focusedElement","setFocusedElement","window","removeFocusFromField","useCallback","getSelection","removeAllRanges","handleClickOutside","e","current","contains","target","selectFirst","capture","useEffect","range","createRange","element","focus","selectNodeContents","selection","addRange","clear","undefined","handleFieldEnter","handleKeyDown","_value","config","test","key","length","slice","currentValue","Number","String","min","max","padStart","shiftKey","preventDefault"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { useBooleanState } from \"./useBooleanState\";\nimport { useGlobalEventListener } from \"./useGlobalEventListener\";\nimport { useDOM } from \"../lib/dom\";\n\nexport interface UseDateInputDependencies<T, D> {\n  maxElement: number;\n  refs: Array<React.RefObject<T>>;\n  autoFocus?: boolean;\n  disabled?: boolean;\n  value?: D;\n  elementsConfig(index: number): {\n    length: number;\n    min: number;\n    max: number;\n  };\n  onInternalValueChange(value: string[]): void;\n  getInternalValue(value?: D | undefined): string[];\n  onChange?(value?: D | undefined): void;\n}\n\nexport function useDateInput<T extends HTMLElement, D>({\n  maxElement,\n  refs,\n  autoFocus,\n  disabled,\n  elementsConfig,\n  onChange,\n  onInternalValueChange,\n  getInternalValue,\n  value,\n}: UseDateInputDependencies<T, D>) {\n  const { document } = useDOM();\n  const {\n    value: open,\n    setTrue: openCalendar,\n    setFalse: closeCalendar,\n  } = useBooleanState(false);\n  const rootRef = React.useRef<HTMLDivElement>(null);\n  const calendarRef = React.useRef<HTMLDivElement>(null);\n  const [internalValue, setInternalValue] = React.useState<string[]>([]);\n  const [focusedElement, setFocusedElement] = React.useState<number | null>(\n    null\n  );\n  const { window } = useDOM();\n\n  const removeFocusFromField = React.useCallback(() => {\n    if (open) {\n      setFocusedElement(null);\n      closeCalendar();\n      window!.getSelection()?.removeAllRanges();\n      setInternalValue(getInternalValue(value));\n    }\n  }, [closeCalendar, getInternalValue, open, value, window]);\n\n  const handleClickOutside = React.useCallback(\n    (e: MouseEvent) => {\n      if (\n        !rootRef.current?.contains(e.target as Node | null) &&\n        !calendarRef.current?.contains(e.target as Node | null)\n      ) {\n        removeFocusFromField();\n      }\n    },\n    [removeFocusFromField]\n  );\n\n  const selectFirst = React.useCallback(() => {\n    setFocusedElement(0);\n  }, []);\n\n  useGlobalEventListener(document, \"click\", handleClickOutside, {\n    capture: true,\n  });\n\n  React.useEffect(() => {\n    setInternalValue(getInternalValue(value));\n  }, [getInternalValue, value]);\n\n  React.useEffect(() => {\n    if (autoFocus) {\n      selectFirst();\n    }\n  }, [autoFocus, selectFirst]);\n\n  React.useEffect(() => {\n    if (disabled || focusedElement === null) {\n      return;\n    }\n\n    const range = window!.document.createRange();\n\n    let element = refs[focusedElement].current;\n\n    if (element) {\n      element.focus();\n      openCalendar();\n      range.selectNodeContents(element as Node);\n\n      const selection = window!.getSelection();\n      selection?.removeAllRanges();\n      selection?.addRange(range);\n    }\n  }, [disabled, focusedElement, openCalendar, refs, window]);\n\n  const clear = React.useCallback(() => {\n    onChange?.(undefined);\n    selectFirst();\n  }, [onChange, selectFirst]);\n\n  const handleFieldEnter = React.useCallback(() => {\n    if (!open) {\n      selectFirst();\n    }\n  }, [open, selectFirst]);\n\n  const handleKeyDown = React.useCallback(\n    (e: React.KeyboardEvent<HTMLSpanElement>) => {\n      if (focusedElement === null) {\n        return;\n      }\n\n      const _value = [...internalValue];\n      const config = elementsConfig(focusedElement);\n\n      if (/^\\d+$/.test(e.key)) {\n        if (_value[focusedElement].length >= config.length) {\n          _value[focusedElement] = e.key;\n        } else {\n          _value[focusedElement] += e.key;\n          if (\n            _value[focusedElement].length >= config.length &&\n            focusedElement < maxElement\n          ) {\n            setFocusedElement(focusedElement + 1);\n          }\n        }\n      } else if (e.key === \"Backspace\") {\n        if (!_value[focusedElement]) {\n          setFocusedElement(\n            focusedElement <= 0 ? maxElement : focusedElement - 1\n          );\n        } else {\n          _value[focusedElement] = _value[focusedElement].slice(0, -1);\n        }\n      } else if (e.key === \"ArrowDown\" || e.key === \"Down\") {\n        let currentValue = Number(_value[focusedElement]);\n        _value[focusedElement] = String(\n          currentValue <= config.min ? config.max : currentValue - 1\n        ).padStart(config.length, \"0\");\n      } else if (e.key === \"ArrowUp\" || e.key === \"Up\") {\n        let currentValue = Number(_value[focusedElement]);\n        _value[focusedElement] = String(\n          currentValue >= config.max ? config.min : currentValue + 1\n        ).padStart(config.length, \"0\");\n      } else if (\n        e.key === \"Enter\" ||\n        (e.key === \"Tab\" && focusedElement === maxElement) ||\n        (e.key === \"Tab\" && e.shiftKey && focusedElement === 0)\n      ) {\n        removeFocusFromField();\n        return;\n      } else if (\n        e.key === \"ArrowLeft\" ||\n        e.key === \"Left\" ||\n        (e.key === \"Tab\" && e.shiftKey)\n      ) {\n        setFocusedElement(\n          focusedElement <= 0 ? maxElement : focusedElement - 1\n        );\n      } else if (\n        e.key === \"ArrowRight\" ||\n        e.key === \"Right\" ||\n        e.key === \"Tab\"\n      ) {\n        setFocusedElement(\n          focusedElement >= maxElement ? 0 : focusedElement + 1\n        );\n      } else if (e.key === \"Delete\" || e.key === \"Del\") {\n        _value[focusedElement] = \"\";\n      } else {\n        return;\n      }\n\n      e.preventDefault();\n      setInternalValue(_value);\n      onInternalValueChange(_value);\n    },\n    [\n      elementsConfig,\n      focusedElement,\n      internalValue,\n      maxElement,\n      onInternalValueChange,\n      removeFocusFromField,\n    ]\n  );\n\n  return {\n    rootRef,\n    calendarRef,\n    open,\n    openCalendar,\n    closeCalendar,\n    internalValue,\n    focusedElement,\n    setFocusedElement,\n    handleKeyDown,\n    clear,\n    handleFieldEnter,\n    removeFocusFromField,\n  };\n}\n"],"file":"useDateInput.js"}