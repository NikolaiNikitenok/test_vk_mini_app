{"version":3,"sources":["../src/animate.ts"],"names":["animate","duration","timing","draw","canUseDOM","start","window","performance","now","requestAnimationFrame","time","timeFraction","progress","animationEvent","supported","name","transitionEvent","AnimationEvent","WebKitAnimationEvent","TransitionEvent","WebKitTransitionEvent","waitAnimationEnd","listener","fallbackTime","el","canUseEventListeners","addEventListener","setTimeout","cancelWaitAnimationEnd","handle","removeEventListener","clearTimeout","waitTransitionEnd","cancelWaitTransitionEnd"],"mappings":"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","sourcesContent":["import { canUseDOM, canUseEventListeners } from './dom';\nimport { SupportEvent } from './types';\n\ntype TimingInterface = (timeFraction: number) => number;\n\ntype DrawInterface = (progress: number) => void;\n\ninterface AnimateArgumentsInterface {\n  duration: number;\n  timing: TimingInterface;\n  draw: DrawInterface;\n}\n\n/**\n * Функция для js анимации\n * @param {number} duration\n * @param {function} timing тайминг функция анимации\n * @param {function} draw коллбэк, в который прокидывается прогресс [0, 1]\n * @returns {void}\n */\nexport function animate({ duration, timing, draw }: AnimateArgumentsInterface) {\n  if (!canUseDOM) {\n    return;\n  }\n\n  const start = window.performance.now();\n\n  window.requestAnimationFrame(function animate(time) {\n    let timeFraction = (time - start) / duration;\n\n    if (timeFraction > 1) {\n      timeFraction = 1;\n    }\n\n    const progress = timing(timeFraction);\n\n    draw(progress);\n\n    if (timeFraction < 1) {\n      window.requestAnimationFrame(animate);\n    }\n  });\n}\n\n// WebKitAnimationEvent и WebKitTransitionEvent не существуют в глобальном контексте\ndeclare const WebKitAnimationEvent: AnimationEvent;\ndeclare const WebKitTransitionEvent: TransitionEvent;\n\nexport const animationEvent: SupportEvent<'animationend'> = {\n  supported: false,\n  name: 'animationend',\n};\n\nexport const transitionEvent: SupportEvent<'transitionend'> = {\n  supported: false,\n  name: 'transitionend',\n};\n\nif (canUseDOM) {\n  if (typeof AnimationEvent !== 'undefined') {\n    animationEvent.supported = true;\n  } else if (typeof WebKitAnimationEvent !== 'undefined') {\n    animationEvent.supported = true;\n\n    // webkitAnimationEnd не входит в перечисление событий, но соответствует animationend\n    animationEvent.name = 'webkitAnimationEnd' as unknown as 'animationend';\n  }\n\n  if (typeof TransitionEvent !== 'undefined') {\n    transitionEvent.supported = true;\n  } else if (typeof WebKitTransitionEvent !== 'undefined') {\n    transitionEvent.supported = true;\n\n    // webkitTransitionEnd не входит в перечисление событий, но соответствует transitionend\n    transitionEvent.name = 'webkitTransitionEnd' as unknown as 'transitionend';\n  }\n}\n\n/**\n * Ожидание окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\nexport function waitAnimationEnd(listener: (ev?: AnimationEvent) => any, fallbackTime: number, el?: GlobalEventHandlers) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.addEventListener(animationEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n\n/**\n * Прекращение ожидания окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitAnimationEnd```\n * @param el элемент\n */\nexport function cancelWaitAnimationEnd(listener: (ev?: AnimationEvent) => any, handle?: number, el?: GlobalEventHandlers) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.removeEventListener(animationEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}\n\n/**\n * Ожидание окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\nexport function waitTransitionEnd(el: GlobalEventHandlers, listener: (ev?: TransitionEvent) => any, fallbackTime: number) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.addEventListener(transitionEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n\n/**\n * Прекращение ожидания окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitTransitionEnd```\n * @param el элемент\n */\nexport function cancelWaitTransitionEnd(listener: (ev?: TransitionEvent) => any, handle?: number, el?: GlobalEventHandlers) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.removeEventListener(transitionEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}\n\n"],"file":"animate.js"}