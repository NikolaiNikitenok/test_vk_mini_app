{"version":3,"sources":["../../../../src/components/Root/Root.tsx"],"names":["warn","Root","popout","modal","children","_activeView","activeView","onTransition","nav","restProps","scroll","React","useContext","ScrollContext","platform","document","scrolls","useRef","current","viewNodes","ConfigProviderContext","transitionMotionEnabled","SplitColContext","animate","disableAnimation","views","Children","toArray","useState","transition","prevView","isBack","_setState","transitionTo","panel","viewIds","map","view","props","indexOf","getScroll","y","finishTransition","useCallback","activeElement","blur","scrollTo","Boolean","from","to","fallbackTransition","IOS","useEffect","clear","set","onAnimationEnd","e","includes","animationName","process","env","NODE_ENV","viewId","isTransitionTarget","compensateScroll","undefined","marginTop"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { classNames } from \"../../lib/classNames\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { IOS } from \"../../lib/platform\";\nimport { ConfigProviderContext } from \"../ConfigProvider/ConfigProviderContext\";\nimport { SplitColContext } from \"../SplitCol/SplitCol\";\nimport { AppRootPortal } from \"../AppRoot/AppRootPortal\";\nimport { ScrollContext } from \"../AppRoot/ScrollContext\";\nimport { NavTransitionProvider } from \"../NavTransitionContext/NavTransitionContext\";\nimport { getNavId, NavIdProps } from \"../../lib/getNavId\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { useDOM } from \"../../lib/dom\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport \"./Root.css\";\n\nexport interface RootProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    NavIdProps {\n  activeView: string;\n  onTransition?(params: { isBack: boolean; from: string; to: string }): void;\n  /**\n   * @deprecated будет удалено в 5.0.0. Используйте одноименное свойство у `SplitLayout`.\n   *\n   * Свойство для отрисовки `Alert`, `ActionSheet` и `ScreenSpinner`.\n   */\n  popout?: React.ReactNode;\n  /**\n   * @deprecated будет удалено в 5.0.0. Используйте одноименное свойство у `SplitLayout`.\n   *\n   * Свойство для отрисовки `ModalRoot`.\n   */\n  modal?: React.ReactNode;\n}\n\nexport interface RootState {\n  activeView: string;\n  transition: boolean;\n  isBack?: boolean;\n  prevView?: string;\n}\n\nconst warn = warnOnce(\"Root\");\nconst Root: React.FC<RootProps> = ({\n  popout = null,\n  modal,\n  children,\n  activeView: _activeView,\n  onTransition,\n  nav,\n  ...restProps\n}: RootProps) => {\n  const scroll = React.useContext(ScrollContext);\n  const platform = usePlatform();\n  const { document } = useDOM();\n  const scrolls = React.useRef<Record<string, number>>({}).current;\n  const viewNodes = React.useRef<Record<string, HTMLElement | null>>(\n    {}\n  ).current;\n\n  const { transitionMotionEnabled = true } = React.useContext(\n    ConfigProviderContext\n  );\n  const { animate } = React.useContext(SplitColContext);\n  const disableAnimation = !transitionMotionEnabled || !animate;\n\n  const views = React.Children.toArray(children) as React.ReactElement[];\n\n  const [{ prevView, activeView, transition, isBack }, _setState] =\n    React.useState<RootState>({\n      activeView: _activeView,\n      transition: false,\n    });\n  const transitionTo = (panel: string) => {\n    if (panel !== activeView) {\n      const viewIds = views.map((view) => getNavId(view.props, warn));\n      const isBack = viewIds.indexOf(panel) < viewIds.indexOf(activeView);\n      scrolls[activeView] = scroll.getScroll().y;\n      _setState({\n        activeView: panel,\n        prevView: activeView,\n        transition: true,\n        isBack,\n      });\n    }\n  };\n  const finishTransition = React.useCallback(\n    () => _setState({ activeView, prevView, isBack, transition: false }),\n    [activeView, isBack, prevView]\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    (document!.activeElement as HTMLElement).blur();\n  }, [!!popout, activeView]);\n\n  // Нужен переход\n  useIsomorphicLayoutEffect(() => transitionTo(_activeView), [_activeView]);\n  useIsomorphicLayoutEffect(() => {\n    if (!transition && prevView) {\n      // Закончился переход\n      scroll.scrollTo(0, isBack ? scrolls[activeView] : 0);\n      onTransition &&\n        onTransition({\n          isBack: Boolean(isBack),\n          from: prevView,\n          to: activeView,\n        });\n    }\n  }, [transition]);\n\n  const fallbackTransition = useTimeout(\n    finishTransition,\n    platform === IOS ? 600 : 300\n  );\n  React.useEffect(() => {\n    if (!transition) {\n      fallbackTransition.clear();\n      return;\n    }\n    disableAnimation ? finishTransition() : fallbackTransition.set();\n  }, [disableAnimation, fallbackTransition, finishTransition, transition]);\n\n  const onAnimationEnd = (e: React.AnimationEvent) => {\n    if (\n      [\n        \"vkui-root-android-animation-hide-back\",\n        \"vkui-root-android-animation-show-forward\",\n        \"vkui-root-ios-animation-hide-back\",\n        \"vkui-root-ios-animation-show-forward\",\n      ].includes(e.animationName)\n    ) {\n      finishTransition();\n    }\n  };\n\n  if (process.env.NODE_ENV === \"development\") {\n    popout &&\n      warn(\n        \"Свойство popout устарело и будет удалено в 5.0.0. Используйте одноименное свойство у SplitLayout.\"\n      );\n    modal &&\n      warn(\n        \"Свойство modal устарело и будет удалено в 5.0.0. Используйте одноименное свойство у SplitLayout.\"\n      );\n  }\n\n  return (\n    <div\n      {...restProps}\n      vkuiClass={classNames(getClassName(\"Root\", platform), {\n        \"Root--transition\": !disableAnimation && transition,\n        \"Root--no-motion\": disableAnimation,\n      })}\n    >\n      {views.map((view) => {\n        const viewId = getNavId(view.props, warn);\n        if (viewId !== activeView && !(transition && viewId === prevView)) {\n          return null;\n        }\n        const isTransitionTarget =\n          transition && viewId === (isBack ? prevView : activeView);\n        const compensateScroll =\n          transition &&\n          (viewId === prevView || (isBack && viewId === activeView));\n        return (\n          <div\n            key={viewId}\n            ref={(e) => viewId && (viewNodes[viewId] = e)}\n            onAnimationEnd={isTransitionTarget ? onAnimationEnd : undefined}\n            vkuiClass={classNames(\"Root__view\", {\n              \"Root__view--hide-back\":\n                transition && viewId === prevView && isBack,\n              \"Root__view--hide-forward\":\n                transition && viewId === prevView && !isBack,\n              \"Root__view--show-back\":\n                transition && viewId === activeView && isBack,\n              \"Root__view--show-forward\":\n                transition && viewId === activeView && !isBack,\n              \"Root__view--active\": !transition && viewId === activeView,\n            })}\n          >\n            <NavTransitionProvider\n              entering={transition && viewId === activeView}\n            >\n              <div\n                vkuiClass=\"Root__scrollCompensation\"\n                style={{\n                  marginTop: compensateScroll\n                    ? viewId && -(scrolls[viewId] ?? 0)\n                    : undefined,\n                }}\n              >\n                {view}\n              </div>\n            </NavTransitionProvider>\n          </div>\n        );\n      })}\n      <AppRootPortal>\n        {!!popout && <div vkuiClass=\"Root__popout\">{popout}</div>}\n        {!!modal && <div vkuiClass=\"Root__modal\">{modal}</div>}\n      </AppRootPortal>\n    </div>\n  );\n};\n\n// eslint-disable-next-line import/no-default-export\nexport default Root;\n"],"file":"Root.js"}