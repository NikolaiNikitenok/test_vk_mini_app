{"version":3,"sources":["../../../src/components/View/ViewInfinite.tsx"],"names":["React","classNames","transitionEvent","animationEvent","getClassName","IOS","ANDROID","VKCOM","Touch","withPlatform","withContext","ConfigProviderContext","SplitColContext","AppRootPortal","canUseDOM","withDOM","ScrollContext","NavTransitionProvider","getNavId","warnOnce","swipeBackExcluded","warn","SwipeBackResults","scrollsCache","ViewInfiniteComponent","props","undefined","e","includes","animationName","state","prevPanel","flushTransition","Boolean","isBack","propertyName","target","pickPanel","swipeBackNextPanel","swipeBackResult","fail","onSwipeBackCancel","success","onSwipeBackSuccess","window","platform","configProvider","isWebView","startX","innerWidth","browserSwipe","setState","onSwipeBack","animated","swipingBack","history","length","activePanel","prevScrolls","scrolls","scroll","getScroll","y","swipebackStartX","swipeBackPrevPanel","slice","swipeBackShift","shiftX","speed","duration","visiblePanels","nextPanel","document","Children","toArray","children","id","prevProps","prevState","popout","blurActiveElement","modal","isBackCheck","from","to","firstLayerId","panels","map","panel","find","shouldDisableTransitionMotion","supported","animationFinishTimeout","clearTimeout","setTimeout","transitionEndHandler","scrollPosition","prevPanelScrolls","newPanelScrolls","pop","scrollTo","onTransition","onSwipeBackStart","waitTransitionFinish","swipingBackTransitionEndHandler","transitionMotionEnabled","splitCol","animate","elem","eventHandler","name","removeEventListener","addEventListener","transitionFinishTimeout","activeElement","blur","panelNodes","panelId","isPrev","isNext","prevPanelTranslate","nextPanelTranslate","prevPanelShadow","boxShadow","transform","WebkitTransform","_1","nav","restProps","hasPopout","hasModal","filter","sort","isPrevPanel","isNextPanel","disableAnimation","modifiers","onMoveX","onEnd","compensateScroll","isTransitionTarget","scrollList","el","calcPanelSwipeStyles","marginTop","Component","ViewInfinite"],"mappings":";;;;;;;;;;;;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAASC,UAAT;AACA,SAASC,eAAT,EAA0BC,cAA1B;AACA,SAASC,YAAT;AACA,SAASC,GAAT,EAAcC,OAAd,EAAuBC,KAAvB;AACA,SAASC,KAAT;AAEA,SAASC,YAAT;AACA,SAASC,WAAT;AACA,SACEC,qBADF;AAIA,SAASC,eAAT;AACA,SAASC,aAAT;AACA,SAASC,SAAT,EAAoBC,OAApB;AACA,SACEC,aADF;AAIA,SAASC,qBAAT;AACA,SAASC,QAAT;AACA,SAASC,QAAT;AACA,SAASC,iBAAT;AAGA,IAAMC,IAAI,GAAGF,QAAQ,CAAC,cAAD,CAArB;IAEKG,gB;;WAAAA,gB;AAAAA,EAAAA,gB,CAAAA,gB;AAAAA,EAAAA,gB,CAAAA,gB;GAAAA,gB,KAAAA,gB;;AAeL,IAAIC,YAA0B,GAAG,EAAjC;;IA2DMC,qB;;;;;AAIJ,iCAAYC,KAAZ,EAAsC;AAAA;;AAAA;;AACpC,8BAAMA,KAAN;;AADoC,8DA2BpBF,YAAY,CAACL,QAAQ,CAAC,MAAKO,KAAN,EAAaJ,IAAb,CAAT,CAAZ,IAAsD,EA3BlC;;AAAA,8EA4BgBK,SA5BhB;;AAAA,6EA6BeA,SA7Bf;;AAAA,iEA2CgB,EA3ChB;;AAAA,2EAqSf,UAACC,CAAD,EAAoC;AACzD,UACE,CAAC,CAACA,CAAD,IACC,CACE,iCADF,EAEE,8BAFF,EAGE,kCAHF,EAIE,+BAJF,EAKEC,QALF,CAKWD,CAAC,CAACE,aALb,CADF,KAOA,MAAKC,KAAL,CAAWC,SAAX,KAAyB,IAR3B,EASE;AACA,cAAKC,eAAL,CAAqB,MAAKF,KAAL,CAAWC,SAAhC,EAA2CE,OAAO,CAAC,MAAKH,KAAL,CAAWI,MAAZ,CAAlD;AACD;AACF,KAlTqC;;AAAA,sFAoTJ,UAACP,CAAD,EAA+B;AAC/D;AACA,UACE,CAACA,CAAD,IACCA,CAAC,CAACQ,YAAF,CAAeP,QAAf,CAAwB,WAAxB,KACCD,CAAC,CAACS,MAAF,KAAa,MAAKC,SAAL,CAAe,MAAKP,KAAL,CAAWQ,kBAA1B,CAHjB,EAIE;AACA,gBAAQ,MAAKR,KAAL,CAAWS,eAAnB;AACE,eAAKjB,gBAAgB,CAACkB,IAAtB;AACE,kBAAKC,iBAAL;;AACA;;AACF,eAAKnB,gBAAgB,CAACoB,OAAtB;AACE,kBAAKC,kBAAL;;AALJ;AAOD;AACF,KAnUqC;;AAAA,8DAqV5B,UAAChB,CAAD,EAAyB;AACjC,UAAIP,iBAAiB,CAACO,CAAD,CAAjB,IAAwB,CAAC,MAAKiB,MAAlC,EAA0C;AACxC;AACD;;AAED,wBAAqC,MAAKnB,KAA1C;AAAA,UAAQoB,QAAR,eAAQA,QAAR;AAAA,UAAkBC,cAAlB,eAAkBA,cAAlB;;AAEA,UACED,QAAQ,KAAKxC,GAAb,IACA,EAACyC,cAAD,aAACA,cAAD,eAACA,cAAc,CAAEC,SAAjB,CADA,KAECpB,CAAC,CAACqB,MAAF,IAAY,EAAZ,IAAkBrB,CAAC,CAACqB,MAAF,IAAY,MAAKJ,MAAL,CAAYK,UAAZ,GAAyB,EAFxD,KAGA,CAAC,MAAKnB,KAAL,CAAWoB,YAJd,EAKE;AACA,cAAKC,QAAL,CAAc;AAAED,UAAAA,YAAY,EAAE;AAAhB,SAAd;AACD;;AAED,UACEL,QAAQ,KAAKxC,GAAb,IACAyC,cADA,aACAA,cADA,eACAA,cAAc,CAAEC,SADhB,IAEA,MAAKtB,KAAL,CAAW2B,WAHb,EAIE;AAAA;;AACA,YAAI,MAAKtB,KAAL,CAAWuB,QAAX,IAAuB1B,CAAC,CAACqB,MAAF,IAAY,EAAvC,EAA2C;AACzC;AACD;;AAED,YACErB,CAAC,CAACqB,MAAF,IAAY,EAAZ,IACA,CAAC,MAAKlB,KAAL,CAAWwB,WADZ,IAEA,iDAAC,MAAK7B,KAAL,CAAW8B,OAAZ,wDAAC,oBAAoBC,MAArB,yEAA+B,CAA/B,IAAoC,CAHtC,EAIE;AACA,cAAI,MAAK1B,KAAL,CAAW2B,WAAX,KAA2B,IAA/B,EAAqC;AAAA;;AACnC,gBAAMC,WAAW,GAAG,MAAKC,OAAL,CAAa,MAAK7B,KAAL,CAAW2B,WAAxB,KAAwC,EAA5D;AACA,kBAAKE,OAAL,mCACK,MAAKA,OADV,2BAEG,MAAK7B,KAAL,CAAW2B,WAFd,+BAGOC,WAHP,0BAII,MAAKjC,KAAL,CAAWmC,MAJf,uDAII,mBAAmBC,SAAnB,GAA+BC,CAJnC;AAOD;;AAED,gBAAKX,QAAL,CAAc;AACZG,YAAAA,WAAW,EAAE,IADD;AAEZS,YAAAA,eAAe,EAAEpC,CAAC,CAACqB,MAFP;AAGZgB,YAAAA,kBAAkB,EAAE,MAAKlC,KAAL,CAAW2B,WAHnB;AAIZnB,YAAAA,kBAAkB,EAAE,MAAKb,KAAL,CAAW8B,OAAX,CAAoBU,KAApB,CAA0B,CAAC,CAA3B,EAA8B,CAA9B;AAJR,WAAd;AAMD;;AACD,YAAI,MAAKnC,KAAL,CAAWwB,WAAf,EAA4B;AAC1B,cAAIY,cAAJ;;AACA,cAAIvC,CAAC,CAACwC,MAAF,GAAW,CAAf,EAAkB;AAChBD,YAAAA,cAAc,GAAG,CAAjB;AACD,WAFD,MAEO,IACLvC,CAAC,CAACwC,MAAF,GACA,MAAKvB,MAAL,CAAYK,UAAZ,GAAyB,MAAKnB,KAAL,CAAWiC,eAF/B,EAGL;AACAG,YAAAA,cAAc,GAAG,MAAKtB,MAAL,CAAYK,UAA7B;AACD,WALM,MAKA;AACLiB,YAAAA,cAAc,GAAGvC,CAAC,CAACwC,MAAnB;AACD;;AACD,gBAAKhB,QAAL,CAAc;AAAEe,YAAAA,cAAc,EAAdA;AAAF,WAAd;AACD;AACF;AACF,KApZqC;;AAAA,4DAsZ9B,UAACvC,CAAD,EAAyB;AAC/B,UAAI,MAAKG,KAAL,CAAWwB,WAAX,IAA0B,MAAKV,MAAnC,EAA2C;AACzC,YAAMwB,KAAK,GAAI,MAAKtC,KAAL,CAAWoC,cAAX,GAA4BvC,CAAC,CAAC0C,QAA/B,GAA2C,IAAzD;;AACA,YAAI,MAAKvC,KAAL,CAAWoC,cAAX,KAA8B,CAAlC,EAAqC;AACnC,gBAAKzB,iBAAL;AACD,SAFD,MAEO,IAAI,MAAKX,KAAL,CAAWoC,cAAX,IAA6B,MAAKtB,MAAL,CAAYK,UAA7C,EAAyD;AAC9D,gBAAKN,kBAAL;AACD,SAFM,MAEA,IACLyB,KAAK,GAAG,GAAR,IACA,MAAKtC,KAAL,CAAWiC,eAAX,GAA6B,MAAKjC,KAAL,CAAWoC,cAAxC,GACE,MAAKtB,MAAL,CAAYK,UAAZ,GAAyB,CAHtB,EAIL;AACA,gBAAKE,QAAL,CAAc;AAAEZ,YAAAA,eAAe,EAAEjB,gBAAgB,CAACoB;AAApC,WAAd;AACD,SANM,MAMA;AACL,gBAAKS,QAAL,CAAc;AAAEZ,YAAAA,eAAe,EAAEjB,gBAAgB,CAACkB;AAApC,WAAd;AACD;AACF;AACF,KAvaqC;;AAGpC,UAAKV,KAAL,GAAa;AACXuB,MAAAA,QAAQ,EAAE,KADC;AAGXiB,MAAAA,aAAa,EAAE,CAAC7C,KAAK,CAACgC,WAAP,CAHJ;AAIXA,MAAAA,WAAW,EAAEhC,KAAK,CAACgC,WAJR;AAKXvB,MAAAA,MAAM,EAAER,SALG;AAMXK,MAAAA,SAAS,EAAE,IANA;AAOXwC,MAAAA,SAAS,EAAE,IAPA;AASXjB,MAAAA,WAAW,EAAE,KATF;AAUXS,MAAAA,eAAe,EAAE,CAVN;AAWXG,MAAAA,cAAc,EAAE,CAXL;AAYX5B,MAAAA,kBAAkB,EAAE,IAZT;AAaX0B,MAAAA,kBAAkB,EAAE,IAbT;AAcXzB,MAAAA,eAAe,EAAE,IAdN;AAgBXW,MAAAA,YAAY,EAAE;AAhBH,KAAb;AAHoC;AAqBrC;;;;SAUD,eAAe;AACb,aAAO,KAAKzB,KAAL,CAAW+C,QAAlB;AACD;;;SAED,eAAa;AACX,aAAO,KAAK/C,KAAL,CAAWmB,MAAlB;AACD;;;SAED,eAAa;AACX,aAAO5C,KAAK,CAACyE,QAAN,CAAeC,OAAf,CAAuB,KAAKjD,KAAL,CAAWkD,QAAlC,CAAP;AACD;;;WAID,gCAAuB;AACrB,UAAMC,EAAE,GAAG1D,QAAQ,CAAC,KAAKO,KAAN,CAAnB;;AACA,UAAImD,EAAJ,EAAQ;AACNrD,QAAAA,YAAY,CAACqD,EAAD,CAAZ,GAAmB,KAAKjB,OAAxB;AACD;AACF;;;WAED,4BACEkB,SADF,EAEEC,SAFF,EAGE;AAAA;;AACA,WAAKrD,KAAL,CAAWsD,MAAX,IAAqB,CAACF,SAAS,CAACE,MAAhC,IAA0C,KAAKC,iBAAL,EAA1C;AACA,WAAKvD,KAAL,CAAWwD,KAAX,IAAoB,CAACJ,SAAS,CAACI,KAA/B,IAAwC,KAAKD,iBAAL,EAAxC,CAFA,CAIA;;AACA,UACEH,SAAS,CAACpB,WAAV,KAA0B,KAAKhC,KAAL,CAAWgC,WAArC,IACA,CAACqB,SAAS,CAACxB,WADX,IAEA,CAACwB,SAAS,CAAC5B,YAHb,EAIE;AAAA;;AACA,YAAIhB,MAAM,GAAG,KAAb;;AAEA,YAAI,KAAKT,KAAL,CAAWyD,WAAf,EAA4B;AAC1BhD,UAAAA,MAAM,GAAG,KAAKT,KAAL,CAAWyD,WAAX,CAAuB;AAC9BC,YAAAA,IAAI,EAAEN,SAAS,CAACpB,WADc;AAE9B2B,YAAAA,EAAE,EAAE,KAAK3D,KAAL,CAAWgC;AAFe,WAAvB,CAAT;AAID,SALD,MAKO;AACL,cAAM4B,YAAY,GAAG,KAAKC,MAAL,CAClBC,GADkB,CACd,UAACC,KAAD;AAAA,mBAAWtE,QAAQ,CAACsE,KAAK,CAAC/D,KAAP,EAAcJ,IAAd,CAAnB;AAAA,WADc,EAElBoE,IAFkB,CAGjB,UAACb,EAAD;AAAA,mBACEA,EAAE,KAAKC,SAAS,CAACpB,WAAjB,IAAgCmB,EAAE,KAAK,MAAI,CAACnD,KAAL,CAAWgC,WADpD;AAAA,WAHiB,CAArB;AAMAvB,UAAAA,MAAM,GAAGmD,YAAY,KAAK,KAAK5D,KAAL,CAAWgC,WAArC;AACD;;AAED,aAAKuB,iBAAL;AAEA,YAAMtB,WAAW,GAAG,KAAKC,OAAL,CAAakB,SAAS,CAACpB,WAAvB,KAAuC,EAA3D;;AACA,YAAME,OAAO,mCACR,KAAKA,OADG,2BAEVkB,SAAS,CAACpB,WAFA,+BAGNC,WAHM,2BAIT,KAAKjC,KAAL,CAAWmC,MAJF,wDAIT,oBAAmBC,SAAnB,GAA+BC,CAJtB,IAAb;;AAOA,aAAKH,OAAL,GAAeA,OAAf;;AAEA,YAAI,KAAK+B,6BAAL,EAAJ,EAA0C;AACxC,eAAK1D,eAAL,CAAqB6C,SAAS,CAACpB,WAA/B,EAA4CvB,MAA5C;AACD,SAFD,MAEO;AACL,eAAKiB,QAAL,CAAc;AACZmB,YAAAA,aAAa,EAAE,CAACO,SAAS,CAACpB,WAAX,EAAwB,KAAKhC,KAAL,CAAWgC,WAAnC,CADH;AAEZ1B,YAAAA,SAAS,EAAE8C,SAAS,CAACpB,WAFT;AAGZc,YAAAA,SAAS,EAAE,KAAK9C,KAAL,CAAWgC,WAHV;AAIZA,YAAAA,WAAW,EAAE,IAJD;AAKZJ,YAAAA,QAAQ,EAAE,IALE;AAMZnB,YAAAA,MAAM,EAANA;AANY,WAAd,EADK,CAUL;;AACA,cAAI,CAAC/B,cAAc,CAACwF,SAApB,EAA+B;AAC7B,gBAAI,KAAKC,sBAAT,EAAiC;AAC/BC,cAAAA,YAAY,CAAC,KAAKD,sBAAN,CAAZ;AACD;;AACD,iBAAKA,sBAAL,GAA8BE,UAAU,CACtC,KAAKC,oBADiC,EAEtC,KAAKtE,KAAL,CAAWoB,QAAX,KAAwBvC,OAAxB,IAAmC,KAAKmB,KAAL,CAAWoB,QAAX,KAAwBtC,KAA3D,GACI,GADJ,GAEI,GAJkC,CAAxC;AAMD;AACF;AACF,OAhED,CAkEA;;;AACA,UACEsE,SAAS,CAACpB,WAAV,KAA0B,KAAKhC,KAAL,CAAWgC,WAArC,IACAqB,SAAS,CAACxB,WAFZ,EAGE;AACA,YAAMiB,SAAS,GAAG,KAAKzC,KAAL,CAAWQ,kBAA7B;AACA,YAAMP,SAAS,GAAG,KAAKD,KAAL,CAAWkC,kBAA7B;AACA,YAAIgC,cAAkC,GAAGtE,SAAzC;AAEA,aAAKiC,OAAL,qBACK,KAAKA,OADV;;AAIA,YAAI5B,SAAS,KAAK,IAAlB,EAAwB;AACtB,cAAMkE,gBAAgB,GAAG,mBAAK,KAAKtC,OAAL,CAAa5B,SAAb,KAA2B,EAAhC,EAAqCkC,KAArC,CACvB,CADuB,EAEvB,CAAC,CAFsB,CAAzB;;AAIA,eAAKN,OAAL,CAAa5B,SAAb,IAA0BkE,gBAA1B;AACD;;AACD,YAAI1B,SAAS,KAAK,IAAlB,EAAwB;AACtB,cAAM2B,eAAe,sBAAQ,KAAKvC,OAAL,CAAaY,SAAb,KAA2B,EAAnC,CAArB;;AACAyB,UAAAA,cAAc,GAAGE,eAAe,CAACC,GAAhB,EAAjB;AACA,eAAKxC,OAAL,CAAaY,SAAb,IAA0B2B,eAA1B;AACD;;AAED,aAAK/C,QAAL,CACE;AACEa,UAAAA,kBAAkB,EAAE,IADtB;AAEE1B,UAAAA,kBAAkB,EAAE,IAFtB;AAGEgB,UAAAA,WAAW,EAAE,KAHf;AAIEf,UAAAA,eAAe,EAAE,IAJnB;AAKEwB,UAAAA,eAAe,EAAE,CALnB;AAMEG,UAAAA,cAAc,EAAE,CANlB;AAOET,UAAAA,WAAW,EAAEc,SAPf;AAQED,UAAAA,aAAa,EAAE,CAACC,SAAD;AARjB,SADF,EAWE,YAAM;AAAA;;AACJ,iCAAA,MAAI,CAAC9C,KAAL,CAAWmC,MAAX,4EAAmBwC,QAAnB,CAA4B,CAA5B,EAA+BJ,cAA/B;AACAnB,UAAAA,SAAS,CAACwB,YAAV,IACExB,SAAS,CAACwB,YAAV,CAAuB;AACrBnE,YAAAA,MAAM,EAAE,IADa;AAErBiD,YAAAA,IAAI,EAAEpD,SAFe;AAGrBqD,YAAAA,EAAE,EAAEb;AAHiB,WAAvB,CADF;AAMD,SAnBH;AAqBD,OAjHD,CAmHA;;;AACA,UAAI,CAACO,SAAS,CAACxB,WAAX,IAA0B,KAAKxB,KAAL,CAAWwB,WAAzC,EAAsD;AACpD,aAAK7B,KAAL,CAAW6E,gBAAX,IAA+B,KAAK7E,KAAL,CAAW6E,gBAAX,EAA/B;AACD,OAtHD,CAwHA;;;AACA,UAAI,CAACxB,SAAS,CAACvC,eAAX,IAA8B,KAAKT,KAAL,CAAWS,eAA7C,EAA8D;AAC5D,aAAKgE,oBAAL,CACE,KAAKlE,SAAL,CAAe,KAAKP,KAAL,CAAWQ,kBAA1B,CADF,EAEE,KAAKkE,+BAFP;AAID,OA9HD,CAgIA;;;AACA,UACE1B,SAAS,CAACvC,eAAV,KAA8BjB,gBAAgB,CAACkB,IAA/C,IACA,CAAC,KAAKV,KAAL,CAAWS,eADZ,IAEA,KAAKT,KAAL,CAAW2B,WAAX,KAA2B,IAH7B,EAIE;AAAA;;AACA,YAAMyC,gBAAe,sBAAQ,KAAKvC,OAAL,CAAa,KAAK7B,KAAL,CAAW2B,WAAxB,KAAwC,EAAhD,CAArB;;AACA,YAAMuC,eAAc,GAAGE,gBAAe,CAACC,GAAhB,EAAvB;;AACA,aAAKxC,OAAL,mCACK,KAAKA,OADV,2BAEG,KAAK7B,KAAL,CAAW2B,WAFd,EAE4ByC,gBAF5B;AAKA,oCAAKzE,KAAL,CAAWmC,MAAX,4EAAmBwC,QAAnB,CAA4B,CAA5B,EAA+BJ,eAA/B;AACD,OA9ID,CAgJA;;;AACA,UACEnB,SAAS,CAACpB,WAAV,KAA0B,KAAKhC,KAAL,CAAWgC,WAArC,IACA,KAAK3B,KAAL,CAAWoB,YAFb,EAGE;AACA,aAAKC,QAAL,CAAc;AACZD,UAAAA,YAAY,EAAE,KADF;AAEZqB,UAAAA,SAAS,EAAE,IAFC;AAGZxC,UAAAA,SAAS,EAAE,IAHC;AAIZsB,UAAAA,QAAQ,EAAE,KAJE;AAKZiB,UAAAA,aAAa,EAAE,CAAC,KAAK7C,KAAL,CAAWgC,WAAZ,CALH;AAMZA,UAAAA,WAAW,EAAE,KAAKhC,KAAL,CAAWgC;AANZ,SAAd;AAQD;AACF;;;WAED,yCAAyC;AAAA;;AACvC,aACE,+BAAKhC,KAAL,CAAWqB,cAAX,gFAA2B2D,uBAA3B,MAAuD,KAAvD,IACA,0BAAC,KAAKhF,KAAL,CAAWiF,QAAZ,iDAAC,qBAAqBC,OAAtB,CAFF;AAID;;;WAED,8BACEC,IADF,EAEEC,YAFF,EAGQ;AACN,UAAI3G,eAAe,CAACyF,SAAhB,IAA6BzF,eAAe,CAAC4G,IAA7C,IAAqDF,IAAzD,EAA+D;AAC7DA,QAAAA,IAAI,CAACG,mBAAL,CACE7G,eAAe,CAAC4G,IADlB,EAEED,YAFF;AAIAD,QAAAA,IAAI,CAACI,gBAAL,CACE9G,eAAe,CAAC4G,IADlB,EAEED,YAFF;AAID,OATD,MASO;AACL,YAAI,KAAKI,uBAAT,EAAkC;AAChCpB,UAAAA,YAAY,CAAC,KAAKoB,uBAAN,CAAZ;AACD;;AAED,aAAKA,uBAAL,GAA+BnB,UAAU,CACvCe,YADuC,EAEvC,KAAKpF,KAAL,CAAWoB,QAAX,KAAwBvC,OAAxB,IAAmC,KAAKmB,KAAL,CAAWoB,QAAX,KAAwBtC,KAA3D,GACI,GADJ,GAEI,GAJmC,CAAzC;AAMD;AACF;;;WAED,6BAA0B;AAAA;;AACxB,UAAI,OAAO,KAAKqC,MAAZ,KAAuB,WAAvB,sBAAsC,KAAK4B,QAA3C,2CAAsC,eAAe0C,aAAzD,EAAwE;AACrE,aAAK1C,QAAL,CAAc0C,aAAf,CAA6CC,IAA7C;AACD;AACF;;;WAED,mBAAUvC,EAAV,EAA6B;AAC3B,UAAIA,EAAE,KAAK,IAAX,EAAiB;AACf,eAAOlD,SAAP;AACD;;AACD,aAAO,KAAK0F,UAAL,CAAgBxC,EAAhB,CAAP;AACD;;;WAED,yBAAgB7C,SAAhB,EAAmCG,MAAnC,EAAoD;AAAA;;AAClD,UAAMuB,WAAW,GAAG,KAAKhC,KAAL,CAAWgC,WAA/B;;AAEA,UAAMwC,gBAAgB,GAAG,mBAAK,KAAKtC,OAAL,CAAa5B,SAAb,KAA2B,EAAhC,EAAqCkC,KAArC,CAA2C,CAA3C,EAA8C,CAAC,CAA/C,CAAzB;;AACA,UAAMiC,eAAe,sBAAQ,KAAKvC,OAAL,CAAaF,WAAb,KAA6B,EAArC,CAArB;;AACA,UAAMuC,cAAc,GAAG9D,MAAM,GAAGgE,eAAe,CAACC,GAAhB,EAAH,GAA2B,CAAxD;;AACA,UAAIjE,MAAJ,EAAY;AAAA;;AACV,aAAKyB,OAAL,mCACK,KAAKA,OADV,6DAEG5B,SAFH,EAEekE,gBAFf,mCAGGxC,WAHH,EAGiByC,eAHjB;AAKD;;AAED,WAAK/C,QAAL,CACE;AACEpB,QAAAA,SAAS,EAAE,IADb;AAEEwC,QAAAA,SAAS,EAAE,IAFb;AAGED,QAAAA,aAAa,EAAE,CAACb,WAAD,CAHjB;AAIEA,QAAAA,WAAW,EAAEA,WAJf;AAKEJ,QAAAA,QAAQ,EAAE,KALZ;AAMEnB,QAAAA,MAAM,EAAER;AANV,OADF,EASE,YAAM;AAAA;;AACJ,+BAAA,MAAI,CAACD,KAAL,CAAWmC,MAAX,4EAAmBwC,QAAnB,CAA4B,CAA5B,EAA+BlE,MAAM,GAAG8D,cAAH,GAAoB,CAAzD;AACA,QAAA,MAAI,CAACvE,KAAL,CAAW4E,YAAX,IACE,MAAI,CAAC5E,KAAL,CAAW4E,YAAX,CAAwB;AAAEnE,UAAAA,MAAM,EAANA,MAAF;AAAUiD,UAAAA,IAAI,EAAEpD,SAAhB;AAA2BqD,UAAAA,EAAE,EAAE3B;AAA/B,SAAxB,CADF;AAED,OAbH;AAeD;;;WAkCD,8BAA2B;AACzB,WAAKhC,KAAL,CAAW2B,WAAX,IAA0B,KAAK3B,KAAL,CAAW2B,WAAX,EAA1B;AACD;;;WAED,6BAA0B;AACxB,WAAK3B,KAAL,CAAWgB,iBAAX,IAAgC,KAAKhB,KAAL,CAAWgB,iBAAX,EAAhC;AACA,WAAKU,QAAL,CAAc;AACZa,QAAAA,kBAAkB,EAAE,IADR;AAEZ1B,QAAAA,kBAAkB,EAAE,IAFR;AAGZgB,QAAAA,WAAW,EAAE,KAHD;AAIZf,QAAAA,eAAe,EAAE,IAJL;AAKZwB,QAAAA,eAAe,EAAE,CALL;AAMZG,QAAAA,cAAc,EAAE;AANJ,OAAd;AAQD;;;WAsFD,8BAAqBmD,OAArB,EAAuE;AACrE,UAAI,CAACvG,SAAD,IAAc,CAAC,KAAK8B,MAAxB,EAAgC;AAC9B,eAAO,EAAP;AACD;;AAED,UAAM0E,MAAM,GAAGD,OAAO,KAAK,KAAKvF,KAAL,CAAWkC,kBAAtC;AACA,UAAMuD,MAAM,GAAGF,OAAO,KAAK,KAAKvF,KAAL,CAAWQ,kBAAtC;;AAEA,UAAK,CAACgF,MAAD,IAAW,CAACC,MAAb,IAAwB,KAAKzF,KAAL,CAAWS,eAAvC,EAAwD;AACtD,eAAO,EAAP;AACD;;AAED,UAAIiF,kBAAkB,aAAM,KAAK1F,KAAL,CAAWoC,cAAjB,OAAtB;AACA,UAAIuD,kBAAkB,aACpB,CAAC,EAAD,GAAO,KAAK3F,KAAL,CAAWoC,cAAX,GAA4B,GAA7B,GAAoC,KAAKtB,MAAL,CAAYK,UAAhD,GAA6D,CAD/C,MAAtB;AAGA,UAAIyE,eAAe,GAChB,OAAO,KAAK9E,MAAL,CAAYK,UAAZ,GAAyB,KAAKnB,KAAL,CAAWoC,cAA3C,CAAD,GACA,KAAKtB,MAAL,CAAYK,UAFd;;AAIA,UAAI,KAAKnB,KAAL,CAAWS,eAAf,EAAgC;AAC9B,eAAO+E,MAAM,GACT;AAAEK,UAAAA,SAAS,sCAA+BD,eAA/B;AAAX,SADS,GAET,EAFJ;AAGD;;AAED,UAAIH,MAAJ,EAAY;AACV,eAAO;AACLK,UAAAA,SAAS,wBAAiBH,kBAAjB,YADJ;AAELI,UAAAA,eAAe,wBAAiBJ,kBAAjB;AAFV,SAAP;AAID;;AACD,UAAIH,MAAJ,EAAY;AACV,eAAO;AACLM,UAAAA,SAAS,wBAAiBJ,kBAAjB,YADJ;AAELK,UAAAA,eAAe,wBAAiBL,kBAAjB,YAFV;AAGLG,UAAAA,SAAS,sCAA+BD,eAA/B;AAHJ,SAAP;AAKD;;AAED,aAAO,EAAP;AACD;;;WAED,kBAAS;AAAA;;AACP,yBAmBI,KAAKjG,KAnBT;AAAA,UACEsD,MADF,gBACEA,MADF;AAAA,UAEEE,KAFF,gBAEEA,KAFF;AAAA,UAGEpC,QAHF,gBAGEA,QAHF;AAAA,UAIeiF,EAJf,gBAIErE,WAJF;AAAA,UAKEiD,QALF,gBAKEA,QALF;AAAA,UAME5D,cANF,gBAMEA,cANF;AAAA,UAOES,OAPF,gBAOEA,OAPF;AAAA,UAQEqB,EARF,gBAQEA,EARF;AAAA,UASEmD,GATF,gBASEA,GATF;AAAA,UAUE1B,YAVF,gBAUEA,YAVF;AAAA,UAWEjD,WAXF,gBAWEA,WAXF;AAAA,UAYEkD,gBAZF,gBAYEA,gBAZF;AAAA,UAaE7D,iBAbF,gBAaEA,iBAbF;AAAA,UAcEG,MAdF,gBAcEA,MAdF;AAAA,UAeE4B,QAfF,gBAeEA,QAfF;AAAA,UAgBEZ,MAhBF,gBAgBEA,MAhBF;AAAA,UAiBEsB,WAjBF,gBAiBEA,WAjBF;AAAA,UAkBK8C,SAlBL;;AAoBA,wBAUI,KAAKlG,KAVT;AAAA,UACEC,SADF,eACEA,SADF;AAAA,UAEEwC,SAFF,eAEEA,SAFF;AAAA,UAGEd,WAHF,eAGEA,WAHF;AAAA,UAIEvB,MAJF,eAIEA,MAJF;AAAA,UAKEmB,QALF,eAKEA,QALF;AAAA,UAMEW,kBANF,eAMEA,kBANF;AAAA,UAOE1B,kBAPF,eAOEA,kBAPF;AAAA,UAQEC,eARF,eAQEA,eARF;AAAA,UASEe,WATF,eASEA,WATF;AAYA,UAAM2E,SAAS,GAAG,CAAC,CAAClD,MAApB;AACA,UAAMmD,QAAQ,GAAG,CAAC,CAACjD,KAAnB;AAEA,UAAMK,MAAM,GAAG,KAAKA,MAAL,CACZ6C,MADY,CACL,UAAC3C,KAAD,EAAW;AACjB,YAAM6B,OAAO,GAAGnG,QAAQ,CAACsE,KAAK,CAAC/D,KAAP,EAAcJ,IAAd,CAAxB;AAEA,eACGgG,OAAO,KAAK3F,SAAZ,IACC,MAAI,CAACI,KAAL,CAAWwC,aAAX,CAAyB1C,QAAzB,CAAkCyF,OAAlC,CADF,IAEAA,OAAO,KAAKrD,kBAFZ,IAGAqD,OAAO,KAAK/E,kBAJd;AAMD,OAVY,EAWZ8F,IAXY,CAWP,UAAC5C,KAAD,EAAW;AACf,YAAM6B,OAAO,GAAGnG,QAAQ,CAACsE,KAAK,CAAC/D,KAAP,EAAcJ,IAAd,CAAxB;AACA,YAAMgH,WAAW,GACfhB,OAAO,KAAKtF,SAAZ,IAAyBsF,OAAO,KAAKrD,kBADvC;AAEA,YAAMsE,WAAW,GACfjB,OAAO,KAAK9C,SAAZ,IAAyB8C,OAAO,KAAK/E,kBADvC;;AAGA,YAAIgG,WAAJ,EAAiB;AACf,iBAAOhF,WAAW,IAAI,MAAI,CAACxB,KAAL,CAAWI,MAA1B,GAAmC,CAAC,CAApC,GAAwC,CAA/C;AACD;;AAED,YAAImG,WAAJ,EAAiB;AACf,iBAAO/E,WAAW,IAAI,MAAI,CAACxB,KAAL,CAAWI,MAA1B,GAAmC,CAAnC,GAAuC,CAAC,CAA/C;AACD;;AAED,eAAO,CAAP;AACD,OA3BY,CAAf;AA6BA,UAAMqG,gBAAgB,GAAG,KAAK7C,6BAAL,EAAzB;AAEA,UAAM8C,SAAS,GAAG;AAChB,0BAAkB,CAACD,gBAAD,IAAqB,KAAKzG,KAAL,CAAWuB,QADlC;AAEhB,8BAAsB,CAACkF,gBAAD,IAAqB,KAAKzG,KAAL,CAAWwB,WAFtC;AAGhB,2BAAmBiF;AAHH,OAAlB;AAMA,aACE,oBAAC,KAAD;AACE,QAAA,SAAS,EAAC;AADZ,SAEMP,SAFN;AAGE,QAAA,SAAS,EAAE/H,UAAU,CAACG,YAAY,CAAC,MAAD,EAASyC,QAAT,CAAb,EAAiC2F,SAAjC,CAHvB;AAIE,QAAA,OAAO,EAAE,KAAKC,OAJhB;AAKE,QAAA,KAAK,EAAE,KAAKC;AALd,UAOE;AAAK,QAAA,SAAS,EAAC;AAAf,SACGpD,MAAM,CAACC,GAAP,CAAW,UAACC,KAAD,EAA+B;AACzC,YAAM6B,OAAO,GAAGnG,QAAQ,CAACsE,KAAK,CAAC/D,KAAP,EAAcJ,IAAd,CAAxB;AACA,YAAMiG,MAAM,GACVD,OAAO,KAAKtF,SAAZ,IAAyBsF,OAAO,KAAKrD,kBADvC;AAEA,YAAM2E,gBAAgB,GACpBrB,MAAM,IACND,OAAO,KAAK/E,kBADZ,IAEC+E,OAAO,KAAK9C,SAAZ,IAAyBrC,MAH5B;AAIA,YAAM0G,kBAAkB,GACtBvF,QAAQ,IAAIgE,OAAO,MAAMnF,MAAM,GAAGH,SAAH,GAAewC,SAA3B,CADrB;AAEA,YAAMsE,UAAU,GAAIxB,OAAO,IAAI,MAAI,CAAC1D,OAAL,CAAa0D,OAAb,CAAZ,IAAsC,EAAzD;AACA,YAAMzD,MAAM,GAAGiF,UAAU,CAACA,UAAU,CAACrF,MAAX,GAAoB,CAArB,CAAV,IAAqC,CAApD;AAEA,eACE;AACE,UAAA,SAAS,EAAEvD,UAAU,CAAC,aAAD,EAAgB;AACnC,mCAAuBoH,OAAO,KAAK5D,WADA;AAEnC,iCAAqB4D,OAAO,KAAKtF,SAFE;AAGnC,iCAAqBsF,OAAO,KAAK9C,SAHE;AAInC,4CACE8C,OAAO,KAAKrD,kBALqB;AAMnC,4CACEqD,OAAO,KAAK/E,kBAPqB;AAQnC,+CACEC,eAAe,KAAKjB,gBAAgB,CAACoB,OATJ;AAUnC,8CACEH,eAAe,KAAKjB,gBAAgB,CAACkB;AAXJ,WAAhB,CADvB;AAcE,UAAA,cAAc,EACZoG,kBAAkB,GAAG,MAAI,CAAC7C,oBAAR,GAA+BrE,SAfrD;AAiBE,UAAA,GAAG,EAAE,aAACoH,EAAD;AAAA,mBACHzB,OAAO,KAAK3F,SAAZ,KAA0B,MAAI,CAAC0F,UAAL,CAAgBC,OAAhB,IAA2ByB,EAArD,CADG;AAAA,WAjBP;AAoBE,UAAA,KAAK,EAAE,MAAI,CAACC,oBAAL,CAA0B1B,OAA1B,CApBT;AAqBE,UAAA,GAAG,EAAEA;AArBP,WAuBE;AACE,UAAA,SAAS,EAAC,gBADZ;AAEE,UAAA,KAAK,EAAE;AAAE2B,YAAAA,SAAS,EAAEL,gBAAgB,GAAG,CAAC/E,MAAJ,GAAalC;AAA1C;AAFT,WAIE,oBAAC,qBAAD;AACE,UAAA,QAAQ,EACN2F,OAAO,KAAK9C,SAAZ,IAAyB8C,OAAO,KAAK/E;AAFzC,WAKGkD,KALH,CAJF,CAvBF,CADF;AAsCD,OAnDA,CADH,CAPF,EA6DE,oBAAC,aAAD,QACGyC,SAAS,IAAI;AAAK,QAAA,SAAS,EAAC;AAAf,SAA+BlD,MAA/B,CADhB,EAEGmD,QAAQ,IAAI;AAAK,QAAA,SAAS,EAAC;AAAf,SAA8BjD,KAA9B,CAFf,CA7DF,CADF;AAoED;;;;EArmBiCjF,KAAK,CAACiJ,S;;gBAApCzH,qB,kBA2B8C;AAChD+B,EAAAA,OAAO,EAAE;AADuC,C;;AA6kBpD,OAAO,IAAM2F,YAAY,GAAGxI,WAAW,CACrCA,WAAW,CACTA,WAAW,CACTD,YAAY,CAACM,OAAO,CAAoBS,qBAApB,CAAR,CADH,EAETZ,eAFS,EAGT,UAHS,CADF,EAMTD,qBANS,EAOT,gBAPS,CAD0B,EAUrCK,aAVqC,EAWrC,QAXqC,CAAhC","sourcesContent":["import * as React from \"react\";\nimport { classNames } from \"../../lib/classNames\";\nimport { transitionEvent, animationEvent } from \"../../lib/supportEvents\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { IOS, ANDROID, VKCOM } from \"../../lib/platform\";\nimport { Touch, TouchEvent } from \"../Touch/Touch\";\nimport { HasPlatform } from \"../../types\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport { withContext } from \"../../hoc/withContext\";\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n} from \"../ConfigProvider/ConfigProviderContext\";\nimport { SplitColContext, SplitColContextProps } from \"../SplitCol/SplitCol\";\nimport { AppRootPortal } from \"../AppRoot/AppRootPortal\";\nimport { canUseDOM, withDOM, DOMProps } from \"../../lib/dom\";\nimport {\n  ScrollContext,\n  ScrollContextInterface,\n} from \"../AppRoot/ScrollContext\";\nimport { NavTransitionProvider } from \"../NavTransitionContext/NavTransitionContext\";\nimport { getNavId, NavIdProps } from \"../../lib/getNavId\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { swipeBackExcluded } from \"./utils\";\nimport \"./View.css\";\n\nconst warn = warnOnce(\"ViewInfinite\");\n\nenum SwipeBackResults {\n  fail = 1,\n  success,\n}\n\ninterface Scrolls {\n  [index: string]: Array<number | undefined>;\n}\n\ninterface ViewsScrolls {\n  [index: string]: Scrolls;\n}\n\ntype TransitionEventHandler = (e?: TransitionEvent) => void;\n\nlet scrollsCache: ViewsScrolls = {};\n\nexport type TransitionParams = { from: string | null; to: string | null };\n\nexport interface ViewInfiniteProps\n  extends React.HTMLAttributes<HTMLElement>,\n    HasPlatform,\n    NavIdProps {\n  activePanel: string;\n  popout?: React.ReactNode;\n  modal?: React.ReactNode;\n  onTransition?(params: TransitionParams & { isBack: boolean }): void;\n  /**\n   * callback свайпа назад\n   */\n  onSwipeBack?(): void;\n  /**\n   * callback начала анимации свайпа назад.\n   */\n  onSwipeBackStart?(): void;\n  /**\n   * callback завершения анимации отмененного пользователем свайпа\n   */\n  onSwipeBackCancel?(): void;\n  history?: string[];\n  isBackCheck?(params: TransitionParams): boolean;\n  /**\n   * @ignore\n   */\n  splitCol?: SplitColContextProps;\n  /**\n   * @ignore\n   */\n  configProvider?: ConfigProviderContextInterface;\n  /**\n   * @ignore\n   */\n  scroll?: ScrollContextInterface;\n}\n\nexport interface ViewInfiniteState {\n  animated: boolean;\n\n  visiblePanels: Array<string | null>;\n  activePanel: string | null;\n  isBack?: boolean;\n  prevPanel: string | null;\n  nextPanel: string | null;\n\n  swipingBack: boolean;\n  swipebackStartX: number;\n  swipeBackShift: number;\n  swipeBackNextPanel: string | null;\n  swipeBackPrevPanel: string | null;\n  swipeBackResult: SwipeBackResults | null;\n\n  browserSwipe: boolean;\n}\n\nclass ViewInfiniteComponent extends React.Component<\n  ViewInfiniteProps & DOMProps,\n  ViewInfiniteState\n> {\n  constructor(props: ViewInfiniteProps) {\n    super(props);\n\n    this.state = {\n      animated: false,\n\n      visiblePanels: [props.activePanel],\n      activePanel: props.activePanel,\n      isBack: undefined,\n      prevPanel: null,\n      nextPanel: null,\n\n      swipingBack: false,\n      swipebackStartX: 0,\n      swipeBackShift: 0,\n      swipeBackNextPanel: null,\n      swipeBackPrevPanel: null,\n      swipeBackResult: null,\n\n      browserSwipe: false,\n    };\n  }\n\n  static defaultProps: Partial<ViewInfiniteProps> = {\n    history: [],\n  };\n\n  private scrolls = scrollsCache[getNavId(this.props, warn) as string] || {};\n  private transitionFinishTimeout: number | undefined = undefined;\n  private animationFinishTimeout: number | undefined = undefined;\n\n  get document() {\n    return this.props.document;\n  }\n\n  get window() {\n    return this.props.window;\n  }\n\n  get panels() {\n    return React.Children.toArray(this.props.children) as React.ReactElement[];\n  }\n\n  panelNodes: { [id: string]: HTMLDivElement | null } = {};\n\n  componentWillUnmount() {\n    const id = getNavId(this.props);\n    if (id) {\n      scrollsCache[id] = this.scrolls;\n    }\n  }\n\n  componentDidUpdate(\n    prevProps: ViewInfiniteProps,\n    prevState: ViewInfiniteState\n  ) {\n    this.props.popout && !prevProps.popout && this.blurActiveElement();\n    this.props.modal && !prevProps.modal && this.blurActiveElement();\n\n    // Нужен переход\n    if (\n      prevProps.activePanel !== this.props.activePanel &&\n      !prevState.swipingBack &&\n      !prevState.browserSwipe\n    ) {\n      let isBack = false;\n\n      if (this.props.isBackCheck) {\n        isBack = this.props.isBackCheck({\n          from: prevProps.activePanel,\n          to: this.props.activePanel,\n        });\n      } else {\n        const firstLayerId = this.panels\n          .map((panel) => getNavId(panel.props, warn))\n          .find(\n            (id) =>\n              id === prevProps.activePanel || id === this.props.activePanel\n          );\n        isBack = firstLayerId === this.props.activePanel;\n      }\n\n      this.blurActiveElement();\n\n      const prevScrolls = this.scrolls[prevProps.activePanel] || [];\n      const scrolls = {\n        ...this.scrolls,\n        [prevProps.activePanel]: [\n          ...prevScrolls,\n          this.props.scroll?.getScroll().y,\n        ],\n      };\n      this.scrolls = scrolls;\n\n      if (this.shouldDisableTransitionMotion()) {\n        this.flushTransition(prevProps.activePanel, isBack);\n      } else {\n        this.setState({\n          visiblePanels: [prevProps.activePanel, this.props.activePanel],\n          prevPanel: prevProps.activePanel,\n          nextPanel: this.props.activePanel,\n          activePanel: null,\n          animated: true,\n          isBack,\n        });\n\n        // Фолбек анимации перехода\n        if (!animationEvent.supported) {\n          if (this.animationFinishTimeout) {\n            clearTimeout(this.animationFinishTimeout);\n          }\n          this.animationFinishTimeout = setTimeout(\n            this.transitionEndHandler,\n            this.props.platform === ANDROID || this.props.platform === VKCOM\n              ? 300\n              : 600\n          );\n        }\n      }\n    }\n\n    // Закончилась анимация свайпа назад\n    if (\n      prevProps.activePanel !== this.props.activePanel &&\n      prevState.swipingBack\n    ) {\n      const nextPanel = this.state.swipeBackNextPanel;\n      const prevPanel = this.state.swipeBackPrevPanel;\n      let scrollPosition: undefined | number = undefined;\n\n      this.scrolls = {\n        ...this.scrolls,\n      };\n\n      if (prevPanel !== null) {\n        const prevPanelScrolls = [...(this.scrolls[prevPanel] || [])].slice(\n          0,\n          -1\n        );\n        this.scrolls[prevPanel] = prevPanelScrolls;\n      }\n      if (nextPanel !== null) {\n        const newPanelScrolls = [...(this.scrolls[nextPanel] || [])];\n        scrollPosition = newPanelScrolls.pop();\n        this.scrolls[nextPanel] = newPanelScrolls;\n      }\n\n      this.setState(\n        {\n          swipeBackPrevPanel: null,\n          swipeBackNextPanel: null,\n          swipingBack: false,\n          swipeBackResult: null,\n          swipebackStartX: 0,\n          swipeBackShift: 0,\n          activePanel: nextPanel,\n          visiblePanels: [nextPanel],\n        },\n        () => {\n          this.props.scroll?.scrollTo(0, scrollPosition);\n          prevProps.onTransition &&\n            prevProps.onTransition({\n              isBack: true,\n              from: prevPanel,\n              to: nextPanel,\n            });\n        }\n      );\n    }\n\n    // Начался свайп назад\n    if (!prevState.swipingBack && this.state.swipingBack) {\n      this.props.onSwipeBackStart && this.props.onSwipeBackStart();\n    }\n\n    // Началась анимация завершения свайпа назад.\n    if (!prevState.swipeBackResult && this.state.swipeBackResult) {\n      this.waitTransitionFinish(\n        this.pickPanel(this.state.swipeBackNextPanel),\n        this.swipingBackTransitionEndHandler\n      );\n    }\n\n    // Если свайп назад отменился (когда пользователь недостаточно сильно свайпнул)\n    if (\n      prevState.swipeBackResult === SwipeBackResults.fail &&\n      !this.state.swipeBackResult &&\n      this.state.activePanel !== null\n    ) {\n      const newPanelScrolls = [...(this.scrolls[this.state.activePanel] || [])];\n      const scrollPosition = newPanelScrolls.pop();\n      this.scrolls = {\n        ...this.scrolls,\n        [this.state.activePanel]: newPanelScrolls,\n      };\n\n      this.props.scroll?.scrollTo(0, scrollPosition);\n    }\n\n    // Закончился Safari свайп\n    if (\n      prevProps.activePanel !== this.props.activePanel &&\n      this.state.browserSwipe\n    ) {\n      this.setState({\n        browserSwipe: false,\n        nextPanel: null,\n        prevPanel: null,\n        animated: false,\n        visiblePanels: [this.props.activePanel],\n        activePanel: this.props.activePanel,\n      });\n    }\n  }\n\n  shouldDisableTransitionMotion(): boolean {\n    return (\n      this.props.configProvider?.transitionMotionEnabled === false ||\n      !this.props.splitCol?.animate\n    );\n  }\n\n  waitTransitionFinish(\n    elem: HTMLElement | null | undefined,\n    eventHandler: TransitionEventHandler\n  ): void {\n    if (transitionEvent.supported && transitionEvent.name && elem) {\n      elem.removeEventListener(\n        transitionEvent.name as keyof HTMLElementEventMap,\n        eventHandler as EventListener\n      );\n      elem.addEventListener(\n        transitionEvent.name as keyof HTMLElementEventMap,\n        eventHandler as EventListener\n      );\n    } else {\n      if (this.transitionFinishTimeout) {\n        clearTimeout(this.transitionFinishTimeout);\n      }\n\n      this.transitionFinishTimeout = setTimeout(\n        eventHandler,\n        this.props.platform === ANDROID || this.props.platform === VKCOM\n          ? 300\n          : 600\n      );\n    }\n  }\n\n  blurActiveElement(): void {\n    if (typeof this.window !== \"undefined\" && this.document?.activeElement) {\n      (this.document.activeElement as HTMLElement).blur();\n    }\n  }\n\n  pickPanel(id: string | null) {\n    if (id === null) {\n      return undefined;\n    }\n    return this.panelNodes[id];\n  }\n\n  flushTransition(prevPanel: string, isBack: boolean) {\n    const activePanel = this.props.activePanel;\n\n    const prevPanelScrolls = [...(this.scrolls[prevPanel] || [])].slice(0, -1);\n    const newPanelScrolls = [...(this.scrolls[activePanel] || [])];\n    const scrollPosition = isBack ? newPanelScrolls.pop() : 0;\n    if (isBack) {\n      this.scrolls = {\n        ...this.scrolls,\n        [prevPanel]: prevPanelScrolls,\n        [activePanel]: newPanelScrolls,\n      };\n    }\n\n    this.setState(\n      {\n        prevPanel: null,\n        nextPanel: null,\n        visiblePanels: [activePanel],\n        activePanel: activePanel,\n        animated: false,\n        isBack: undefined,\n      },\n      () => {\n        this.props.scroll?.scrollTo(0, isBack ? scrollPosition : 0);\n        this.props.onTransition &&\n          this.props.onTransition({ isBack, from: prevPanel, to: activePanel });\n      }\n    );\n  }\n\n  transitionEndHandler = (e?: React.AnimationEvent): void => {\n    if (\n      (!e ||\n        [\n          \"vkui-animation-ios-next-forward\",\n          \"vkui-animation-ios-prev-back\",\n          \"vkui-animation-view-next-forward\",\n          \"vkui-animation-view-prev-back\",\n        ].includes(e.animationName)) &&\n      this.state.prevPanel !== null\n    ) {\n      this.flushTransition(this.state.prevPanel, Boolean(this.state.isBack));\n    }\n  };\n\n  swipingBackTransitionEndHandler = (e?: TransitionEvent): void => {\n    // indexOf because of vendor prefixes in old browsers\n    if (\n      !e ||\n      (e.propertyName.includes(\"transform\") &&\n        e.target === this.pickPanel(this.state.swipeBackNextPanel))\n    ) {\n      switch (this.state.swipeBackResult) {\n        case SwipeBackResults.fail:\n          this.onSwipeBackCancel();\n          break;\n        case SwipeBackResults.success:\n          this.onSwipeBackSuccess();\n      }\n    }\n  };\n\n  onSwipeBackSuccess(): void {\n    this.props.onSwipeBack && this.props.onSwipeBack();\n  }\n\n  onSwipeBackCancel(): void {\n    this.props.onSwipeBackCancel && this.props.onSwipeBackCancel();\n    this.setState({\n      swipeBackPrevPanel: null,\n      swipeBackNextPanel: null,\n      swipingBack: false,\n      swipeBackResult: null,\n      swipebackStartX: 0,\n      swipeBackShift: 0,\n    });\n  }\n\n  onMoveX = (e: TouchEvent): void => {\n    if (swipeBackExcluded(e) || !this.window) {\n      return;\n    }\n\n    const { platform, configProvider } = this.props;\n\n    if (\n      platform === IOS &&\n      !configProvider?.isWebView &&\n      (e.startX <= 70 || e.startX >= this.window.innerWidth - 70) &&\n      !this.state.browserSwipe\n    ) {\n      this.setState({ browserSwipe: true });\n    }\n\n    if (\n      platform === IOS &&\n      configProvider?.isWebView &&\n      this.props.onSwipeBack\n    ) {\n      if (this.state.animated && e.startX <= 70) {\n        return;\n      }\n\n      if (\n        e.startX <= 70 &&\n        !this.state.swipingBack &&\n        (this.props.history?.length ?? 0) > 1\n      ) {\n        if (this.state.activePanel !== null) {\n          const prevScrolls = this.scrolls[this.state.activePanel] || [];\n          this.scrolls = {\n            ...this.scrolls,\n            [this.state.activePanel]: [\n              ...prevScrolls,\n              this.props.scroll?.getScroll().y,\n            ],\n          };\n        }\n\n        this.setState({\n          swipingBack: true,\n          swipebackStartX: e.startX,\n          swipeBackPrevPanel: this.state.activePanel,\n          swipeBackNextPanel: this.props.history!.slice(-2)[0],\n        });\n      }\n      if (this.state.swipingBack) {\n        let swipeBackShift;\n        if (e.shiftX < 0) {\n          swipeBackShift = 0;\n        } else if (\n          e.shiftX >\n          this.window.innerWidth - this.state.swipebackStartX\n        ) {\n          swipeBackShift = this.window.innerWidth;\n        } else {\n          swipeBackShift = e.shiftX;\n        }\n        this.setState({ swipeBackShift });\n      }\n    }\n  };\n\n  onEnd = (e: TouchEvent): void => {\n    if (this.state.swipingBack && this.window) {\n      const speed = (this.state.swipeBackShift / e.duration) * 1000;\n      if (this.state.swipeBackShift === 0) {\n        this.onSwipeBackCancel();\n      } else if (this.state.swipeBackShift >= this.window.innerWidth) {\n        this.onSwipeBackSuccess();\n      } else if (\n        speed > 250 ||\n        this.state.swipebackStartX + this.state.swipeBackShift >\n          this.window.innerWidth / 2\n      ) {\n        this.setState({ swipeBackResult: SwipeBackResults.success });\n      } else {\n        this.setState({ swipeBackResult: SwipeBackResults.fail });\n      }\n    }\n  };\n\n  calcPanelSwipeStyles(panelId: string | undefined): React.CSSProperties {\n    if (!canUseDOM || !this.window) {\n      return {};\n    }\n\n    const isPrev = panelId === this.state.swipeBackPrevPanel;\n    const isNext = panelId === this.state.swipeBackNextPanel;\n\n    if ((!isPrev && !isNext) || this.state.swipeBackResult) {\n      return {};\n    }\n\n    let prevPanelTranslate = `${this.state.swipeBackShift}px`;\n    let nextPanelTranslate = `${\n      -50 + (this.state.swipeBackShift * 100) / this.window.innerWidth / 2\n    }%`;\n    let prevPanelShadow =\n      (0.3 * (this.window.innerWidth - this.state.swipeBackShift)) /\n      this.window.innerWidth;\n\n    if (this.state.swipeBackResult) {\n      return isPrev\n        ? { boxShadow: `-2px 0 12px rgba(0, 0, 0, ${prevPanelShadow})` }\n        : {};\n    }\n\n    if (isNext) {\n      return {\n        transform: `translate3d(${nextPanelTranslate}, 0, 0)`,\n        WebkitTransform: `translate3d(${nextPanelTranslate}, 0, 0)`,\n      };\n    }\n    if (isPrev) {\n      return {\n        transform: `translate3d(${prevPanelTranslate}, 0, 0)`,\n        WebkitTransform: `translate3d(${prevPanelTranslate}, 0, 0)`,\n        boxShadow: `-2px 0 12px rgba(0, 0, 0, ${prevPanelShadow})`,\n      };\n    }\n\n    return {};\n  }\n\n  render() {\n    const {\n      popout,\n      modal,\n      platform,\n      activePanel: _1,\n      splitCol,\n      configProvider,\n      history,\n      id,\n      nav,\n      onTransition,\n      onSwipeBack,\n      onSwipeBackStart,\n      onSwipeBackCancel,\n      window,\n      document,\n      scroll,\n      isBackCheck,\n      ...restProps\n    } = this.props;\n    const {\n      prevPanel,\n      nextPanel,\n      activePanel,\n      isBack,\n      animated,\n      swipeBackPrevPanel,\n      swipeBackNextPanel,\n      swipeBackResult,\n      swipingBack,\n    } = this.state;\n\n    const hasPopout = !!popout;\n    const hasModal = !!modal;\n\n    const panels = this.panels\n      .filter((panel) => {\n        const panelId = getNavId(panel.props, warn);\n\n        return (\n          (panelId !== undefined &&\n            this.state.visiblePanels.includes(panelId)) ||\n          panelId === swipeBackPrevPanel ||\n          panelId === swipeBackNextPanel\n        );\n      })\n      .sort((panel) => {\n        const panelId = getNavId(panel.props, warn);\n        const isPrevPanel =\n          panelId === prevPanel || panelId === swipeBackPrevPanel;\n        const isNextPanel =\n          panelId === nextPanel || panelId === swipeBackNextPanel;\n\n        if (isNextPanel) {\n          return swipingBack || this.state.isBack ? -1 : 1;\n        }\n\n        if (isPrevPanel) {\n          return swipingBack || this.state.isBack ? 1 : -1;\n        }\n\n        return 0;\n      });\n\n    const disableAnimation = this.shouldDisableTransitionMotion();\n\n    const modifiers = {\n      \"View--animated\": !disableAnimation && this.state.animated,\n      \"View--swiping-back\": !disableAnimation && this.state.swipingBack,\n      \"View--no-motion\": disableAnimation,\n    };\n\n    return (\n      <Touch\n        Component=\"section\"\n        {...restProps}\n        vkuiClass={classNames(getClassName(\"View\", platform), modifiers)}\n        onMoveX={this.onMoveX}\n        onEnd={this.onEnd}\n      >\n        <div vkuiClass=\"View__panels\">\n          {panels.map((panel: React.ReactElement) => {\n            const panelId = getNavId(panel.props, warn);\n            const isPrev =\n              panelId === prevPanel || panelId === swipeBackPrevPanel;\n            const compensateScroll =\n              isPrev ||\n              panelId === swipeBackNextPanel ||\n              (panelId === nextPanel && isBack);\n            const isTransitionTarget =\n              animated && panelId === (isBack ? prevPanel : nextPanel);\n            const scrollList = (panelId && this.scrolls[panelId]) || [];\n            const scroll = scrollList[scrollList.length - 1] || 0;\n\n            return (\n              <div\n                vkuiClass={classNames(\"View__panel\", {\n                  \"View__panel--active\": panelId === activePanel,\n                  \"View__panel--prev\": panelId === prevPanel,\n                  \"View__panel--next\": panelId === nextPanel,\n                  \"View__panel--swipe-back-prev\":\n                    panelId === swipeBackPrevPanel,\n                  \"View__panel--swipe-back-next\":\n                    panelId === swipeBackNextPanel,\n                  \"View__panel--swipe-back-success\":\n                    swipeBackResult === SwipeBackResults.success,\n                  \"View__panel--swipe-back-failed\":\n                    swipeBackResult === SwipeBackResults.fail,\n                })}\n                onAnimationEnd={\n                  isTransitionTarget ? this.transitionEndHandler : undefined\n                }\n                ref={(el) =>\n                  panelId !== undefined && (this.panelNodes[panelId] = el)\n                }\n                style={this.calcPanelSwipeStyles(panelId)}\n                key={panelId}\n              >\n                <div\n                  vkuiClass=\"View__panel-in\"\n                  style={{ marginTop: compensateScroll ? -scroll : undefined }}\n                >\n                  <NavTransitionProvider\n                    entering={\n                      panelId === nextPanel || panelId === swipeBackNextPanel\n                    }\n                  >\n                    {panel}\n                  </NavTransitionProvider>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n        <AppRootPortal>\n          {hasPopout && <div vkuiClass=\"View__popout\">{popout}</div>}\n          {hasModal && <div vkuiClass=\"View__modal\">{modal}</div>}\n        </AppRootPortal>\n      </Touch>\n    );\n  }\n}\n\nexport const ViewInfinite = withContext(\n  withContext(\n    withContext(\n      withPlatform(withDOM<ViewInfiniteProps>(ViewInfiniteComponent)),\n      SplitColContext,\n      \"splitCol\"\n    ),\n    ConfigProviderContext,\n    \"configProvider\"\n  ),\n  ScrollContext,\n  \"scroll\"\n);\n"],"file":"ViewInfinite.js"}