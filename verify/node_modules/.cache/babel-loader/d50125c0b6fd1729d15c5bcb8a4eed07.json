{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _createSuper from \"@babel/runtime/helpers/createSuper\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _typeof from \"@babel/runtime/helpers/typeof\";\nvar _excluded = [\"searchable\", \"name\", \"className\", \"getRef\", \"getRootRef\", \"popupDirection\", \"options\", \"sizeY\", \"platform\", \"style\", \"onChange\", \"onBlur\", \"onFocus\", \"onClick\", \"renderOption\", \"children\", \"emptyText\", \"onInputChange\", \"filterFn\", \"renderDropdown\", \"onOpen\", \"onClose\", \"fetching\", \"icon\", \"dropdownOffsetDistance\", \"fixDropdownWidth\", \"forceDropdownPortal\"],\n    _excluded2 = [\"option\"];\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport * as React from \"react\";\nimport SelectMimicry from \"../SelectMimicry/SelectMimicry\";\nimport { debounce, setRef, multiRef } from \"../../lib/utils\";\nimport { classNames } from \"../../lib/classNames\";\nimport { withAdaptivity } from \"../../hoc/withAdaptivity\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport CustomSelectOption from \"../CustomSelectOption/CustomSelectOption\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport Input from \"../Input/Input\";\nimport { DropdownIcon } from \"../DropdownIcon/DropdownIcon\";\nimport { Caption } from \"../Typography/Caption/Caption\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { defaultFilterFn } from \"../../lib/select\";\nimport { is } from \"../../lib/is\";\nimport { CustomSelectDropdown } from \"../CustomSelectDropdown/CustomSelectDropdown\";\n\nvar findIndexAfter = function findIndexAfter() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var startIndex = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : -1;\n\n  if (startIndex >= options.length - 1) {\n    return -1;\n  }\n\n  return options.findIndex(function (option, i) {\n    return i > startIndex && !option.disabled;\n  });\n};\n\nvar findIndexBefore = function findIndexBefore() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var endIndex = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : options.length;\n  var result = -1;\n\n  if (options === undefined || endIndex <= 0) {\n    return result;\n  }\n\n  for (var i = endIndex - 1; i >= 0; i--) {\n    var _option = options[i];\n\n    if (!_option.disabled) {\n      result = i;\n      break;\n    }\n  }\n\n  return result;\n};\n\nvar warn = warnOnce(\"CustomSelect\");\n\nvar checkOptionsValueType = function checkOptionsValueType(options) {\n  if (new Set(options.map(function (item) {\n    return _typeof(item.value);\n  })).size > 1) {\n    warn(\"Some values of your options have different types. CustomSelect onChange always returns a string type.\");\n  }\n};\n\nexport var SelectType;\n\n(function (SelectType) {\n  SelectType[\"Default\"] = \"default\";\n  SelectType[\"Plain\"] = \"plain\";\n})(SelectType || (SelectType = {}));\n\nvar CustomSelect = /*#__PURE__*/function (_React$Component) {\n  _inherits(CustomSelect, _React$Component);\n\n  var _super = _createSuper(CustomSelect);\n\n  function CustomSelect(props) {\n    var _this;\n\n    _classCallCheck(this, CustomSelect);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"keyboardInput\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"isControlledOutside\", false);\n\n    _defineProperty(_assertThisInitialized(_this), \"selectEl\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"scrollBoxRef\", /*#__PURE__*/React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"containerRef\", /*#__PURE__*/React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"resetKeyboardInput\", function () {\n      _this.keyboardInput = \"\";\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getSelectedItem\", function () {\n      var _this$state = _this.state,\n          selectedOptionIndex = _this$state.selectedOptionIndex,\n          options = _this$state.options;\n\n      if (!(options !== null && options !== void 0 && options.length)) {\n        return null;\n      }\n\n      return selectedOptionIndex !== undefined ? options[selectedOptionIndex] : undefined;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"filter\", function (options, inputValue, filterFn) {\n      return typeof filterFn === \"function\" ? options.filter(function (option) {\n        return filterFn(inputValue, option);\n      }) : options;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"open\", function () {\n      _this.setState(function (_ref) {\n        var selectedOptionIndex = _ref.selectedOptionIndex;\n        return {\n          opened: true,\n          focusedOptionIndex: selectedOptionIndex\n        };\n      }, function () {\n        var selectedOptionIndex = _this.state.selectedOptionIndex;\n\n        if (selectedOptionIndex !== undefined && _this.isValidIndex(selectedOptionIndex)) {\n          _this.scrollToElement(selectedOptionIndex, true);\n        }\n      });\n\n      typeof _this.props.onOpen === \"function\" && _this.props.onOpen();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"close\", function () {\n      _this.resetKeyboardInput();\n\n      _this.setState(function () {\n        return {\n          inputValue: \"\",\n          opened: false,\n          focusedOptionIndex: -1,\n          options: _this.props.options\n        };\n      });\n\n      typeof _this.props.onClose === \"function\" && _this.props.onClose();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"selectFocused\", function () {\n      var focusedOptionIndex = _this.state.focusedOptionIndex;\n\n      if (focusedOptionIndex !== undefined) {\n        _this.select(focusedOptionIndex);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"select\", function (index) {\n      var _this$state$options;\n\n      if (!_this.isValidIndex(index)) {\n        return;\n      }\n\n      var item = (_this$state$options = _this.state.options) === null || _this$state$options === void 0 ? void 0 : _this$state$options[index];\n\n      _this.setState({\n        nativeSelectValue: item === null || item === void 0 ? void 0 : item.value\n      }, function () {\n        var _this$selectEl;\n\n        var event = new Event(\"change\", {\n          bubbles: true\n        });\n        (_this$selectEl = _this.selectEl) === null || _this$selectEl === void 0 ? void 0 : _this$selectEl.dispatchEvent(event);\n      });\n\n      _this.close();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onClick\", function () {\n      _this.state.opened ? _this.close() : _this.open();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onFocus\", function () {\n      var _this$selectEl2;\n\n      var event = new Event(\"focus\");\n      (_this$selectEl2 = _this.selectEl) === null || _this$selectEl2 === void 0 ? void 0 : _this$selectEl2.dispatchEvent(event);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onBlur\", function () {\n      var _this$selectEl3;\n\n      _this.close();\n\n      var event = new Event(\"blur\");\n      (_this$selectEl3 = _this.selectEl) === null || _this$selectEl3 === void 0 ? void 0 : _this$selectEl3.dispatchEvent(event);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"focusOptionByIndex\", function (index) {\n      var _this$state$options$l, _this$state$options2, _this$state$options3;\n\n      var scrollTo = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n      if (index === undefined || index < 0 || index > ((_this$state$options$l = (_this$state$options2 = _this.state.options) === null || _this$state$options2 === void 0 ? void 0 : _this$state$options2.length) !== null && _this$state$options$l !== void 0 ? _this$state$options$l : 0) - 1) {\n        return;\n      }\n\n      var option = (_this$state$options3 = _this.state.options) === null || _this$state$options3 === void 0 ? void 0 : _this$state$options3[index];\n\n      if (option !== null && option !== void 0 && option.disabled) {\n        return;\n      }\n\n      scrollTo && _this.scrollToElement(index);\n\n      _this.setState(function (prevState) {\n        return (// Это оптимизация, прежде всего, под `onMouseOver`\n          prevState.focusedOptionIndex !== index ? {\n            focusedOptionIndex: index\n          } : null\n        );\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"focusOption\", function (type) {\n      var focusedOptionIndex = _this.state.focusedOptionIndex;\n      var index = focusedOptionIndex;\n\n      if (type === \"next\") {\n        var nextIndex = findIndexAfter(_this.state.options, index);\n        index = nextIndex === -1 ? findIndexAfter(_this.state.options) : nextIndex; // Следующий за index или первый валидный до index\n      } else if (type === \"prev\") {\n        var beforeIndex = findIndexBefore(_this.state.options, index);\n        index = beforeIndex === -1 ? findIndexBefore(_this.state.options) : beforeIndex; // Предшествующий index или последний валидный после index\n      }\n\n      _this.focusOptionByIndex(index);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleOptionHover\", function (e) {\n      var _e$currentTarget$pare;\n\n      _this.focusOptionByIndex(Array.prototype.indexOf.call((_e$currentTarget$pare = e.currentTarget.parentNode) === null || _e$currentTarget$pare === void 0 ? void 0 : _e$currentTarget$pare.children, e.currentTarget), false);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleOptionDown\", function (e) {\n      e.preventDefault();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleOptionClick\", function (e) {\n      var _e$currentTarget$pare2, _this$state$options4;\n\n      var index = Array.prototype.indexOf.call((_e$currentTarget$pare2 = e.currentTarget.parentNode) === null || _e$currentTarget$pare2 === void 0 ? void 0 : _e$currentTarget$pare2.children, e.currentTarget);\n      var option = (_this$state$options4 = _this.state.options) === null || _this$state$options4 === void 0 ? void 0 : _this$state$options4[index];\n\n      if (option && !option.disabled) {\n        _this.selectFocused();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"resetFocusedOption\", function () {\n      _this.setState({\n        focusedOptionIndex: -1\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onKeyboardInput\", function (key) {\n      var _this$state$options5;\n\n      var fullInput = _this.keyboardInput + key;\n      var optionIndex = (_this$state$options5 = _this.state.options) === null || _this$state$options5 === void 0 ? void 0 : _this$state$options5.findIndex(function (option) {\n        return option.label.toLowerCase().includes(fullInput);\n      });\n\n      if (optionIndex !== undefined && optionIndex > -1) {\n        _this.focusOptionByIndex(optionIndex);\n      }\n\n      _this.keyboardInput = fullInput;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onLabelClick\", function (e) {\n      var _this$scrollBoxRef$cu;\n\n      if ((_this$scrollBoxRef$cu = _this.scrollBoxRef.current) !== null && _this$scrollBoxRef$cu !== void 0 && _this$scrollBoxRef$cu.contains(e.target)) {\n        e.preventDefault();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onNativeSelectChange\", function (e) {\n      var newSelectedOptionIndex = _this.findSelectedIndex(_this.state.options, e.currentTarget.value);\n\n      if (_this.state.selectedOptionIndex !== newSelectedOptionIndex) {\n        var _this$props$onChange, _this$props;\n\n        if (!_this.isControlledOutside) {\n          _this.setState({\n            selectedOptionIndex: newSelectedOptionIndex\n          });\n        }\n\n        (_this$props$onChange = (_this$props = _this.props).onChange) === null || _this$props$onChange === void 0 ? void 0 : _this$props$onChange.call(_this$props, e);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onInputChange\", function (e) {\n      if (_this.props.onInputChange) {\n        var _options = _this.props.onInputChange(e, _this.props.options);\n\n        if (_options) {\n          if (process.env.NODE_ENV === \"development\") {\n            warn(\"This filtration method is deprecated. Return value of onInputChange will\" + \" be ignored in v5.0.0. For custom filtration please update props.options by yourself or use filterFn property\");\n          }\n\n          _this.setState({\n            options: _options,\n            selectedOptionIndex: _this.findSelectedIndex(_options, _this.state.nativeSelectValue),\n            inputValue: e.target.value\n          });\n        } else {\n          _this.setState({\n            inputValue: e.target.value\n          });\n        }\n      } else {\n        var _options2 = _this.filter(_this.props.options, e.target.value, _this.props.filterFn);\n\n        _this.setState({\n          options: _options2,\n          selectedOptionIndex: _this.findSelectedIndex(_options2, _this.state.nativeSelectValue),\n          inputValue: e.target.value\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onInputKeyDown\", function (event) {\n      [\"ArrowUp\", \"ArrowDown\", \"Escape\", \"Enter\"].includes(event.key) && _this.areOptionsShown && event.preventDefault();\n\n      switch (event.key) {\n        case \"ArrowUp\":\n          _this.areOptionsShown && _this.focusOption(\"prev\");\n          break;\n\n        case \"ArrowDown\":\n          _this.areOptionsShown && _this.focusOption(\"next\");\n          break;\n\n        case \"Escape\":\n          _this.close();\n\n          break;\n\n        case \"Enter\":\n          _this.areOptionsShown && _this.selectFocused();\n          break;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleKeyDownSelect\", function (event) {\n      var opened = _this.state.opened;\n\n      if (event.key.length === 1 && event.key !== \" \") {\n        _this.onKeyboardInput(event.key);\n\n        return;\n      }\n\n      [\"ArrowUp\", \"ArrowDown\", \"Escape\", \"Enter\"].includes(event.key) && _this.areOptionsShown && event.preventDefault();\n\n      switch (event.key) {\n        case \"ArrowUp\":\n          if (opened) {\n            _this.areOptionsShown && _this.focusOption(\"prev\");\n          } else {\n            _this.open();\n          }\n\n          break;\n\n        case \"ArrowDown\":\n          if (opened) {\n            _this.areOptionsShown && _this.focusOption(\"next\");\n          } else {\n            _this.open();\n          }\n\n          break;\n\n        case \"Escape\":\n          _this.close();\n\n          break;\n\n        case \"Enter\":\n        case \"Spacebar\":\n        case \" \":\n          if (opened) {\n            _this.areOptionsShown && _this.selectFocused();\n          } else {\n            _this.open();\n          }\n\n          break;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleKeyUp\", debounce(_this.resetKeyboardInput, 1000));\n\n    _defineProperty(_assertThisInitialized(_this), \"renderOption\", function (option, index) {\n      var _this$state2 = _this.state,\n          focusedOptionIndex = _this$state2.focusedOptionIndex,\n          selectedOptionIndex = _this$state2.selectedOptionIndex;\n      var renderOption = _this.props.renderOption;\n      var hovered = index === focusedOptionIndex;\n      var selected = index === selectedOptionIndex;\n      return createScopedElement(React.Fragment, {\n        key: \"\".concat(option.value)\n      }, renderOption({\n        option: option,\n        hovered: hovered,\n        children: option.label,\n        selected: selected,\n        disabled: option.disabled,\n        onClick: _this.handleOptionClick,\n        onMouseDown: _this.handleOptionDown,\n        // Используем `onMouseOver` вместо `onMouseEnter`.\n        // При параметре `searchable`, обновляется \"ребёнок\", из-за чего `onMouseEnter` не срабатывает в следующих кейсах:\n        //  1. До загрузки выпадающего списка, курсор мышки находится над произвольным элементом этого списка.\n        //     > Лечение: только увод курсора мыши и возвращении его обратно вызывает событие `onMouseEnter` на этот элемент.\n        //  2. Если это тач-устройство.\n        //     > Лечение: нужно нажать на какой-нибудь произвольный элемент списка, после чего `onMouseEnter` будет работать на соседние элементы,\n        //     но не на тот, на который нажали в первый раз.\n        // Более подробно по ссылке https://github.com/facebook/react/issues/13956#issuecomment-1082055744\n        onMouseOver: _this.handleOptionHover\n      }));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"selectRef\", function (element) {\n      _this.selectEl = element;\n\n      if (_this.props.getRef) {\n        setRef(element, _this.props.getRef);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onPlacementChange\", function (placement) {\n      _this.setState(function () {\n        return {\n          popperPlacement: placement\n        };\n      });\n    });\n\n    var value = props.value,\n        defaultValue = props.defaultValue;\n    var initialValue = value !== undefined ? value : defaultValue;\n    _this.keyboardInput = \"\";\n\n    if (process.env.NODE_ENV === \"development\") {\n      checkOptionsValueType(props.options);\n    }\n\n    _this.state = {\n      opened: false,\n      focusedOptionIndex: -1,\n      selectedOptionIndex: _this.findSelectedIndex(props.options, initialValue),\n      nativeSelectValue: initialValue,\n      options: props.options,\n      inputValue: \"\"\n    };\n\n    if (props.value !== undefined) {\n      _this.isControlledOutside = true;\n    }\n\n    return _this;\n  }\n\n  _createClass(CustomSelect, [{\n    key: \"areOptionsShown\",\n    get: function get() {\n      return this.scrollBoxRef.current !== null;\n    }\n  }, {\n    key: \"findSelectedIndex\",\n    value: function findSelectedIndex(options, value) {\n      var _options$findIndex;\n\n      return (_options$findIndex = options === null || options === void 0 ? void 0 : options.findIndex(function (item) {\n        value = typeof item.value === \"number\" ? Number(value) : value;\n        return item.value === value;\n      })) !== null && _options$findIndex !== void 0 ? _options$findIndex : -1;\n    }\n  }, {\n    key: \"isValidIndex\",\n    value: function isValidIndex(index) {\n      var _this$state$options$l2, _this$state$options6;\n\n      return index >= 0 && index < ((_this$state$options$l2 = (_this$state$options6 = this.state.options) === null || _this$state$options6 === void 0 ? void 0 : _this$state$options6.length) !== null && _this$state$options$l2 !== void 0 ? _this$state$options$l2 : 0);\n    }\n  }, {\n    key: \"scrollToElement\",\n    value: function scrollToElement(index) {\n      var center = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var dropdown = this.scrollBoxRef.current;\n      var item = dropdown ? dropdown.children[index] : null;\n\n      if (!item || !dropdown) {\n        return;\n      }\n\n      var dropdownHeight = dropdown.offsetHeight;\n      var scrollTop = dropdown.scrollTop;\n      var itemTop = item.offsetTop;\n      var itemHeight = item.offsetHeight;\n\n      if (center) {\n        dropdown.scrollTop = itemTop - dropdownHeight / 2 + itemHeight / 2;\n      } else if (itemTop + itemHeight > dropdownHeight + scrollTop) {\n        dropdown.scrollTop = itemTop - dropdownHeight + itemHeight;\n      } else if (itemTop < scrollTop) {\n        dropdown.scrollTop = itemTop;\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      // Внутри useEffect и так is, можно убрать\n      if (!is(prevProps.value, this.props.value) || prevProps.options !== this.props.options) {\n        if (process.env.NODE_ENV === \"development\") {\n          checkOptionsValueType(this.props.options);\n        }\n\n        this.isControlledOutside = this.props.value !== undefined;\n\n        var _value = this.props.value === undefined ? this.state.nativeSelectValue : this.props.value;\n\n        var _options3 = this.props.searchable && this.state.inputValue !== undefined ? this.filter(this.props.options, this.state.inputValue, this.props.filterFn) : this.props.options;\n\n        this.setState({\n          nativeSelectValue: _value,\n          selectedOptionIndex: this.findSelectedIndex(_options3, _value),\n          options: _options3\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state$popperPla;\n\n      var _this$state3 = this.state,\n          opened = _this$state3.opened,\n          nativeSelectValue = _this$state3.nativeSelectValue,\n          stateOptions = _this$state3.options;\n\n      var _this$props2 = this.props,\n          searchable = _this$props2.searchable,\n          name = _this$props2.name,\n          className = _this$props2.className,\n          getRef = _this$props2.getRef,\n          getRootRef = _this$props2.getRootRef,\n          popupDirection = _this$props2.popupDirection,\n          options = _this$props2.options,\n          sizeY = _this$props2.sizeY,\n          platform = _this$props2.platform,\n          style = _this$props2.style,\n          onChange = _this$props2.onChange,\n          onBlur = _this$props2.onBlur,\n          onFocus = _this$props2.onFocus,\n          onClick = _this$props2.onClick,\n          renderOption = _this$props2.renderOption,\n          children = _this$props2.children,\n          emptyText = _this$props2.emptyText,\n          onInputChange = _this$props2.onInputChange,\n          filterFn = _this$props2.filterFn,\n          renderDropdown = _this$props2.renderDropdown,\n          onOpen = _this$props2.onOpen,\n          onClose = _this$props2.onClose,\n          fetching = _this$props2.fetching,\n          icon = _this$props2.icon,\n          dropdownOffsetDistance = _this$props2.dropdownOffsetDistance,\n          fixDropdownWidth = _this$props2.fixDropdownWidth,\n          forceDropdownPortal = _this$props2.forceDropdownPortal,\n          restProps = _objectWithoutProperties(_this$props2, _excluded);\n\n      var selected = this.getSelectedItem();\n      var label = selected ? selected.label : undefined;\n      var defaultDropdownContent = stateOptions !== undefined && stateOptions.length > 0 ? stateOptions.map(this.renderOption) : createScopedElement(Caption, {\n        vkuiClass: \"CustomSelect__empty\"\n      }, this.props.emptyText);\n      var resolvedContent;\n\n      if (typeof renderDropdown === \"function\") {\n        resolvedContent = renderDropdown({\n          defaultDropdownContent: defaultDropdownContent\n        });\n      } else {\n        resolvedContent = defaultDropdownContent;\n      }\n\n      var isPopperDirectionTop = (_this$state$popperPla = this.state.popperPlacement) === null || _this$state$popperPla === void 0 ? void 0 : _this$state$popperPla.includes(\"top\");\n      return createScopedElement(\"label\", {\n        vkuiClass: getClassName(\"CustomSelect\", platform),\n        className: className,\n        style: style,\n        ref: multiRef(this.containerRef, getRootRef),\n        onClick: this.onLabelClick\n      }, opened && searchable ? createScopedElement(Input, _extends({}, restProps, {\n        autoFocus: true,\n        onBlur: this.onBlur,\n        vkuiClass: classNames({\n          CustomSelect__open: opened,\n          \"CustomSelect__open--popupDirectionTop\": isPopperDirectionTop,\n          \"CustomSelect__open--not-adjacent\": dropdownOffsetDistance > 0\n        }),\n        value: this.state.inputValue,\n        onKeyDown: this.onInputKeyDown,\n        onChange: this.onInputChange // TODO Ожидается, что клик поймает нативный select, но его перехвает Input. К сожалению, это приводит конфликтам типизации.\n        // TODO Нужно перестать пытаться превратить CustomSelect в select. Тогда эта проблема уйдёт.\n        // @ts-ignore\n        ,\n        onClick: onClick,\n        after: icon,\n        placeholder: restProps.placeholder\n      })) : createScopedElement(SelectMimicry, _extends({}, restProps, {\n        \"aria-hidden\": true,\n        onClick: this.onClick,\n        onKeyDown: this.handleKeyDownSelect,\n        onKeyUp: this.handleKeyUp,\n        onFocus: this.onFocus,\n        onBlur: this.onBlur,\n        vkuiClass: classNames({\n          CustomSelect__open: opened,\n          \"CustomSelect__open--popupDirectionTop\": isPopperDirectionTop,\n          \"CustomSelect__open--not-adjacent\": dropdownOffsetDistance > 0\n        }),\n        after: icon\n      }), label), createScopedElement(\"select\", {\n        ref: this.selectRef,\n        name: name,\n        onChange: this.onNativeSelectChange,\n        onBlur: onBlur,\n        onFocus: onFocus,\n        onClick: onClick,\n        value: nativeSelectValue,\n        \"aria-hidden\": true,\n        vkuiClass: \"CustomSelect__control\"\n      }, options.map(function (item) {\n        return createScopedElement(\"option\", {\n          key: \"\".concat(item.value),\n          value: item.value\n        });\n      })), opened && createScopedElement(CustomSelectDropdown, {\n        targetRef: this.containerRef,\n        placement: popupDirection,\n        scrollBoxRef: this.scrollBoxRef,\n        onPlacementChange: this.onPlacementChange,\n        onMouseLeave: this.resetFocusedOption,\n        fetching: fetching,\n        offsetDistance: dropdownOffsetDistance,\n        sameWidth: fixDropdownWidth,\n        forcePortal: forceDropdownPortal\n      }, resolvedContent));\n    }\n  }]);\n\n  return CustomSelect;\n}(React.Component); // eslint-disable-next-line import/no-default-export\n\n\n_defineProperty(CustomSelect, \"defaultProps\", {\n  searchable: false,\n  renderOption: function renderOption(_ref2) {\n    var option = _ref2.option,\n        props = _objectWithoutProperties(_ref2, _excluded2);\n\n    return createScopedElement(CustomSelectOption, props);\n  },\n  options: [],\n  emptyText: \"Ничего не найдено\",\n  filterFn: defaultFilterFn,\n  icon: createScopedElement(DropdownIcon, null),\n  dropdownOffsetDistance: 0,\n  fixDropdownWidth: true,\n  selectType: SelectType.Default\n});\n\nexport default withPlatform(withAdaptivity(CustomSelect, {\n  sizeY: true\n}));","map":{"version":3,"mappings":"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","names":["React","SelectMimicry","debounce","setRef","multiRef","classNames","withAdaptivity","withPlatform","CustomSelectOption","getClassName","Input","DropdownIcon","Caption","warnOnce","defaultFilterFn","is","CustomSelectDropdown","findIndexAfter","options","startIndex","length","findIndex","option","i","disabled","findIndexBefore","endIndex","result","undefined","warn","checkOptionsValueType","Set","map","item","value","size","SelectType","CustomSelect","props","_classCallCheck","_this","_defineProperty","createRef","keyboardInput","state","selectedOptionIndex","inputValue","filterFn","filter","setState","opened","focusedOptionIndex","isValidIndex","scrollToElement","onOpen","resetKeyboardInput","onClose","select","index","_this$state$options","nativeSelectValue","event","Event","bubbles","selectEl","dispatchEvent","close","open","scrollTo","_this$state$options2","_this$state$options3","prevState","type","nextIndex","beforeIndex","focusOptionByIndex","e","Array","prototype","indexOf","call","currentTarget","parentNode","_e$currentTarget$pare","children","preventDefault","_e$currentTarget$pare2","_this$state$options4","selectFocused","key","fullInput","optionIndex","_this$state$options5","label","toLowerCase","includes","scrollBoxRef","current","_this$scrollBoxRef$cu","contains","target","newSelectedOptionIndex","findSelectedIndex","isControlledOutside","onChange","onInputChange","process","env","NODE_ENV","areOptionsShown","focusOption","onKeyboardInput","renderOption","hovered","selected","createScopedElement","Fragment","onClick","handleOptionClick","onMouseDown","handleOptionDown","onMouseOver","handleOptionHover","element","getRef","placement","popperPlacement","defaultValue","initialValue","Number","_this$state$options6","center","dropdown","dropdownHeight","offsetHeight","scrollTop","itemTop","offsetTop","itemHeight","prevProps","searchable","stateOptions","name","className","getRootRef","popupDirection","sizeY","platform","style","onBlur","onFocus","emptyText","renderDropdown","fetching","icon","dropdownOffsetDistance","fixDropdownWidth","forceDropdownPortal","restProps","getSelectedItem","defaultDropdownContent","vkuiClass","resolvedContent","isPopperDirectionTop","_this$state$popperPla","ref","containerRef","onLabelClick","autoFocus","CustomSelect__open","onKeyDown","onInputKeyDown","after","placeholder","handleKeyDownSelect","onKeyUp","handleKeyUp","selectRef","onNativeSelectChange","targetRef","onPlacementChange","onMouseLeave","resetFocusedOption","offsetDistance","sameWidth","forcePortal","Component","selectType","Default"],"sources":["../../../src/components/CustomSelect/CustomSelect.tsx"],"sourcesContent":["import * as React from \"react\";\nimport SelectMimicry from \"../SelectMimicry/SelectMimicry\";\nimport { debounce, setRef, multiRef } from \"../../lib/utils\";\nimport { classNames } from \"../../lib/classNames\";\nimport { NativeSelectProps } from \"../NativeSelect/NativeSelect\";\nimport { withAdaptivity } from \"../../hoc/withAdaptivity\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport CustomSelectOption, {\n  CustomSelectOptionProps,\n} from \"../CustomSelectOption/CustomSelectOption\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { FormFieldProps } from \"../FormField/FormField\";\nimport { HasPlatform } from \"../../types\";\nimport Input from \"../Input/Input\";\nimport { DropdownIcon } from \"../DropdownIcon/DropdownIcon\";\nimport { Caption } from \"../Typography/Caption/Caption\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { defaultFilterFn } from \"../../lib/select\";\nimport { is } from \"../../lib/is\";\nimport { Placement } from \"../Popper/Popper\";\nimport { CustomSelectDropdown } from \"../CustomSelectDropdown/CustomSelectDropdown\";\nimport \"./CustomSelect.css\";\n\nconst findIndexAfter = (\n  options: CustomSelectOptionInterface[] = [],\n  startIndex = -1\n) => {\n  if (startIndex >= options.length - 1) {\n    return -1;\n  }\n  return options.findIndex((option, i) => i > startIndex && !option.disabled);\n};\n\nconst findIndexBefore = (\n  options: CustomSelectOptionInterface[] = [],\n  endIndex: number = options.length\n) => {\n  let result = -1;\n  if (options === undefined || endIndex <= 0) {\n    return result;\n  }\n  for (let i = endIndex - 1; i >= 0; i--) {\n    let option = options[i];\n\n    if (!option.disabled) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n};\n\nconst warn = warnOnce(\"CustomSelect\");\n\nconst checkOptionsValueType = (options: CustomSelectOptionInterface[]) => {\n  if (new Set(options.map((item) => typeof item.value)).size > 1) {\n    warn(\n      \"Some values of your options have different types. CustomSelect onChange always returns a string type.\"\n    );\n  }\n};\n\ntype SelectValue = React.SelectHTMLAttributes<HTMLSelectElement>[\"value\"];\n\nexport enum SelectType {\n  Default = \"default\",\n  Plain = \"plain\",\n}\n\nexport interface CustomSelectOptionInterface {\n  value: SelectValue;\n  label: string;\n  disabled?: boolean;\n  [index: string]: any;\n}\n\ninterface CustomSelectState {\n  inputValue?: string;\n  opened?: boolean;\n  focusedOptionIndex?: number;\n  selectedOptionIndex?: number;\n  nativeSelectValue?: SelectValue;\n  options?: CustomSelectOptionInterface[];\n  popperPlacement?: Placement;\n}\n\nexport interface CustomSelectProps\n  extends NativeSelectProps,\n    HasPlatform,\n    FormFieldProps {\n  /**\n   * Если `true`, то при клике на селект в нём появится текстовое поле для поиска по `options`. По умолчанию поиск\n   * производится по `option.label`.\n   */\n  searchable?: boolean;\n  /**\n   * Текст, который будет отображен, если приходит пустой `options`\n   */\n  emptyText?: string;\n  onInputChange?: (\n    e: React.ChangeEvent,\n    options: CustomSelectOptionInterface[]\n  ) => void | CustomSelectOptionInterface[];\n  options: Array<{\n    value: SelectValue;\n    label: string;\n    [index: string]: any;\n  }>;\n  /**\n   * Функция для кастомной фильтрации. По-умолчанию поиск производится по option.label.\n   */\n  filterFn?:\n    | false\n    | ((\n        value: string,\n        option: CustomSelectOptionInterface,\n        getOptionLabel?: (\n          option: Partial<CustomSelectOptionInterface>\n        ) => string\n      ) => boolean);\n  popupDirection?: \"top\" | \"bottom\";\n  /**\n   * Рендер-проп для кастомного рендера опции.\n   * В объекте аргумента приходят [свойства опции](#/CustomSelectOption?id=props)\n   */\n  renderOption?: (props: CustomSelectOptionProps) => React.ReactNode;\n  /**\n   * Рендер-проп для кастомного рендера содержимого дропдауна.\n   * В defaultDropdownContent содержится список опций в виде скроллящегося блока.\n   */\n  renderDropdown?: ({\n    defaultDropdownContent,\n  }: {\n    defaultDropdownContent: React.ReactNode;\n  }) => React.ReactNode;\n  /**\n   * Если true, то в дропдауне вместо списка опций рисуется спиннер. При переданных renderDropdown и fetching: true,\n   * \"победит\" renderDropdown\n   */\n  fetching?: boolean;\n  onClose?: VoidFunction;\n  onOpen?: VoidFunction;\n  icon?: React.ReactNode;\n  dropdownOffsetDistance?: number;\n  fixDropdownWidth?: boolean;\n  forceDropdownPortal?: boolean;\n  selectType?: SelectType;\n}\n\ntype MouseEventHandler = (event: React.MouseEvent<HTMLElement>) => void;\n\nclass CustomSelect extends React.Component<\n  CustomSelectProps,\n  CustomSelectState\n> {\n  static defaultProps: Partial<CustomSelectProps> = {\n    searchable: false,\n    renderOption({ option, ...props }): React.ReactNode {\n      return <CustomSelectOption {...props} />;\n    },\n    options: [],\n    emptyText: \"Ничего не найдено\",\n    filterFn: defaultFilterFn,\n    icon: <DropdownIcon />,\n    dropdownOffsetDistance: 0,\n    fixDropdownWidth: true,\n    selectType: SelectType.Default,\n  };\n\n  public constructor(props: CustomSelectProps) {\n    super(props);\n\n    const { value, defaultValue } = props;\n\n    const initialValue = value !== undefined ? value : defaultValue;\n\n    this.keyboardInput = \"\";\n\n    if (process.env.NODE_ENV === \"development\") {\n      checkOptionsValueType(props.options);\n    }\n\n    this.state = {\n      opened: false,\n      focusedOptionIndex: -1,\n      selectedOptionIndex: this.findSelectedIndex(props.options, initialValue),\n      nativeSelectValue: initialValue,\n      options: props.options,\n      inputValue: \"\",\n    };\n\n    if (props.value !== undefined) {\n      this.isControlledOutside = true;\n    }\n  }\n\n  private keyboardInput: string;\n  private isControlledOutside = false;\n  private selectEl: HTMLSelectElement | null = null;\n  private readonly scrollBoxRef = React.createRef<HTMLDivElement>();\n  private readonly containerRef = React.createRef<HTMLLabelElement>();\n\n  private readonly resetKeyboardInput = () => {\n    this.keyboardInput = \"\";\n  };\n\n  private readonly getSelectedItem = () => {\n    const { selectedOptionIndex, options } = this.state;\n\n    if (!options?.length) {\n      return null;\n    }\n\n    return selectedOptionIndex !== undefined\n      ? options[selectedOptionIndex]\n      : undefined;\n  };\n\n  get areOptionsShown() {\n    return this.scrollBoxRef.current !== null;\n  }\n\n  filter = (\n    options: CustomSelectProps[\"options\"],\n    inputValue: string,\n    filterFn: CustomSelectProps[\"filterFn\"]\n  ) => {\n    return typeof filterFn === \"function\"\n      ? options.filter((option) => filterFn(inputValue, option))\n      : options;\n  };\n\n  findSelectedIndex(\n    options: CustomSelectOptionInterface[] | undefined,\n    value: SelectValue\n  ) {\n    return (\n      options?.findIndex((item) => {\n        value = typeof item.value === \"number\" ? Number(value) : value;\n        return item.value === value;\n      }) ?? -1\n    );\n  }\n\n  open = () => {\n    this.setState(\n      ({ selectedOptionIndex }) => ({\n        opened: true,\n        focusedOptionIndex: selectedOptionIndex,\n      }),\n      () => {\n        const { selectedOptionIndex } = this.state;\n\n        if (\n          selectedOptionIndex !== undefined &&\n          this.isValidIndex(selectedOptionIndex)\n        ) {\n          this.scrollToElement(selectedOptionIndex, true);\n        }\n      }\n    );\n    typeof this.props.onOpen === \"function\" && this.props.onOpen();\n  };\n\n  close = () => {\n    this.resetKeyboardInput();\n\n    this.setState(() => ({\n      inputValue: \"\",\n      opened: false,\n      focusedOptionIndex: -1,\n      options: this.props.options,\n    }));\n    typeof this.props.onClose === \"function\" && this.props.onClose();\n  };\n\n  private isValidIndex(index: number) {\n    return index >= 0 && index < (this.state.options?.length ?? 0);\n  }\n\n  selectFocused = () => {\n    const { focusedOptionIndex } = this.state;\n\n    if (focusedOptionIndex !== undefined) {\n      this.select(focusedOptionIndex);\n    }\n  };\n\n  select = (index: number) => {\n    if (!this.isValidIndex(index)) {\n      return;\n    }\n\n    const item = this.state.options?.[index];\n\n    this.setState(\n      {\n        nativeSelectValue: item?.value,\n      },\n      () => {\n        const event = new Event(\"change\", { bubbles: true });\n        this.selectEl?.dispatchEvent(event);\n      }\n    );\n    this.close();\n  };\n\n  onClick = () => {\n    this.state.opened ? this.close() : this.open();\n  };\n\n  onFocus = () => {\n    const event = new Event(\"focus\");\n    this.selectEl?.dispatchEvent(event);\n  };\n\n  onBlur = () => {\n    this.close();\n    const event = new Event(\"blur\");\n    this.selectEl?.dispatchEvent(event);\n  };\n\n  private scrollToElement(index: number, center = false) {\n    const dropdown = this.scrollBoxRef.current;\n    const item = dropdown ? (dropdown.children[index] as HTMLElement) : null;\n\n    if (!item || !dropdown) {\n      return;\n    }\n\n    const dropdownHeight = dropdown.offsetHeight;\n    const scrollTop = dropdown.scrollTop;\n    const itemTop = item.offsetTop;\n    const itemHeight = item.offsetHeight;\n\n    if (center) {\n      dropdown.scrollTop = itemTop - dropdownHeight / 2 + itemHeight / 2;\n    } else if (itemTop + itemHeight > dropdownHeight + scrollTop) {\n      dropdown.scrollTop = itemTop - dropdownHeight + itemHeight;\n    } else if (itemTop < scrollTop) {\n      dropdown.scrollTop = itemTop;\n    }\n  }\n\n  focusOptionByIndex = (index: number | undefined, scrollTo = true) => {\n    if (\n      index === undefined ||\n      index < 0 ||\n      index > (this.state.options?.length ?? 0) - 1\n    ) {\n      return;\n    }\n\n    const option = this.state.options?.[index];\n\n    if (option?.disabled) {\n      return;\n    }\n\n    scrollTo && this.scrollToElement(index);\n\n    this.setState((prevState) =>\n      // Это оптимизация, прежде всего, под `onMouseOver`\n      prevState.focusedOptionIndex !== index\n        ? {\n            focusedOptionIndex: index,\n          }\n        : null\n    );\n  };\n\n  focusOption = (type: \"next\" | \"prev\") => {\n    const { focusedOptionIndex } = this.state;\n    let index = focusedOptionIndex;\n\n    if (type === \"next\") {\n      const nextIndex = findIndexAfter(this.state.options, index);\n      index = nextIndex === -1 ? findIndexAfter(this.state.options) : nextIndex; // Следующий за index или первый валидный до index\n    } else if (type === \"prev\") {\n      const beforeIndex = findIndexBefore(this.state.options, index);\n      index =\n        beforeIndex === -1 ? findIndexBefore(this.state.options) : beforeIndex; // Предшествующий index или последний валидный после index\n    }\n\n    this.focusOptionByIndex(index);\n  };\n\n  handleOptionHover: MouseEventHandler = (e: React.MouseEvent<HTMLElement>) => {\n    this.focusOptionByIndex(\n      Array.prototype.indexOf.call(\n        e.currentTarget.parentNode?.children,\n        e.currentTarget\n      ),\n      false\n    );\n  };\n\n  handleOptionDown: MouseEventHandler = (e: React.MouseEvent<HTMLElement>) => {\n    e.preventDefault();\n  };\n\n  handleOptionClick: MouseEventHandler = (e: React.MouseEvent<HTMLElement>) => {\n    const index = Array.prototype.indexOf.call(\n      e.currentTarget.parentNode?.children,\n      e.currentTarget\n    );\n    const option = this.state.options?.[index];\n\n    if (option && !option.disabled) {\n      this.selectFocused();\n    }\n  };\n\n  resetFocusedOption = () => {\n    this.setState({ focusedOptionIndex: -1 });\n  };\n\n  onKeyboardInput = (key: string) => {\n    const fullInput = this.keyboardInput + key;\n\n    const optionIndex = this.state.options?.findIndex((option) => {\n      return option.label.toLowerCase().includes(fullInput);\n    });\n\n    if (optionIndex !== undefined && optionIndex > -1) {\n      this.focusOptionByIndex(optionIndex);\n    }\n\n    this.keyboardInput = fullInput;\n  };\n\n  /**\n   * Нужен для правильного поведения обработчика onClick на select. Фильтрует клики, которые были сделаны по\n   * выпадающему списку.\n   */\n  onLabelClick = (e: React.MouseEvent<HTMLLabelElement>) => {\n    if (this.scrollBoxRef.current?.contains(e.target as Node)) {\n      e.preventDefault();\n    }\n  };\n\n  onNativeSelectChange: React.ChangeEventHandler<HTMLSelectElement> = (e) => {\n    const newSelectedOptionIndex = this.findSelectedIndex(\n      this.state.options,\n      e.currentTarget.value\n    );\n\n    if (this.state.selectedOptionIndex !== newSelectedOptionIndex) {\n      if (!this.isControlledOutside) {\n        this.setState({\n          selectedOptionIndex: newSelectedOptionIndex,\n        });\n      }\n      this.props.onChange?.(e);\n    }\n  };\n\n  onInputChange: React.ChangeEventHandler<HTMLInputElement> = (e) => {\n    if (this.props.onInputChange) {\n      const options = this.props.onInputChange(e, this.props.options);\n      if (options) {\n        if (process.env.NODE_ENV === \"development\") {\n          warn(\n            \"This filtration method is deprecated. Return value of onInputChange will\" +\n              \" be ignored in v5.0.0. For custom filtration please update props.options by yourself or use filterFn property\"\n          );\n        }\n        this.setState({\n          options,\n          selectedOptionIndex: this.findSelectedIndex(\n            options,\n            this.state.nativeSelectValue\n          ),\n          inputValue: e.target.value,\n        });\n      } else {\n        this.setState({ inputValue: e.target.value });\n      }\n    } else {\n      const options = this.filter(\n        this.props.options,\n        e.target.value,\n        this.props.filterFn\n      );\n      this.setState({\n        options,\n        selectedOptionIndex: this.findSelectedIndex(\n          options,\n          this.state.nativeSelectValue\n        ),\n        inputValue: e.target.value,\n      });\n    }\n  };\n\n  onInputKeyDown: React.KeyboardEventHandler<HTMLInputElement> = (event) => {\n    [\"ArrowUp\", \"ArrowDown\", \"Escape\", \"Enter\"].includes(event.key) &&\n      this.areOptionsShown &&\n      event.preventDefault();\n\n    switch (event.key) {\n      case \"ArrowUp\":\n        this.areOptionsShown && this.focusOption(\"prev\");\n        break;\n      case \"ArrowDown\":\n        this.areOptionsShown && this.focusOption(\"next\");\n        break;\n      case \"Escape\":\n        this.close();\n        break;\n      case \"Enter\":\n        this.areOptionsShown && this.selectFocused();\n        break;\n    }\n  };\n\n  handleKeyDownSelect = (event: React.KeyboardEvent) => {\n    const { opened } = this.state;\n\n    if (event.key.length === 1 && event.key !== \" \") {\n      this.onKeyboardInput(event.key);\n      return;\n    }\n\n    [\"ArrowUp\", \"ArrowDown\", \"Escape\", \"Enter\"].includes(event.key) &&\n      this.areOptionsShown &&\n      event.preventDefault();\n\n    switch (event.key) {\n      case \"ArrowUp\":\n        if (opened) {\n          this.areOptionsShown && this.focusOption(\"prev\");\n        } else {\n          this.open();\n        }\n        break;\n      case \"ArrowDown\":\n        if (opened) {\n          this.areOptionsShown && this.focusOption(\"next\");\n        } else {\n          this.open();\n        }\n        break;\n      case \"Escape\":\n        this.close();\n        break;\n      case \"Enter\":\n      case \"Spacebar\":\n      case \" \":\n        if (opened) {\n          this.areOptionsShown && this.selectFocused();\n        } else {\n          this.open();\n        }\n        break;\n    }\n  };\n\n  handleKeyUp = debounce(this.resetKeyboardInput, 1000);\n\n  componentDidUpdate(prevProps: CustomSelectProps) {\n    // Внутри useEffect и так is, можно убрать\n    if (\n      !is(prevProps.value, this.props.value) ||\n      prevProps.options !== this.props.options\n    ) {\n      if (process.env.NODE_ENV === \"development\") {\n        checkOptionsValueType(this.props.options);\n      }\n\n      this.isControlledOutside = this.props.value !== undefined;\n      const value =\n        this.props.value === undefined\n          ? this.state.nativeSelectValue\n          : this.props.value;\n      const options =\n        this.props.searchable && this.state.inputValue !== undefined\n          ? this.filter(\n              this.props.options,\n              this.state.inputValue,\n              this.props.filterFn\n            )\n          : this.props.options;\n      this.setState({\n        nativeSelectValue: value,\n        selectedOptionIndex: this.findSelectedIndex(options, value),\n        options,\n      });\n    }\n  }\n\n  renderOption = (option: CustomSelectOptionInterface, index: number) => {\n    const { focusedOptionIndex, selectedOptionIndex } = this.state;\n    const { renderOption } = this.props;\n    const hovered = index === focusedOptionIndex;\n    const selected = index === selectedOptionIndex;\n\n    return (\n      <React.Fragment key={`${option.value}`}>\n        {renderOption!({\n          option,\n          hovered,\n          children: option.label,\n          selected,\n          disabled: option.disabled,\n          onClick: this.handleOptionClick,\n          onMouseDown: this.handleOptionDown,\n          // Используем `onMouseOver` вместо `onMouseEnter`.\n          // При параметре `searchable`, обновляется \"ребёнок\", из-за чего `onMouseEnter` не срабатывает в следующих кейсах:\n          //  1. До загрузки выпадающего списка, курсор мышки находится над произвольным элементом этого списка.\n          //     > Лечение: только увод курсора мыши и возвращении его обратно вызывает событие `onMouseEnter` на этот элемент.\n          //  2. Если это тач-устройство.\n          //     > Лечение: нужно нажать на какой-нибудь произвольный элемент списка, после чего `onMouseEnter` будет работать на соседние элементы,\n          //     но не на тот, на который нажали в первый раз.\n          // Более подробно по ссылке https://github.com/facebook/react/issues/13956#issuecomment-1082055744\n          onMouseOver: this.handleOptionHover,\n        })}\n      </React.Fragment>\n    );\n  };\n\n  selectRef = (element: HTMLSelectElement) => {\n    this.selectEl = element;\n    if (this.props.getRef) {\n      setRef(element, this.props.getRef);\n    }\n  };\n\n  onPlacementChange = (placement?: Placement) => {\n    this.setState(() => ({\n      popperPlacement: placement,\n    }));\n  };\n\n  render() {\n    const { opened, nativeSelectValue, options: stateOptions } = this.state;\n    const {\n      searchable,\n      name,\n      className,\n      getRef,\n      getRootRef,\n      popupDirection,\n      options,\n      sizeY,\n      platform,\n      style,\n      onChange,\n      onBlur,\n      onFocus,\n      onClick,\n      renderOption,\n      children,\n      emptyText,\n      onInputChange,\n      filterFn,\n      renderDropdown,\n      onOpen,\n      onClose,\n      fetching,\n      icon,\n      dropdownOffsetDistance,\n      fixDropdownWidth,\n      forceDropdownPortal,\n      ...restProps\n    } = this.props;\n    const selected = this.getSelectedItem();\n    const label = selected ? selected.label : undefined;\n\n    const defaultDropdownContent =\n      stateOptions !== undefined && stateOptions.length > 0 ? (\n        stateOptions.map(this.renderOption)\n      ) : (\n        <Caption vkuiClass=\"CustomSelect__empty\">\n          {this.props.emptyText}\n        </Caption>\n      );\n\n    let resolvedContent;\n\n    if (typeof renderDropdown === \"function\") {\n      resolvedContent = renderDropdown({ defaultDropdownContent });\n    } else {\n      resolvedContent = defaultDropdownContent;\n    }\n\n    const isPopperDirectionTop = this.state.popperPlacement?.includes(\"top\");\n\n    return (\n      <label\n        vkuiClass={getClassName(\"CustomSelect\", platform)}\n        className={className}\n        style={style}\n        ref={multiRef(this.containerRef, getRootRef)}\n        onClick={this.onLabelClick}\n      >\n        {opened && searchable ? (\n          <Input\n            {...restProps}\n            autoFocus\n            onBlur={this.onBlur}\n            vkuiClass={classNames({\n              CustomSelect__open: opened,\n              \"CustomSelect__open--popupDirectionTop\": isPopperDirectionTop,\n              \"CustomSelect__open--not-adjacent\":\n                (dropdownOffsetDistance as number) > 0,\n            })}\n            value={this.state.inputValue}\n            onKeyDown={this.onInputKeyDown}\n            onChange={this.onInputChange}\n            // TODO Ожидается, что клик поймает нативный select, но его перехвает Input. К сожалению, это приводит конфликтам типизации.\n            // TODO Нужно перестать пытаться превратить CustomSelect в select. Тогда эта проблема уйдёт.\n            // @ts-ignore\n            onClick={onClick}\n            after={icon}\n            placeholder={restProps.placeholder}\n          />\n        ) : (\n          <SelectMimicry\n            {...restProps}\n            aria-hidden={true}\n            onClick={this.onClick}\n            onKeyDown={this.handleKeyDownSelect}\n            onKeyUp={this.handleKeyUp}\n            onFocus={this.onFocus}\n            onBlur={this.onBlur}\n            vkuiClass={classNames({\n              CustomSelect__open: opened,\n              \"CustomSelect__open--popupDirectionTop\": isPopperDirectionTop,\n              \"CustomSelect__open--not-adjacent\":\n                (dropdownOffsetDistance as number) > 0,\n            })}\n            after={icon}\n          >\n            {label}\n          </SelectMimicry>\n        )}\n        <select\n          ref={this.selectRef}\n          name={name}\n          onChange={this.onNativeSelectChange}\n          onBlur={onBlur}\n          onFocus={onFocus}\n          onClick={onClick}\n          value={nativeSelectValue}\n          aria-hidden={true}\n          vkuiClass=\"CustomSelect__control\"\n        >\n          {options.map((item) => (\n            <option key={`${item.value}`} value={item.value} />\n          ))}\n        </select>\n        {opened && (\n          <CustomSelectDropdown\n            targetRef={this.containerRef}\n            placement={popupDirection}\n            scrollBoxRef={this.scrollBoxRef}\n            onPlacementChange={this.onPlacementChange}\n            onMouseLeave={this.resetFocusedOption}\n            fetching={fetching}\n            offsetDistance={dropdownOffsetDistance}\n            sameWidth={fixDropdownWidth}\n            forcePortal={forceDropdownPortal}\n          >\n            {resolvedContent}\n          </CustomSelectDropdown>\n        )}\n      </label>\n    );\n  }\n}\n\n// eslint-disable-next-line import/no-default-export\nexport default withPlatform(\n  withAdaptivity(CustomSelect, {\n    sizeY: true,\n  })\n);\n"]},"metadata":{},"sourceType":"module"}