{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"Component\", \"onClose\", \"restoreFocus\", \"timeout\", \"getRootRef\", \"children\"];\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport * as React from \"react\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useGlobalEventListener } from \"../../hooks/useGlobalEventListener\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { FOCUSABLE_ELEMENTS_LIST, Keys, pressedKey } from \"../../lib/accessibility\";\nimport { useDOM } from \"../../lib/dom\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { noop } from \"../../lib/utils\";\nimport { AppRootContext } from \"../AppRoot/AppRootContext\";\nvar FOCUSABLE_ELEMENTS = FOCUSABLE_ELEMENTS_LIST.join();\nexport var FocusTrap = function FocusTrap(_ref) {\n  var _ref$Component = _ref.Component,\n      Component = _ref$Component === void 0 ? \"div\" : _ref$Component,\n      _ref$onClose = _ref.onClose,\n      onClose = _ref$onClose === void 0 ? noop : _ref$onClose,\n      _ref$restoreFocus = _ref.restoreFocus,\n      restoreFocus = _ref$restoreFocus === void 0 ? true : _ref$restoreFocus,\n      _ref$timeout = _ref.timeout,\n      timeout = _ref$timeout === void 0 ? 0 : _ref$timeout,\n      getRootRef = _ref.getRootRef,\n      children = _ref.children,\n      restProps = _objectWithoutProperties(_ref, _excluded);\n\n  var ref = useExternRef(getRootRef);\n\n  var _useDOM = useDOM(),\n      document = _useDOM.document,\n      window = _useDOM.window;\n\n  var _React$useState = React.useState(null),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      focusableNodes = _React$useState2[0],\n      setFocusableNodes = _React$useState2[1];\n\n  var _React$useState3 = React.useState(null),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      restoreFocusTo = _React$useState4[0],\n      setRestoreFocusTo = _React$useState4[1]; // HANDLE TRAP MOUNT\n\n\n  var _React$useContext = React.useContext(AppRootContext),\n      keyboardInput = _React$useContext.keyboardInput;\n\n  var focusOnTrapMount = useTimeout(function () {\n    var _ref$current;\n\n    if (keyboardInput && !((_ref$current = ref.current) !== null && _ref$current !== void 0 && _ref$current.contains(document.activeElement)) && focusableNodes !== null && focusableNodes !== void 0 && focusableNodes.length) {\n      focusableNodes[0].focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(function () {\n    focusOnTrapMount.set();\n  }, []); // HANDLE FOCUSABLE NODES\n\n  useIsomorphicLayoutEffect(function () {\n    if (!ref.current) {\n      return noop();\n    }\n\n    var nodes = [];\n    Array.prototype.forEach.call( // eslint-disable-next-line no-restricted-properties\n    ref.current.querySelectorAll(FOCUSABLE_ELEMENTS), function (focusableEl) {\n      var _getComputedStyle = window.getComputedStyle(focusableEl),\n          display = _getComputedStyle.display,\n          visibility = _getComputedStyle.visibility;\n\n      if (display !== \"none\" && visibility !== \"hidden\") {\n        nodes.push(focusableEl);\n      }\n    });\n\n    if (nodes !== null && nodes !== void 0 && nodes.length) {\n      setFocusableNodes(nodes);\n    }\n\n    return noop();\n  }, [children]); // HANDLE TRAP UNMOUNT\n\n  var focusOnTrapUnmount = useTimeout(function () {\n    if (restoreFocusTo) {\n      restoreFocusTo.focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(function () {\n    if (restoreFocus && document.activeElement) {\n      setRestoreFocusTo(document.activeElement);\n      return function () {\n        focusOnTrapUnmount.set();\n      };\n    }\n\n    return noop();\n  }, [restoreFocus]);\n\n  var onDocumentKeydown = function onDocumentKeydown(e) {\n    if (pressedKey(e) === Keys.TAB && focusableNodes !== null && focusableNodes !== void 0 && focusableNodes.length) {\n      var lastIdx = focusableNodes.length - 1;\n      var targetIdx = focusableNodes.findIndex(function (node) {\n        return node === e.target;\n      });\n      var shouldFocusFirstNode = targetIdx === -1 || targetIdx === lastIdx && !e.shiftKey;\n\n      if (shouldFocusFirstNode || targetIdx === 0 && e.shiftKey) {\n        e.preventDefault();\n        var node = focusableNodes[shouldFocusFirstNode ? 0 : lastIdx];\n\n        if (node !== document.activeElement) {\n          node.focus();\n        }\n\n        return false;\n      }\n    }\n\n    if (pressedKey(e) === Keys.ESCAPE) {\n      onClose();\n    }\n\n    return true;\n  };\n\n  useGlobalEventListener(document, \"keydown\", onDocumentKeydown, {\n    capture: true\n  });\n  return createScopedElement(Component, _extends({\n    ref: ref\n  }, restProps), children);\n};","map":{"version":3,"mappings":"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","names":["React","useExternRef","useGlobalEventListener","useTimeout","FOCUSABLE_ELEMENTS_LIST","Keys","pressedKey","useDOM","useIsomorphicLayoutEffect","noop","AppRootContext","FOCUSABLE_ELEMENTS","join","FocusTrap","Component","onClose","restoreFocus","timeout","getRootRef","children","restProps","ref","document","window","useState","focusableNodes","setFocusableNodes","restoreFocusTo","setRestoreFocusTo","useContext","keyboardInput","focusOnTrapMount","current","_ref$current","contains","activeElement","length","focus","set","nodes","Array","prototype","forEach","call","querySelectorAll","focusableEl","getComputedStyle","display","visibility","push","focusOnTrapUnmount","onDocumentKeydown","e","TAB","lastIdx","targetIdx","findIndex","node","target","shouldFocusFirstNode","shiftKey","preventDefault","ESCAPE","capture","createScopedElement"],"sources":["../../../src/components/FocusTrap/FocusTrap.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useGlobalEventListener } from \"../../hooks/useGlobalEventListener\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport {\n  FOCUSABLE_ELEMENTS_LIST,\n  Keys,\n  pressedKey,\n} from \"../../lib/accessibility\";\nimport { useDOM } from \"../../lib/dom\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { noop } from \"../../lib/utils\";\nimport { HasComponent, HasRootRef } from \"../../types\";\nimport { AppRootContext } from \"../AppRoot/AppRootContext\";\n\nconst FOCUSABLE_ELEMENTS: string = FOCUSABLE_ELEMENTS_LIST.join();\n\nexport interface FocusTrapProps\n  extends React.AllHTMLAttributes<HTMLElement>,\n    HasRootRef<HTMLElement>,\n    HasComponent {\n  onClose?: (props?: any) => void;\n  restoreFocus?: boolean;\n  timeout?: number;\n}\n\nexport const FocusTrap: React.FC<FocusTrapProps> = ({\n  Component = \"div\",\n  onClose = noop,\n  restoreFocus = true,\n  timeout = 0,\n  getRootRef,\n  children,\n  ...restProps\n}) => {\n  const ref = useExternRef<HTMLElement>(getRootRef);\n\n  const { document, window } = useDOM();\n\n  const [focusableNodes, setFocusableNodes] = React.useState<\n    HTMLElement[] | null\n  >(null);\n  const [restoreFocusTo, setRestoreFocusTo] =\n    React.useState<HTMLElement | null>(null);\n\n  // HANDLE TRAP MOUNT\n\n  const { keyboardInput } = React.useContext(AppRootContext);\n  const focusOnTrapMount = useTimeout(() => {\n    if (\n      keyboardInput &&\n      !ref.current?.contains(document!.activeElement) &&\n      focusableNodes?.length\n    ) {\n      focusableNodes[0].focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(() => {\n    focusOnTrapMount.set();\n  }, []);\n\n  // HANDLE FOCUSABLE NODES\n\n  useIsomorphicLayoutEffect(() => {\n    if (!ref.current) {\n      return noop();\n    }\n\n    const nodes: HTMLElement[] = [];\n    Array.prototype.forEach.call(\n      // eslint-disable-next-line no-restricted-properties\n      ref.current.querySelectorAll(FOCUSABLE_ELEMENTS),\n      (focusableEl: Element) => {\n        const { display, visibility } = window!.getComputedStyle(focusableEl);\n\n        if (display !== \"none\" && visibility !== \"hidden\") {\n          nodes.push(focusableEl as HTMLElement);\n        }\n      }\n    );\n\n    if (nodes?.length) {\n      setFocusableNodes(nodes);\n    }\n\n    return noop();\n  }, [children]);\n\n  // HANDLE TRAP UNMOUNT\n\n  const focusOnTrapUnmount = useTimeout(() => {\n    if (restoreFocusTo) {\n      restoreFocusTo.focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(() => {\n    if (restoreFocus && document!.activeElement) {\n      setRestoreFocusTo(document!.activeElement as HTMLElement);\n\n      return () => {\n        focusOnTrapUnmount.set();\n      };\n    }\n\n    return noop();\n  }, [restoreFocus]);\n\n  const onDocumentKeydown = (e: KeyboardEvent) => {\n    if (pressedKey(e) === Keys.TAB && focusableNodes?.length) {\n      const lastIdx = focusableNodes.length - 1;\n      const targetIdx = focusableNodes.findIndex((node) => node === e.target);\n\n      const shouldFocusFirstNode =\n        targetIdx === -1 || (targetIdx === lastIdx && !e.shiftKey);\n\n      if (shouldFocusFirstNode || (targetIdx === 0 && e.shiftKey)) {\n        e.preventDefault();\n\n        const node = focusableNodes[shouldFocusFirstNode ? 0 : lastIdx];\n\n        if (node !== document!.activeElement) {\n          node.focus();\n        }\n\n        return false;\n      }\n    }\n\n    if (pressedKey(e) === Keys.ESCAPE) {\n      onClose();\n    }\n\n    return true;\n  };\n  useGlobalEventListener(document, \"keydown\", onDocumentKeydown, {\n    capture: true,\n  });\n\n  return (\n    <Component ref={ref} {...restProps}>\n      {children}\n    </Component>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}