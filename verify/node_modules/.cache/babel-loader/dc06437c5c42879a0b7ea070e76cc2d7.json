{"ast":null,"code":"// Output Feedback\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\n\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\n\nvar _OFB_iv, _OFB_lastPrecipher, _OFB_lastPrecipherIndex;\n\nimport { ModeOfOperation } from \"./mode.js\";\nexport class OFB extends ModeOfOperation {\n  constructor(key, iv) {\n    super(\"OFB\", key, OFB);\n\n    _OFB_iv.set(this, void 0);\n\n    _OFB_lastPrecipher.set(this, void 0);\n\n    _OFB_lastPrecipherIndex.set(this, void 0);\n\n    if (iv) {\n      if (iv.length % 16) {\n        throw new TypeError(\"invalid iv size (must be 16 bytes)\");\n      }\n\n      __classPrivateFieldSet(this, _OFB_iv, new Uint8Array(iv), \"f\");\n    } else {\n      __classPrivateFieldSet(this, _OFB_iv, new Uint8Array(16), \"f\");\n    }\n\n    __classPrivateFieldSet(this, _OFB_lastPrecipher, this.iv, \"f\");\n\n    __classPrivateFieldSet(this, _OFB_lastPrecipherIndex, 16, \"f\");\n  }\n\n  get iv() {\n    return new Uint8Array(__classPrivateFieldGet(this, _OFB_iv, \"f\"));\n  }\n\n  encrypt(plaintext) {\n    var _a, _b;\n\n    if (plaintext.length % 16) {\n      throw new TypeError(\"invalid plaintext size (must be multiple of 16 bytes)\");\n    }\n\n    const ciphertext = new Uint8Array(plaintext);\n\n    for (let i = 0; i < ciphertext.length; i++) {\n      if (__classPrivateFieldGet(this, _OFB_lastPrecipherIndex, \"f\") === 16) {\n        __classPrivateFieldSet(this, _OFB_lastPrecipher, this.aes.encrypt(__classPrivateFieldGet(this, _OFB_lastPrecipher, \"f\")), \"f\");\n\n        __classPrivateFieldSet(this, _OFB_lastPrecipherIndex, 0, \"f\");\n      }\n\n      ciphertext[i] ^= __classPrivateFieldGet(this, _OFB_lastPrecipher, \"f\")[(__classPrivateFieldSet(this, _OFB_lastPrecipherIndex, (_b = __classPrivateFieldGet(this, _OFB_lastPrecipherIndex, \"f\"), _a = _b++, _b), \"f\"), _a)];\n    }\n\n    return ciphertext;\n  }\n\n  decrypt(ciphertext) {\n    if (ciphertext.length % 16) {\n      throw new TypeError(\"invalid ciphertext size (must be multiple of 16 bytes)\");\n    }\n\n    return this.encrypt(ciphertext);\n  }\n\n}\n_OFB_iv = new WeakMap(), _OFB_lastPrecipher = new WeakMap(), _OFB_lastPrecipherIndex = new WeakMap();","map":{"version":3,"mappings":"AAAA;;;;;;;;;;;;;;;;AAEA,SAASA,eAAT,QAAgC,WAAhC;AAEA,OAAM,MAAOC,GAAP,SAAmBD,eAAnB,CAAkC;AAKtCE,cAAYC,GAAZ,EAA6BC,EAA7B,EAA4C;AAC1C,UAAM,KAAN,EAAaD,GAAb,EAAkBF,GAAlB;;AALFI;;AACAC;;AACAC;;AAKE,QAAIH,EAAJ,EAAQ;AACN,UAAIA,EAAE,CAACI,MAAH,GAAY,EAAhB,EAAoB;AAClB,cAAM,IAAIC,SAAJ,CAAc,oCAAd,CAAN;AACD;;AACDC,mCAAIL,OAAJ,EAAW,IAAIM,UAAJ,CAAeP,EAAf,CAAX,EAA6B,GAA7B;AACD,KALD,MAKO;AACLM,mCAAIL,OAAJ,EAAW,IAAIM,UAAJ,CAAe,EAAf,CAAX,EAA6B,GAA7B;AACD;;AAEDD,iCAAIJ,kBAAJ,EAAsB,KAAKF,EAA3B,EAA6B,GAA7B;;AACAM,iCAAIH,uBAAJ,EAA2B,EAA3B,EAA6B,GAA7B;AACD;;AAEK,MAAFH,EAAE;AAAiB,WAAO,IAAIO,UAAJ,CAAeC,6BAAIP,OAAJ,EAAI,GAAJ,CAAf,CAAP;AAAkC;;AAEzDQ,SAAO,CAACC,SAAD,EAAsB;;;AAC3B,QAAIA,SAAS,CAACN,MAAV,GAAmB,EAAvB,EAA2B;AACzB,YAAM,IAAIC,SAAJ,CAAc,uDAAd,CAAN;AACD;;AAED,UAAMM,UAAU,GAAG,IAAIJ,UAAJ,CAAeG,SAAf,CAAnB;;AACA,SAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,UAAU,CAACP,MAA/B,EAAuCQ,CAAC,EAAxC,EAA4C;AAC1C,UAAIJ,6BAAIL,uBAAJ,EAAI,GAAJ,MAA6B,EAAjC,EAAqC;AACjCG,qCAAIJ,kBAAJ,EAAsB,KAAKW,GAAL,CAASJ,OAAT,CAAiBD,6BAAIN,kBAAJ,EAAI,GAAJ,CAAjB,CAAtB,EAA2D,GAA3D;;AACAI,qCAAIH,uBAAJ,EAA2B,CAA3B,EAA4B,GAA5B;AACH;;AACDQ,gBAAU,CAACC,CAAD,CAAV,IAAiBJ,6BAAIN,kBAAJ,EAAI,GAAJ,GAAoBI,mIAA0BQ,EAA1B,GAA0B,GAA1B,GAA0BC,EAA9C,EAAjB;AACD;;AAED,WAAOJ,UAAP;AACD;;AAEDK,SAAO,CAACL,UAAD,EAAuB;AAC5B,QAAIA,UAAU,CAACP,MAAX,GAAoB,EAAxB,EAA4B;AACxB,YAAM,IAAIC,SAAJ,CAAc,wDAAd,CAAN;AACH;;AACD,WAAO,KAAKI,OAAL,CAAaE,UAAb,CAAP;AACD;;AA7CqC","names":["ModeOfOperation","OFB","constructor","key","iv","_OFB_iv","_OFB_lastPrecipher","_OFB_lastPrecipherIndex","length","TypeError","__classPrivateFieldSet","Uint8Array","__classPrivateFieldGet","encrypt","plaintext","ciphertext","i","aes","_b","_a","decrypt"],"sourceRoot":"","sources":["../src.ts/mode-ofb.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}