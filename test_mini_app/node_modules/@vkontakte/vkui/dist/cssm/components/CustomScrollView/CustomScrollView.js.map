{"version":3,"sources":["../../../../src/components/CustomScrollView/CustomScrollView.tsx"],"names":["React","withDOM","multiRef","setRef","CustomScrollView","NaN","e","props","boxRef","createRef","box","current","barY","trackerY","clientHeight","scrollHeight","ratio","trackerHeight","Math","max","style","display","height","setTrackerPositionFromScroll","scrollTop","preventDefault","startY","clientY","trackerTop","lastTrackerTop","document","addEventListener","onMove","onUp","diff","position","min","setScrollPositionFromTracker","removeEventListener","chooseTransformProp","resize","windowResize","window","prop","undefined","transformProp","progress","setTrackerPosition","children","className","onDragStart","scroll","Component"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { DOMProps, withDOM } from \"../../lib/dom\";\nimport { multiRef, setRef } from \"../../lib/utils\";\nimport \"./CustomScrollView.css\";\n\ninterface Props extends DOMProps {\n  windowResize?: boolean;\n  boxRef?: React.Ref<HTMLDivElement>;\n  className?: HTMLDivElement[\"className\"];\n}\n\nclass CustomScrollView extends React.Component<Props> {\n  private ratio = NaN;\n  private lastTrackerTop = 0;\n  private clientHeight = 0;\n  private trackerHeight = 0;\n  private scrollHeight = 0;\n  private transformProp = \"\";\n\n  private startY = 0;\n  private trackerTop = 0;\n\n  private readonly box = multiRef<HTMLDivElement>((e) =>\n    setRef(e, this.props.boxRef)\n  );\n  private readonly barY = React.createRef<HTMLDivElement>();\n  private readonly trackerY = React.createRef<HTMLDivElement>();\n\n  componentDidMount() {\n    this.chooseTransformProp();\n\n    this.resize();\n\n    if (this.props.windowResize) {\n      this.props.window!.addEventListener(\"resize\", this.resize);\n    }\n  }\n\n  componentDidUpdate() {\n    this.resize();\n  }\n\n  componentWillUnmount() {\n    this.props.window!.removeEventListener(\"resize\", this.resize);\n  }\n\n  chooseTransformProp() {\n    let style = this.trackerY.current?.style;\n    let prop = \"\";\n    if (style !== undefined) {\n      if (\"transform\" in style) {\n        prop = \"transform\";\n      } else if (\"webkitTransform\" in style) {\n        prop = \"webkitTransform\";\n      }\n    }\n    this.transformProp = prop;\n  }\n\n  resize = () => {\n    if (!this.box.current || !this.barY.current || !this.trackerY.current) {\n      return;\n    }\n    const clientHeight = this.box.current.clientHeight;\n    const scrollHeight = this.box.current.scrollHeight;\n    let ratio = clientHeight / scrollHeight;\n    let trackerHeight = Math.max(clientHeight * ratio, 40);\n\n    this.ratio = ratio;\n    this.clientHeight = clientHeight;\n    this.scrollHeight = scrollHeight;\n    this.trackerHeight = trackerHeight;\n\n    if (ratio >= 1) {\n      this.barY.current.style.display = \"none\";\n    } else {\n      this.barY.current.style.display = \"\";\n      this.trackerY.current.style.height = `${trackerHeight}px`;\n      this.setTrackerPositionFromScroll(this.box.current.scrollTop);\n    }\n  };\n\n  scroll = () => {\n    if (this.ratio >= 1 || !this.box.current) {\n      return;\n    }\n\n    this.setTrackerPositionFromScroll(this.box.current.scrollTop);\n  };\n\n  setTrackerPosition(scrollTop: number) {\n    this.lastTrackerTop = scrollTop;\n    if (this.trackerY.current !== null) {\n      (this.trackerY.current.style as any)[\n        this.transformProp\n      ] = `translate(0, ${scrollTop}px)`;\n    }\n  }\n\n  setTrackerPositionFromScroll(scrollTop: number) {\n    const progress = scrollTop / (this.scrollHeight - this.clientHeight);\n    this.setTrackerPosition(\n      (this.clientHeight - this.trackerHeight) * progress\n    );\n  }\n\n  setScrollPositionFromTracker(trackerTop: number) {\n    const progress = trackerTop / (this.clientHeight - this.trackerHeight);\n    if (this.box.current !== null) {\n      this.box.current.scrollTop =\n        (this.scrollHeight - this.clientHeight) * progress;\n    }\n  }\n\n  onDragStart = (e: React.MouseEvent) => {\n    e.preventDefault();\n    this.startY = e.clientY;\n    this.trackerTop = this.lastTrackerTop;\n\n    this.props.document!.addEventListener(\"mousemove\", this.onMove);\n    this.props.document!.addEventListener(\"mouseup\", this.onUp);\n  };\n\n  onMove = (e: MouseEvent) => {\n    e.preventDefault();\n    const diff = e.clientY - this.startY;\n    const position = Math.min(\n      Math.max(this.trackerTop + diff, 0),\n      this.clientHeight - this.trackerHeight\n    );\n\n    this.setScrollPositionFromTracker(position);\n  };\n\n  onUp = (e: MouseEvent) => {\n    e.preventDefault();\n    this.props.document!.removeEventListener(\"mousemove\", this.onMove);\n    this.props.document!.removeEventListener(\"mouseup\", this.onUp);\n  };\n\n  render() {\n    const { children, className } = this.props;\n\n    return (\n      <div vkuiClass=\"CustomScrollView\" className={className}>\n        <div vkuiClass=\"CustomScrollView__barY\" ref={this.barY}>\n          <div\n            vkuiClass=\"CustomScrollView__trackerY\"\n            ref={this.trackerY}\n            onMouseDown={this.onDragStart}\n          />\n        </div>\n\n        <div\n          vkuiClass=\"CustomScrollView__box\"\n          tabIndex={-1}\n          ref={this.box}\n          onScroll={this.scroll}\n        >\n          {children}\n        </div>\n      </div>\n    );\n  }\n}\n\n// eslint-disable-next-line import/no-default-export\nexport default withDOM(CustomScrollView);\n"],"file":"CustomScrollView.js"}