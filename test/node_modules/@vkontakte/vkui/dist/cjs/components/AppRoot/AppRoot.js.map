{"version":3,"sources":["../../../../src/components/AppRoot/AppRoot.tsx"],"names":["warn","AppRoot","children","_mode","mode","_embedded","embedded","sizeX","hasMouse","noLegacyClasses","scroll","props","isKeyboardInputActive","rootRef","React","useRef","useState","portalRoot","setPortalRoot","window","document","insets","initialized","current","documentElement","classList","add","classScopingMode","noConflict","process","env","NODE_ENV","portal","createElement","body","appendChild","parentElement","removeChild","noop","parent","classes","concat","remove","key","hasOwnProperty","inset","style","setProperty","removeProperty","SizeType","REGULAR","container","scrollController","useMemo","content","appRoot","keyboardInput"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { useDOM } from \"../../lib/dom\";\nimport { classNames } from \"../../lib/classNames\";\nimport { AppRootContext } from \"./AppRootContext\";\nimport {\n  withAdaptivity,\n  SizeType,\n  AdaptivityProps,\n} from \"../../hoc/withAdaptivity\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { classScopingMode } from \"../../lib/classScopingMode\";\nimport { IconSettingsProvider } from \"@vkontakte/icons\";\nimport {\n  elementScrollController,\n  globalScrollController,\n  ScrollContext,\n  ScrollContextInterface,\n} from \"./ScrollContext\";\nimport { noop } from \"../../lib/utils\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { useKeyboardInputTracker } from \"../../hooks/useKeyboardInputTracker\";\nimport { useInsets } from \"../../hooks/useInsets\";\nimport { Insets } from \"@vkontakte/vk-bridge\";\nimport \"./AppRoot.css\";\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    Pick<AdaptivityProps, \"sizeX\" | \"hasMouse\"> {\n  /** @deprecated Use mode=\"embedded\" */\n  embedded?: boolean;\n  /** Режим встраивания */\n  mode?: \"partial\" | \"embedded\" | \"full\";\n  window?: Window;\n  /** Убирает классы без префикса (.Button) */\n  noLegacyClasses?: boolean;\n  scroll?: \"global\" | \"contain\";\n}\n\nconst warn = warnOnce(\"AppRoot\");\nexport const AppRoot = withAdaptivity<AppRootProps>(\n  ({\n    children,\n    mode: _mode,\n    embedded: _embedded,\n    sizeX,\n    hasMouse,\n    noLegacyClasses = false,\n    scroll = \"global\",\n    ...props\n  }) => {\n    // normalize mode\n    const mode = _mode || (_embedded ? \"embedded\" : \"full\");\n    const isKeyboardInputActive = useKeyboardInputTracker();\n    const rootRef = React.useRef<HTMLDivElement | null>(null);\n    const [portalRoot, setPortalRoot] = React.useState<HTMLDivElement | null>(\n      null\n    );\n    const { window, document } = useDOM();\n    const insets = useInsets();\n\n    const initialized = React.useRef(false);\n    if (!initialized.current) {\n      if (document && mode === \"full\") {\n        document.documentElement.classList.add(\"vkui\");\n      }\n      classScopingMode.noConflict = noLegacyClasses;\n      initialized.current = true;\n    }\n\n    if (process.env.NODE_ENV === \"development\") {\n      if (scroll !== \"global\" && mode !== \"embedded\") {\n        warn(\"Scroll modes only supported in embedded mode\");\n      }\n      if (_mode && _embedded) {\n        warn(`mode=\"${mode}\" overrides embedded`);\n      }\n    }\n\n    // setup portal\n    useIsomorphicLayoutEffect(() => {\n      const portal = document!.createElement(\"div\");\n      portal.classList.add(\"vkui__portal-root\");\n      document!.body.appendChild(portal);\n      setPortalRoot(portal);\n      return () => {\n        portal.parentElement?.removeChild(portal);\n      };\n    }, []);\n\n    // setup root classes\n    useIsomorphicLayoutEffect(() => {\n      if (mode === \"partial\") {\n        return noop;\n      }\n\n      const parent = rootRef.current?.parentElement;\n      const classes = [\"vkui__root\"].concat(\n        mode === \"embedded\" ? \"vkui__root--embedded\" : []\n      );\n      parent?.classList.add(...classes);\n\n      return () => {\n        parent?.classList.remove(...classes);\n        if (mode === \"full\") {\n          document?.documentElement.classList.remove(\"vkui\");\n        }\n      };\n    }, []);\n\n    // setup insets\n    useIsomorphicLayoutEffect(() => {\n      if (mode === \"partial\" || !rootRef.current?.parentElement) {\n        return noop;\n      }\n\n      const parent = rootRef.current.parentElement;\n\n      for (const key in insets) {\n        if (\n          insets.hasOwnProperty(key) &&\n          typeof insets[key as keyof Insets] === \"number\"\n        ) {\n          const inset = insets[key as keyof Insets];\n          parent.style.setProperty(`--safe-area-inset-${key}`, `${inset}px`);\n          portalRoot &&\n            portalRoot.style.setProperty(\n              `--safe-area-inset-${key}`,\n              `${inset}px`\n            );\n        }\n      }\n\n      return () => {\n        for (const key in insets) {\n          if (insets.hasOwnProperty(key)) {\n            parent.style.removeProperty(`--safe-area-inset-${key}`);\n            portalRoot &&\n              portalRoot.style.removeProperty(`--safe-area-inset-${key}`);\n          }\n        }\n      };\n    }, [insets, portalRoot]);\n\n    // adaptivity handler\n    useIsomorphicLayoutEffect(() => {\n      if (mode === \"partial\" || sizeX !== SizeType.REGULAR) {\n        return noop;\n      }\n      const container =\n        mode === \"embedded\" ? rootRef.current?.parentElement : document!.body;\n      container?.classList.add(\"vkui--sizeX-regular\");\n      return () => container?.classList.remove(\"vkui--sizeX-regular\");\n    }, [sizeX]);\n\n    const scrollController = React.useMemo<ScrollContextInterface>(\n      () =>\n        scroll === \"contain\"\n          ? elementScrollController(rootRef)\n          : globalScrollController(window, document),\n      [document, scroll, window]\n    );\n\n    const content = (\n      <AppRootContext.Provider\n        value={{\n          appRoot: rootRef,\n          portalRoot: portalRoot,\n          embedded: mode === \"embedded\",\n          keyboardInput: isKeyboardInputActive,\n          mode,\n        }}\n      >\n        <ScrollContext.Provider value={scrollController}>\n          <IconSettingsProvider\n            classPrefix=\"vkui\"\n            globalClasses={!noLegacyClasses}\n          >\n            {children}\n          </IconSettingsProvider>\n        </ScrollContext.Provider>\n      </AppRootContext.Provider>\n    );\n\n    return mode === \"partial\" ? (\n      content\n    ) : (\n      <div\n        ref={rootRef}\n        vkuiClass={classNames(\"AppRoot\", {\n          \"AppRoot--no-mouse\": !hasMouse,\n        })}\n        {...props}\n      >\n        {content}\n      </div>\n    );\n  },\n  {\n    sizeX: true,\n    hasMouse: true,\n  }\n);\n"],"file":"AppRoot.js"}