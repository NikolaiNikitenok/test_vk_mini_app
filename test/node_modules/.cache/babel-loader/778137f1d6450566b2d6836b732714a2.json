{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _createSuper from \"@babel/runtime/helpers/createSuper\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nvar _excluded = [\"popout\", \"modal\", \"platform\", \"activePanel\", \"splitCol\", \"configProvider\", \"history\", \"nav\", \"onTransition\", \"onSwipeBack\", \"onSwipeBackStart\", \"onSwipeBackCancel\", \"window\", \"document\", \"scroll\"];\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport * as React from \"react\";\nimport { classNames } from \"../../lib/classNames\";\nimport { transitionEvent, animationEvent } from \"../../lib/supportEvents\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { IOS, ANDROID, VKCOM } from \"../../lib/platform\";\nimport { Touch } from \"../Touch/Touch\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport { withContext } from \"../../hoc/withContext\";\nimport { ConfigProviderContext } from \"../ConfigProvider/ConfigProviderContext\";\nimport { SplitColContext } from \"../SplitCol/SplitCol\";\nimport { AppRootPortal } from \"../AppRoot/AppRootPortal\";\nimport { canUseDOM, withDOM } from \"../../lib/dom\";\nimport { ScrollContext } from \"../AppRoot/ScrollContext\";\nimport { NavTransitionProvider } from \"../NavTransitionContext/NavTransitionContext\";\nimport { getNavId } from \"../../lib/getNavId\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { swipeBackExcluded } from \"./utils\";\nvar SwipeBackResults;\n\n(function (SwipeBackResults) {\n  SwipeBackResults[SwipeBackResults[\"fail\"] = 1] = \"fail\";\n  SwipeBackResults[SwipeBackResults[\"success\"] = 2] = \"success\";\n})(SwipeBackResults || (SwipeBackResults = {}));\n\nexport var scrollsCache = {};\nvar warn = warnOnce(\"View\");\n\nvar View = /*#__PURE__*/function (_React$Component) {\n  _inherits(View, _React$Component);\n\n  var _super = _createSuper(View);\n\n  function View(props) {\n    var _this;\n\n    _classCallCheck(this, View);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"scrolls\", scrollsCache[getNavId(_this.props)] || {});\n\n    _defineProperty(_assertThisInitialized(_this), \"transitionFinishTimeout\", undefined);\n\n    _defineProperty(_assertThisInitialized(_this), \"animationFinishTimeout\", undefined);\n\n    _defineProperty(_assertThisInitialized(_this), \"panelNodes\", {});\n\n    _defineProperty(_assertThisInitialized(_this), \"transitionEndHandler\", function (e) {\n      if ((!e || [\"vkui-animation-ios-next-forward\", \"vkui-animation-ios-prev-back\", \"vkui-animation-view-next-forward\", \"vkui-animation-view-prev-back\"].includes(e.animationName)) && _this.state.prevPanel !== null) {\n        _this.flushTransition(_this.state.prevPanel, Boolean(_this.state.isBack));\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"swipingBackTransitionEndHandler\", function (e) {\n      // indexOf because of vendor prefixes in old browsers\n      if (!e || e !== null && e !== void 0 && e.propertyName.includes(\"transform\") && (e === null || e === void 0 ? void 0 : e.target) === _this.pickPanel(_this.state.swipeBackNextPanel)) {\n        switch (_this.state.swipeBackResult) {\n          case SwipeBackResults.fail:\n            _this.onSwipeBackCancel();\n\n            break;\n\n          case SwipeBackResults.success:\n            _this.onSwipeBackSuccess();\n\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onMoveX\", function (e) {\n      if (swipeBackExcluded(e)) {\n        return;\n      }\n\n      var _this$props = _this.props,\n          platform = _this$props.platform,\n          configProvider = _this$props.configProvider;\n\n      if (platform === IOS && !(configProvider !== null && configProvider !== void 0 && configProvider.isWebView) && (e.startX <= 70 || e.startX >= _this.window.innerWidth - 70) && !_this.state.browserSwipe) {\n        _this.setState({\n          browserSwipe: true\n        });\n      }\n\n      if (platform === IOS && configProvider !== null && configProvider !== void 0 && configProvider.isWebView && _this.props.onSwipeBack) {\n        var _this$props$history$l, _this$props$history;\n\n        if (_this.state.animated && e.startX <= 70 || !_this.window) {\n          return;\n        }\n\n        if (e.startX <= 70 && !_this.state.swipingBack && ((_this$props$history$l = (_this$props$history = _this.props.history) === null || _this$props$history === void 0 ? void 0 : _this$props$history.length) !== null && _this$props$history$l !== void 0 ? _this$props$history$l : 0) > 1) {\n          if (_this.state.activePanel !== null) {\n            var _this$props$scroll;\n\n            _this.scrolls[_this.state.activePanel] = (_this$props$scroll = _this.props.scroll) === null || _this$props$scroll === void 0 ? void 0 : _this$props$scroll.getScroll().y;\n          }\n\n          _this.setState({\n            swipingBack: true,\n            swipebackStartX: e.startX,\n            swipeBackPrevPanel: _this.state.activePanel,\n            swipeBackNextPanel: _this.props.history.slice(-2)[0]\n          });\n        }\n\n        if (_this.state.swipingBack) {\n          var swipeBackShift = 0;\n\n          if (e.shiftX < 0) {\n            swipeBackShift = 0;\n          } else if (e.shiftX > _this.window.innerWidth - _this.state.swipebackStartX) {\n            var _this$window;\n\n            swipeBackShift = (_this$window = _this.window) === null || _this$window === void 0 ? void 0 : _this$window.innerWidth;\n          } else {\n            swipeBackShift = e.shiftX;\n          }\n\n          _this.setState({\n            swipeBackShift: swipeBackShift\n          });\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onEnd\", function (e) {\n      if (_this.state.swipingBack && _this.window) {\n        var _this$window$innerWid, _this$window2;\n\n        var speed = _this.state.swipeBackShift / e.duration * 1000;\n\n        if (_this.state.swipeBackShift === 0) {\n          _this.onSwipeBackCancel();\n        } else if (_this.state.swipeBackShift >= ((_this$window$innerWid = (_this$window2 = _this.window) === null || _this$window2 === void 0 ? void 0 : _this$window2.innerWidth) !== null && _this$window$innerWid !== void 0 ? _this$window$innerWid : 0)) {\n          _this.onSwipeBackSuccess();\n        } else if (speed > 250 || _this.state.swipebackStartX + _this.state.swipeBackShift > _this.window.innerWidth / 2) {\n          _this.setState({\n            swipeBackResult: SwipeBackResults.success\n          });\n        } else {\n          _this.setState({\n            swipeBackResult: SwipeBackResults.fail\n          });\n        }\n      }\n    });\n\n    _this.state = {\n      animated: false,\n      visiblePanels: [props.activePanel],\n      activePanel: props.activePanel,\n      isBack: undefined,\n      prevPanel: null,\n      nextPanel: null,\n      swipingBack: false,\n      swipebackStartX: 0,\n      swipeBackShift: 0,\n      swipeBackNextPanel: null,\n      swipeBackPrevPanel: null,\n      swipeBackResult: null,\n      browserSwipe: false\n    };\n    return _this;\n  }\n\n  _createClass(View, [{\n    key: \"document\",\n    get: function get() {\n      return this.props.document;\n    }\n  }, {\n    key: \"window\",\n    get: function get() {\n      return this.props.window;\n    }\n  }, {\n    key: \"panels\",\n    get: function get() {\n      return React.Children.toArray(this.props.children);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (process.env.NODE_ENV === \"development\") {\n        var _this$props2 = this.props,\n            popout = _this$props2.popout,\n            modal = _this$props2.modal;\n        popout && warn(\"Свойство popout устарело и будет удалено в 5.0.0. Используйте одноименное свойство у SplitLayout.\");\n        modal && warn(\"Свойство modal устарело и будет удалено в 5.0.0. Используйте одноименное свойство у SplitLayout.\");\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      var id = getNavId(this.props);\n\n      if (id) {\n        scrollsCache[id] = this.scrolls;\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      var _this2 = this;\n\n      this.props.popout && !prevProps.popout && this.blurActiveElement();\n      this.props.modal && !prevProps.modal && this.blurActiveElement(); // Нужен переход\n\n      if (prevProps.activePanel !== this.props.activePanel && !prevState.swipingBack && !prevState.browserSwipe) {\n        var _this$props$scroll2;\n\n        var firstLayerId = this.panels.map(function (panel) {\n          return getNavId(panel.props, warn);\n        }).find(function (id) {\n          return id === prevProps.activePanel || id === _this2.props.activePanel;\n        });\n        var isBack = firstLayerId === this.props.activePanel;\n        this.scrolls[prevProps.activePanel] = (_this$props$scroll2 = this.props.scroll) === null || _this$props$scroll2 === void 0 ? void 0 : _this$props$scroll2.getScroll().y;\n\n        if (this.shouldDisableTransitionMotion()) {\n          this.flushTransition(prevProps.activePanel, isBack);\n        } else {\n          this.blurActiveElement();\n          this.setState({\n            visiblePanels: [prevProps.activePanel, this.props.activePanel],\n            prevPanel: prevProps.activePanel,\n            nextPanel: this.props.activePanel,\n            activePanel: null,\n            animated: true,\n            isBack: isBack\n          }); // Фолбек анимации перехода\n\n          if (!animationEvent.supported) {\n            if (this.animationFinishTimeout) {\n              clearTimeout(this.animationFinishTimeout);\n            }\n\n            this.animationFinishTimeout = setTimeout(this.transitionEndHandler, this.props.platform === ANDROID || this.props.platform === VKCOM ? 300 : 600);\n          }\n        }\n      } // Закончилась анимация свайпа назад\n\n\n      if (prevProps.activePanel !== this.props.activePanel && prevState.swipingBack) {\n        var nextPanel = this.props.activePanel;\n        var prevPanel = prevProps.activePanel;\n\n        if (prevState.swipeBackPrevPanel !== null) {\n          this.scrolls[prevState.swipeBackPrevPanel] = 0;\n        }\n\n        this.setState({\n          swipeBackPrevPanel: null,\n          swipeBackNextPanel: null,\n          swipingBack: false,\n          swipeBackResult: null,\n          swipebackStartX: 0,\n          swipeBackShift: 0,\n          activePanel: nextPanel,\n          visiblePanels: [nextPanel]\n        }, function () {\n          if (_this2.state.activePanel !== null) {\n            var _this2$props$scroll;\n\n            (_this2$props$scroll = _this2.props.scroll) === null || _this2$props$scroll === void 0 ? void 0 : _this2$props$scroll.scrollTo(0, _this2.scrolls[_this2.state.activePanel]);\n          }\n\n          prevProps.onTransition && prevProps.onTransition({\n            isBack: true,\n            from: prevPanel,\n            to: nextPanel\n          });\n        });\n      } // Начался свайп назад\n\n\n      if (!prevState.swipingBack && this.state.swipingBack) {\n        this.props.onSwipeBackStart && this.props.onSwipeBackStart();\n      } // Началась анимация завершения свайпа назад.\n\n\n      if (!prevState.swipeBackResult && this.state.swipeBackResult) {\n        this.waitTransitionFinish(this.pickPanel(this.state.swipeBackNextPanel), this.swipingBackTransitionEndHandler);\n      } // Если свайп назад отменился (когда пользователь недостаточно сильно свайпнул)\n\n\n      if (prevState.swipeBackResult === SwipeBackResults.fail && !this.state.swipeBackResult && this.state.activePanel !== null) {\n        var _this$props$scroll3;\n\n        (_this$props$scroll3 = this.props.scroll) === null || _this$props$scroll3 === void 0 ? void 0 : _this$props$scroll3.scrollTo(0, this.scrolls[this.state.activePanel]);\n      } // Закончился Safari свайп\n\n\n      if (prevProps.activePanel !== this.props.activePanel && this.state.browserSwipe) {\n        this.setState({\n          browserSwipe: false,\n          nextPanel: null,\n          prevPanel: null,\n          animated: false,\n          visiblePanels: [this.props.activePanel],\n          activePanel: this.props.activePanel\n        });\n      }\n    }\n  }, {\n    key: \"shouldDisableTransitionMotion\",\n    value: function shouldDisableTransitionMotion() {\n      var _this$props$configPro, _this$props$splitCol;\n\n      return ((_this$props$configPro = this.props.configProvider) === null || _this$props$configPro === void 0 ? void 0 : _this$props$configPro.transitionMotionEnabled) === false || !((_this$props$splitCol = this.props.splitCol) !== null && _this$props$splitCol !== void 0 && _this$props$splitCol.animate);\n    }\n  }, {\n    key: \"waitTransitionFinish\",\n    value: function waitTransitionFinish(elem, eventHandler) {\n      if (transitionEvent.supported && transitionEvent.name && elem) {\n        elem.removeEventListener(transitionEvent.name, eventHandler);\n        elem.addEventListener(transitionEvent.name, eventHandler);\n      } else {\n        if (this.transitionFinishTimeout) {\n          clearTimeout(this.transitionFinishTimeout);\n        }\n\n        this.transitionFinishTimeout = setTimeout(eventHandler, this.props.platform === ANDROID || this.props.platform === VKCOM ? 300 : 600);\n      }\n    }\n  }, {\n    key: \"blurActiveElement\",\n    value: function blurActiveElement() {\n      var _this$document;\n\n      if (typeof this.window !== \"undefined\" && (_this$document = this.document) !== null && _this$document !== void 0 && _this$document.activeElement) {\n        this.document.activeElement.blur();\n      }\n    }\n  }, {\n    key: \"pickPanel\",\n    value: function pickPanel(id) {\n      if (id === null) {\n        return undefined;\n      }\n\n      return this.panelNodes[id];\n    }\n  }, {\n    key: \"flushTransition\",\n    value: function flushTransition(prevPanel, isBack) {\n      var _this3 = this;\n\n      var activePanel = this.props.activePanel;\n\n      if (isBack) {\n        this.scrolls[prevPanel] = 0;\n      }\n\n      this.setState({\n        prevPanel: null,\n        nextPanel: null,\n        visiblePanels: [activePanel],\n        activePanel: activePanel,\n        animated: false,\n        isBack: undefined\n      }, function () {\n        var _this3$props$scroll;\n\n        (_this3$props$scroll = _this3.props.scroll) === null || _this3$props$scroll === void 0 ? void 0 : _this3$props$scroll.scrollTo(0, isBack ? _this3.scrolls[activePanel] : 0);\n        _this3.props.onTransition && _this3.props.onTransition({\n          isBack: isBack,\n          from: prevPanel,\n          to: activePanel\n        });\n      });\n    }\n  }, {\n    key: \"onSwipeBackSuccess\",\n    value: function onSwipeBackSuccess() {\n      this.props.onSwipeBack && this.props.onSwipeBack();\n    }\n  }, {\n    key: \"onSwipeBackCancel\",\n    value: function onSwipeBackCancel() {\n      this.props.onSwipeBackCancel && this.props.onSwipeBackCancel();\n      this.setState({\n        swipeBackPrevPanel: null,\n        swipeBackNextPanel: null,\n        swipingBack: false,\n        swipeBackResult: null,\n        swipebackStartX: 0,\n        swipeBackShift: 0\n      });\n    }\n  }, {\n    key: \"calcPanelSwipeStyles\",\n    value: function calcPanelSwipeStyles(panelId) {\n      if (!canUseDOM || !this.window) {\n        return {};\n      }\n\n      var isPrev = panelId === this.state.swipeBackPrevPanel;\n      var isNext = panelId === this.state.swipeBackNextPanel;\n\n      if (!isPrev && !isNext || this.state.swipeBackResult) {\n        return {};\n      }\n\n      var prevPanelTranslate = \"\".concat(this.state.swipeBackShift, \"px\");\n      var nextPanelTranslate = \"\".concat(-50 + this.state.swipeBackShift * 100 / this.window.innerWidth / 2, \"%\");\n      var prevPanelShadow = 0.3 * (this.window.innerWidth - this.state.swipeBackShift) / this.window.innerWidth;\n\n      if (this.state.swipeBackResult) {\n        return isPrev ? {\n          boxShadow: \"-2px 0 12px rgba(0, 0, 0, \".concat(prevPanelShadow, \")\")\n        } : {};\n      }\n\n      if (isNext) {\n        return {\n          transform: \"translate3d(\".concat(nextPanelTranslate, \", 0, 0)\"),\n          WebkitTransform: \"translate3d(\".concat(nextPanelTranslate, \", 0, 0)\")\n        };\n      }\n\n      if (isPrev) {\n        return {\n          transform: \"translate3d(\".concat(prevPanelTranslate, \", 0, 0)\"),\n          WebkitTransform: \"translate3d(\".concat(prevPanelTranslate, \", 0, 0)\"),\n          boxShadow: \"-2px 0 12px rgba(0, 0, 0, \".concat(prevPanelShadow, \")\")\n        };\n      }\n\n      return {};\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var _this$props3 = this.props,\n          popout = _this$props3.popout,\n          modal = _this$props3.modal,\n          platform = _this$props3.platform,\n          _1 = _this$props3.activePanel,\n          splitCol = _this$props3.splitCol,\n          configProvider = _this$props3.configProvider,\n          history = _this$props3.history,\n          nav = _this$props3.nav,\n          onTransition = _this$props3.onTransition,\n          onSwipeBack = _this$props3.onSwipeBack,\n          onSwipeBackStart = _this$props3.onSwipeBackStart,\n          onSwipeBackCancel = _this$props3.onSwipeBackCancel,\n          window = _this$props3.window,\n          document = _this$props3.document,\n          scroll = _this$props3.scroll,\n          restProps = _objectWithoutProperties(_this$props3, _excluded);\n\n      var _this$state = this.state,\n          prevPanel = _this$state.prevPanel,\n          nextPanel = _this$state.nextPanel,\n          activePanel = _this$state.activePanel,\n          swipeBackPrevPanel = _this$state.swipeBackPrevPanel,\n          swipeBackNextPanel = _this$state.swipeBackNextPanel,\n          swipeBackResult = _this$state.swipeBackResult,\n          isBack = _this$state.isBack,\n          animated = _this$state.animated;\n      var hasPopout = !!popout;\n      var hasModal = !!modal;\n      var panels = this.panels.filter(function (panel) {\n        var panelId = getNavId(panel.props, warn);\n        return panelId !== undefined && _this4.state.visiblePanels.includes(panelId) || panelId === swipeBackPrevPanel || panelId === swipeBackNextPanel;\n      });\n      var disableAnimation = this.shouldDisableTransitionMotion();\n      var modifiers = {\n        \"View--animated\": !disableAnimation && animated,\n        \"View--swiping-back\": !disableAnimation && this.state.swipingBack,\n        \"View--no-motion\": disableAnimation\n      };\n      return createScopedElement(Touch, _extends({\n        Component: \"section\"\n      }, restProps, {\n        vkuiClass: classNames(getClassName(\"View\", platform), modifiers),\n        onMoveX: this.onMoveX,\n        onEnd: this.onEnd\n      }), createScopedElement(\"div\", {\n        vkuiClass: \"View__panels\"\n      }, panels.map(function (panel) {\n        var _this4$scrolls;\n\n        var panelId = getNavId(panel.props, warn);\n        var isPrev = panelId === prevPanel || panelId === swipeBackPrevPanel;\n        var isTransitionTarget = animated && panelId === (isBack ? prevPanel : nextPanel);\n        var compensateScroll = isPrev || panelId === swipeBackNextPanel || panelId === nextPanel && isBack;\n        return createScopedElement(\"div\", {\n          vkuiClass: classNames(\"View__panel\", {\n            \"View__panel--active\": panelId === activePanel,\n            \"View__panel--prev\": panelId === prevPanel,\n            \"View__panel--next\": panelId === nextPanel,\n            \"View__panel--swipe-back-prev\": panelId === swipeBackPrevPanel,\n            \"View__panel--swipe-back-next\": panelId === swipeBackNextPanel,\n            \"View__panel--swipe-back-success\": swipeBackResult === SwipeBackResults.success,\n            \"View__panel--swipe-back-failed\": swipeBackResult === SwipeBackResults.fail\n          }),\n          onAnimationEnd: isTransitionTarget ? _this4.transitionEndHandler : undefined,\n          ref: function ref(el) {\n            return panelId !== undefined && (_this4.panelNodes[panelId] = el);\n          },\n          style: _this4.calcPanelSwipeStyles(panelId),\n          key: panelId\n        }, createScopedElement(\"div\", {\n          vkuiClass: \"View__panel-in\",\n          style: {\n            marginTop: compensateScroll ? -((_this4$scrolls = _this4.scrolls[panelId]) !== null && _this4$scrolls !== void 0 ? _this4$scrolls : 0) : undefined\n          }\n        }, createScopedElement(NavTransitionProvider, {\n          entering: panelId === nextPanel || panelId === swipeBackNextPanel\n        }, panel)));\n      })), createScopedElement(AppRootPortal, null, hasPopout && createScopedElement(\"div\", {\n        vkuiClass: \"View__popout\"\n      }, popout), hasModal && createScopedElement(\"div\", {\n        vkuiClass: \"View__modal\"\n      }, modal)));\n    }\n  }]);\n\n  return View;\n}(React.Component); // eslint-disable-next-line import/no-default-export\n\n\n_defineProperty(View, \"defaultProps\", {\n  history: []\n});\n\nexport default withContext(withContext(withContext(withPlatform(withDOM(View)), SplitColContext, \"splitCol\"), ConfigProviderContext, \"configProvider\"), ScrollContext, \"scroll\");","map":{"version":3,"mappings":"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","names":["React","classNames","transitionEvent","animationEvent","getClassName","IOS","ANDROID","VKCOM","Touch","withPlatform","withContext","ConfigProviderContext","SplitColContext","AppRootPortal","canUseDOM","withDOM","ScrollContext","NavTransitionProvider","getNavId","warnOnce","swipeBackExcluded","SwipeBackResults","scrollsCache","warn","View","props","_classCallCheck","_this","_defineProperty","undefined","e","includes","animationName","state","prevPanel","flushTransition","Boolean","isBack","propertyName","target","pickPanel","swipeBackNextPanel","swipeBackResult","fail","onSwipeBackCancel","success","onSwipeBackSuccess","platform","configProvider","isWebView","startX","window","innerWidth","browserSwipe","setState","onSwipeBack","animated","swipingBack","history","_this$props$history","length","activePanel","scrolls","scroll","_this$props$scroll","getScroll","y","swipebackStartX","swipeBackPrevPanel","slice","swipeBackShift","shiftX","_this$window","speed","duration","_this$window2","visiblePanels","nextPanel","document","Children","toArray","children","process","env","NODE_ENV","popout","modal","id","prevProps","prevState","blurActiveElement","firstLayerId","panels","map","panel","find","_this2","_this$props$scroll2","shouldDisableTransitionMotion","supported","animationFinishTimeout","clearTimeout","setTimeout","transitionEndHandler","scrollTo","onTransition","from","to","onSwipeBackStart","waitTransitionFinish","swipingBackTransitionEndHandler","transitionMotionEnabled","splitCol","_this$props$splitCol","animate","elem","eventHandler","name","removeEventListener","addEventListener","transitionFinishTimeout","_this$document","activeElement","blur","panelNodes","_this3","panelId","isPrev","isNext","prevPanelTranslate","nextPanelTranslate","prevPanelShadow","boxShadow","transform","WebkitTransform","_1","nav","restProps","hasPopout","hasModal","filter","_this4","disableAnimation","modifiers","createScopedElement","Component","vkuiClass","onMoveX","onEnd","isTransitionTarget","compensateScroll","onAnimationEnd","ref","el","style","calcPanelSwipeStyles","key","marginTop","entering"],"sources":["../../../src/components/View/View.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { classNames } from \"../../lib/classNames\";\nimport { transitionEvent, animationEvent } from \"../../lib/supportEvents\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { IOS, ANDROID, VKCOM } from \"../../lib/platform\";\nimport { Touch, TouchEvent } from \"../Touch/Touch\";\nimport { HasPlatform } from \"../../types\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport { withContext } from \"../../hoc/withContext\";\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n} from \"../ConfigProvider/ConfigProviderContext\";\nimport { SplitColContext, SplitColContextProps } from \"../SplitCol/SplitCol\";\nimport { AppRootPortal } from \"../AppRoot/AppRootPortal\";\nimport { canUseDOM, withDOM, DOMProps } from \"../../lib/dom\";\nimport {\n  ScrollContext,\n  ScrollContextInterface,\n} from \"../AppRoot/ScrollContext\";\nimport { NavTransitionProvider } from \"../NavTransitionContext/NavTransitionContext\";\nimport { getNavId, NavIdProps } from \"../../lib/getNavId\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { swipeBackExcluded } from \"./utils\";\nimport \"./View.css\";\n\nenum SwipeBackResults {\n  fail = 1,\n  success,\n}\n\ninterface Scrolls {\n  [index: string]: number | undefined;\n}\n\ninterface ViewsScrolls {\n  [index: string]: Scrolls;\n}\n\ntype TransitionEventHandler = (e?: TransitionEvent) => void;\n\nexport let scrollsCache: ViewsScrolls = {};\n\nexport interface ViewProps\n  extends React.HTMLAttributes<HTMLElement>,\n    HasPlatform,\n    NavIdProps {\n  activePanel: string;\n  /**\n   * @deprecated будет удалено в 5.0.0. Используйте одноименное свойство у `SplitLayout`.\n   *\n   * Свойство для отрисовки `Alert`, `ActionSheet` и `ScreenSpinner`.\n   */\n  popout?: React.ReactNode;\n  /**\n   * @deprecated будет удалено в 5.0.0. Используйте одноименное свойство у `SplitLayout`.\n   *\n   * Свойство для отрисовки `ModalRoot`.\n   */\n  modal?: React.ReactNode;\n  onTransition?(params: { isBack: boolean; from: string; to: string }): void;\n  /**\n   * callback свайпа назад\n   */\n  onSwipeBack?(): void;\n  /**\n   * callback начала анимации свайпа назад.\n   */\n  onSwipeBackStart?(): void;\n  /**\n   * callback завершения анимации отмененного пользователем свайпа\n   */\n  onSwipeBackCancel?(): void;\n  history?: string[];\n  /**\n   * @ignore\n   */\n  splitCol?: SplitColContextProps;\n  /**\n   * @ignore\n   */\n  configProvider?: ConfigProviderContextInterface;\n  /**\n   * @ignore\n   */\n  scroll?: ScrollContextInterface;\n}\n\nexport interface ViewState {\n  animated: boolean;\n\n  visiblePanels: string[];\n  activePanel: string | null;\n  isBack: boolean | undefined;\n  prevPanel: string | null;\n  nextPanel: string | null;\n\n  swipingBack: boolean;\n  swipebackStartX: number;\n  swipeBackShift: number;\n  swipeBackNextPanel: string | null;\n  swipeBackPrevPanel: string | null;\n  swipeBackResult: SwipeBackResults | null;\n\n  browserSwipe: boolean;\n}\n\nconst warn = warnOnce(\"View\");\nclass View extends React.Component<ViewProps & DOMProps, ViewState> {\n  constructor(props: ViewProps) {\n    super(props);\n\n    this.state = {\n      animated: false,\n\n      visiblePanels: [props.activePanel],\n      activePanel: props.activePanel,\n      isBack: undefined,\n      prevPanel: null,\n      nextPanel: null,\n\n      swipingBack: false,\n      swipebackStartX: 0,\n      swipeBackShift: 0,\n      swipeBackNextPanel: null,\n      swipeBackPrevPanel: null,\n      swipeBackResult: null,\n\n      browserSwipe: false,\n    };\n  }\n\n  static defaultProps: Partial<ViewProps> = {\n    history: [],\n  };\n\n  private readonly scrolls = scrollsCache[getNavId(this.props) as string] || {};\n  private transitionFinishTimeout: number | undefined = undefined;\n  private animationFinishTimeout: number | undefined = undefined;\n\n  get document() {\n    return this.props.document;\n  }\n\n  get window() {\n    return this.props.window;\n  }\n\n  get panels() {\n    return React.Children.toArray(this.props.children) as React.ReactElement[];\n  }\n\n  panelNodes: { [id: string]: HTMLDivElement | null } = {};\n\n  componentDidMount() {\n    if (process.env.NODE_ENV === \"development\") {\n      const { popout, modal } = this.props;\n      popout &&\n        warn(\n          \"Свойство popout устарело и будет удалено в 5.0.0. Используйте одноименное свойство у SplitLayout.\"\n        );\n      modal &&\n        warn(\n          \"Свойство modal устарело и будет удалено в 5.0.0. Используйте одноименное свойство у SplitLayout.\"\n        );\n    }\n  }\n\n  componentWillUnmount() {\n    const id = getNavId(this.props);\n    if (id) {\n      scrollsCache[id] = this.scrolls;\n    }\n  }\n\n  componentDidUpdate(prevProps: ViewProps, prevState: ViewState) {\n    this.props.popout && !prevProps.popout && this.blurActiveElement();\n    this.props.modal && !prevProps.modal && this.blurActiveElement();\n\n    // Нужен переход\n    if (\n      prevProps.activePanel !== this.props.activePanel &&\n      !prevState.swipingBack &&\n      !prevState.browserSwipe\n    ) {\n      const firstLayerId = this.panels\n        .map((panel) => getNavId(panel.props, warn))\n        .find(\n          (id) => id === prevProps.activePanel || id === this.props.activePanel\n        );\n\n      const isBack = firstLayerId === this.props.activePanel;\n      this.scrolls[prevProps.activePanel] = this.props.scroll?.getScroll().y;\n\n      if (this.shouldDisableTransitionMotion()) {\n        this.flushTransition(prevProps.activePanel, isBack);\n      } else {\n        this.blurActiveElement();\n\n        this.setState({\n          visiblePanels: [prevProps.activePanel, this.props.activePanel],\n          prevPanel: prevProps.activePanel,\n          nextPanel: this.props.activePanel,\n          activePanel: null,\n          animated: true,\n          isBack,\n        });\n\n        // Фолбек анимации перехода\n        if (!animationEvent.supported) {\n          if (this.animationFinishTimeout) {\n            clearTimeout(this.animationFinishTimeout);\n          }\n          this.animationFinishTimeout = setTimeout(\n            this.transitionEndHandler,\n            this.props.platform === ANDROID || this.props.platform === VKCOM\n              ? 300\n              : 600\n          );\n        }\n      }\n    }\n\n    // Закончилась анимация свайпа назад\n    if (\n      prevProps.activePanel !== this.props.activePanel &&\n      prevState.swipingBack\n    ) {\n      const nextPanel = this.props.activePanel;\n      const prevPanel = prevProps.activePanel;\n      if (prevState.swipeBackPrevPanel !== null) {\n        this.scrolls[prevState.swipeBackPrevPanel] = 0;\n      }\n      this.setState(\n        {\n          swipeBackPrevPanel: null,\n          swipeBackNextPanel: null,\n          swipingBack: false,\n          swipeBackResult: null,\n          swipebackStartX: 0,\n          swipeBackShift: 0,\n          activePanel: nextPanel,\n          visiblePanels: [nextPanel],\n        },\n        () => {\n          if (this.state.activePanel !== null) {\n            this.props.scroll?.scrollTo(\n              0,\n              this.scrolls[this.state.activePanel]\n            );\n          }\n          prevProps.onTransition &&\n            prevProps.onTransition({\n              isBack: true,\n              from: prevPanel,\n              to: nextPanel,\n            });\n        }\n      );\n    }\n\n    // Начался свайп назад\n    if (!prevState.swipingBack && this.state.swipingBack) {\n      this.props.onSwipeBackStart && this.props.onSwipeBackStart();\n    }\n\n    // Началась анимация завершения свайпа назад.\n    if (!prevState.swipeBackResult && this.state.swipeBackResult) {\n      this.waitTransitionFinish(\n        this.pickPanel(this.state.swipeBackNextPanel),\n        this.swipingBackTransitionEndHandler\n      );\n    }\n\n    // Если свайп назад отменился (когда пользователь недостаточно сильно свайпнул)\n    if (\n      prevState.swipeBackResult === SwipeBackResults.fail &&\n      !this.state.swipeBackResult &&\n      this.state.activePanel !== null\n    ) {\n      this.props.scroll?.scrollTo(0, this.scrolls[this.state.activePanel]);\n    }\n\n    // Закончился Safari свайп\n    if (\n      prevProps.activePanel !== this.props.activePanel &&\n      this.state.browserSwipe\n    ) {\n      this.setState({\n        browserSwipe: false,\n        nextPanel: null,\n        prevPanel: null,\n        animated: false,\n        visiblePanels: [this.props.activePanel],\n        activePanel: this.props.activePanel,\n      });\n    }\n  }\n\n  shouldDisableTransitionMotion(): boolean {\n    return (\n      this.props.configProvider?.transitionMotionEnabled === false ||\n      !this.props.splitCol?.animate\n    );\n  }\n\n  waitTransitionFinish(\n    elem: HTMLElement | null | undefined,\n    eventHandler: TransitionEventHandler\n  ): void {\n    if (transitionEvent.supported && transitionEvent.name && elem) {\n      elem.removeEventListener(\n        transitionEvent.name as keyof HTMLElementEventMap,\n        eventHandler as EventListener\n      );\n      elem.addEventListener(\n        transitionEvent.name as keyof HTMLElementEventMap,\n        eventHandler as EventListener\n      );\n    } else {\n      if (this.transitionFinishTimeout) {\n        clearTimeout(this.transitionFinishTimeout);\n      }\n      this.transitionFinishTimeout = setTimeout(\n        eventHandler,\n        this.props.platform === ANDROID || this.props.platform === VKCOM\n          ? 300\n          : 600\n      );\n    }\n  }\n\n  blurActiveElement(): void {\n    if (typeof this.window !== \"undefined\" && this.document?.activeElement) {\n      (this.document.activeElement as HTMLElement).blur();\n    }\n  }\n\n  pickPanel(id: string | null) {\n    if (id === null) {\n      return undefined;\n    }\n    return this.panelNodes[id];\n  }\n\n  flushTransition(prevPanel: string, isBack: boolean) {\n    const activePanel = this.props.activePanel;\n    if (isBack) {\n      this.scrolls[prevPanel] = 0;\n    }\n    this.setState(\n      {\n        prevPanel: null,\n        nextPanel: null,\n        visiblePanels: [activePanel],\n        activePanel,\n        animated: false,\n        isBack: undefined,\n      },\n      () => {\n        this.props.scroll?.scrollTo(0, isBack ? this.scrolls[activePanel] : 0);\n        this.props.onTransition &&\n          this.props.onTransition({ isBack, from: prevPanel, to: activePanel });\n      }\n    );\n  }\n\n  transitionEndHandler = (e?: React.AnimationEvent): void => {\n    if (\n      (!e ||\n        [\n          \"vkui-animation-ios-next-forward\",\n          \"vkui-animation-ios-prev-back\",\n          \"vkui-animation-view-next-forward\",\n          \"vkui-animation-view-prev-back\",\n        ].includes(e.animationName)) &&\n      this.state.prevPanel !== null\n    ) {\n      this.flushTransition(this.state.prevPanel, Boolean(this.state.isBack));\n    }\n  };\n\n  swipingBackTransitionEndHandler = (e?: TransitionEvent): void => {\n    // indexOf because of vendor prefixes in old browsers\n    if (\n      !e ||\n      (e?.propertyName.includes(\"transform\") &&\n        e?.target === this.pickPanel(this.state.swipeBackNextPanel))\n    ) {\n      switch (this.state.swipeBackResult) {\n        case SwipeBackResults.fail:\n          this.onSwipeBackCancel();\n          break;\n        case SwipeBackResults.success:\n          this.onSwipeBackSuccess();\n      }\n    }\n  };\n\n  onSwipeBackSuccess(): void {\n    this.props.onSwipeBack && this.props.onSwipeBack();\n  }\n\n  onSwipeBackCancel(): void {\n    this.props.onSwipeBackCancel && this.props.onSwipeBackCancel();\n    this.setState({\n      swipeBackPrevPanel: null,\n      swipeBackNextPanel: null,\n      swipingBack: false,\n      swipeBackResult: null,\n      swipebackStartX: 0,\n      swipeBackShift: 0,\n    });\n  }\n\n  onMoveX = (e: TouchEvent): void => {\n    if (swipeBackExcluded(e)) {\n      return;\n    }\n\n    const { platform, configProvider } = this.props;\n\n    if (\n      platform === IOS &&\n      !configProvider?.isWebView &&\n      (e.startX <= 70 || e.startX >= this.window!.innerWidth - 70) &&\n      !this.state.browserSwipe\n    ) {\n      this.setState({ browserSwipe: true });\n    }\n\n    if (\n      platform === IOS &&\n      configProvider?.isWebView &&\n      this.props.onSwipeBack\n    ) {\n      if ((this.state.animated && e.startX <= 70) || !this.window) {\n        return;\n      }\n\n      if (\n        e.startX <= 70 &&\n        !this.state.swipingBack &&\n        (this.props.history?.length ?? 0) > 1\n      ) {\n        if (this.state.activePanel !== null) {\n          this.scrolls[this.state.activePanel] =\n            this.props.scroll?.getScroll().y;\n        }\n        this.setState({\n          swipingBack: true,\n          swipebackStartX: e.startX,\n          swipeBackPrevPanel: this.state.activePanel,\n          swipeBackNextPanel: this.props.history!.slice(-2)[0],\n        });\n      }\n      if (this.state.swipingBack) {\n        let swipeBackShift = 0;\n        if (e.shiftX < 0) {\n          swipeBackShift = 0;\n        } else if (\n          e.shiftX >\n          this.window.innerWidth - this.state.swipebackStartX\n        ) {\n          swipeBackShift = this.window?.innerWidth;\n        } else {\n          swipeBackShift = e.shiftX;\n        }\n        this.setState({ swipeBackShift });\n      }\n    }\n  };\n\n  onEnd = (e: TouchEvent): void => {\n    if (this.state.swipingBack && this.window) {\n      const speed = (this.state.swipeBackShift / e.duration) * 1000;\n      if (this.state.swipeBackShift === 0) {\n        this.onSwipeBackCancel();\n      } else if (this.state.swipeBackShift >= (this.window?.innerWidth ?? 0)) {\n        this.onSwipeBackSuccess();\n      } else if (\n        speed > 250 ||\n        this.state.swipebackStartX + this.state.swipeBackShift >\n          this.window.innerWidth / 2\n      ) {\n        this.setState({ swipeBackResult: SwipeBackResults.success });\n      } else {\n        this.setState({ swipeBackResult: SwipeBackResults.fail });\n      }\n    }\n  };\n\n  calcPanelSwipeStyles(panelId: string | undefined): React.CSSProperties {\n    if (!canUseDOM || !this.window) {\n      return {};\n    }\n\n    const isPrev = panelId === this.state.swipeBackPrevPanel;\n    const isNext = panelId === this.state.swipeBackNextPanel;\n\n    if ((!isPrev && !isNext) || this.state.swipeBackResult) {\n      return {};\n    }\n\n    let prevPanelTranslate = `${this.state.swipeBackShift}px`;\n    let nextPanelTranslate = `${\n      -50 + (this.state.swipeBackShift * 100) / this.window.innerWidth / 2\n    }%`;\n    let prevPanelShadow =\n      (0.3 * (this.window.innerWidth - this.state.swipeBackShift)) /\n      this.window.innerWidth;\n\n    if (this.state.swipeBackResult) {\n      return isPrev\n        ? { boxShadow: `-2px 0 12px rgba(0, 0, 0, ${prevPanelShadow})` }\n        : {};\n    }\n\n    if (isNext) {\n      return {\n        transform: `translate3d(${nextPanelTranslate}, 0, 0)`,\n        WebkitTransform: `translate3d(${nextPanelTranslate}, 0, 0)`,\n      };\n    }\n    if (isPrev) {\n      return {\n        transform: `translate3d(${prevPanelTranslate}, 0, 0)`,\n        WebkitTransform: `translate3d(${prevPanelTranslate}, 0, 0)`,\n        boxShadow: `-2px 0 12px rgba(0, 0, 0, ${prevPanelShadow})`,\n      };\n    }\n\n    return {};\n  }\n\n  render() {\n    const {\n      popout,\n      modal,\n      platform,\n      activePanel: _1,\n      splitCol,\n      configProvider,\n      history,\n      nav,\n      onTransition,\n      onSwipeBack,\n      onSwipeBackStart,\n      onSwipeBackCancel,\n      window,\n      document,\n      scroll,\n      ...restProps\n    } = this.props;\n    const {\n      prevPanel,\n      nextPanel,\n      activePanel,\n      swipeBackPrevPanel,\n      swipeBackNextPanel,\n      swipeBackResult,\n      isBack,\n      animated,\n    } = this.state;\n\n    const hasPopout = !!popout;\n    const hasModal = !!modal;\n\n    const panels = this.panels.filter((panel: React.ReactElement) => {\n      const panelId = getNavId(panel.props, warn);\n\n      return (\n        (panelId !== undefined && this.state.visiblePanels.includes(panelId)) ||\n        panelId === swipeBackPrevPanel ||\n        panelId === swipeBackNextPanel\n      );\n    });\n\n    const disableAnimation = this.shouldDisableTransitionMotion();\n\n    const modifiers = {\n      \"View--animated\": !disableAnimation && animated,\n      \"View--swiping-back\": !disableAnimation && this.state.swipingBack,\n      \"View--no-motion\": disableAnimation,\n    };\n\n    return (\n      <Touch\n        Component=\"section\"\n        {...restProps}\n        vkuiClass={classNames(getClassName(\"View\", platform), modifiers)}\n        onMoveX={this.onMoveX}\n        onEnd={this.onEnd}\n      >\n        <div vkuiClass=\"View__panels\">\n          {panels.map((panel: React.ReactElement) => {\n            const panelId = getNavId(panel.props, warn);\n            const isPrev =\n              panelId === prevPanel || panelId === swipeBackPrevPanel;\n            const isTransitionTarget =\n              animated && panelId === (isBack ? prevPanel : nextPanel);\n            const compensateScroll =\n              isPrev ||\n              panelId === swipeBackNextPanel ||\n              (panelId === nextPanel && isBack);\n\n            return (\n              <div\n                vkuiClass={classNames(\"View__panel\", {\n                  \"View__panel--active\": panelId === activePanel,\n                  \"View__panel--prev\": panelId === prevPanel,\n                  \"View__panel--next\": panelId === nextPanel,\n                  \"View__panel--swipe-back-prev\":\n                    panelId === swipeBackPrevPanel,\n                  \"View__panel--swipe-back-next\":\n                    panelId === swipeBackNextPanel,\n                  \"View__panel--swipe-back-success\":\n                    swipeBackResult === SwipeBackResults.success,\n                  \"View__panel--swipe-back-failed\":\n                    swipeBackResult === SwipeBackResults.fail,\n                })}\n                onAnimationEnd={\n                  isTransitionTarget ? this.transitionEndHandler : undefined\n                }\n                ref={(el) =>\n                  panelId !== undefined && (this.panelNodes[panelId] = el)\n                }\n                style={this.calcPanelSwipeStyles(panelId)}\n                key={panelId}\n              >\n                <div\n                  vkuiClass=\"View__panel-in\"\n                  style={{\n                    marginTop: compensateScroll\n                      ? -(this.scrolls[panelId as string] ?? 0)\n                      : undefined,\n                  }}\n                >\n                  <NavTransitionProvider\n                    entering={\n                      panelId === nextPanel || panelId === swipeBackNextPanel\n                    }\n                  >\n                    {panel}\n                  </NavTransitionProvider>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n        <AppRootPortal>\n          {hasPopout && <div vkuiClass=\"View__popout\">{popout}</div>}\n          {hasModal && <div vkuiClass=\"View__modal\">{modal}</div>}\n        </AppRootPortal>\n      </Touch>\n    );\n  }\n}\n\n// eslint-disable-next-line import/no-default-export\nexport default withContext(\n  withContext(\n    withContext(\n      withPlatform(withDOM<ViewProps>(View)),\n      SplitColContext,\n      \"splitCol\"\n    ),\n    ConfigProviderContext,\n    \"configProvider\"\n  ),\n  ScrollContext,\n  \"scroll\"\n);\n"]},"metadata":{},"sourceType":"module"}