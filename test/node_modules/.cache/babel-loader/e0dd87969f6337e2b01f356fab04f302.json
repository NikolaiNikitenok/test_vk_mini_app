{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport * as React from \"react\";\nimport { useDOM } from \"../lib/dom\";\nimport { useGlobalEventListener } from \"./useGlobalEventListener\";\n/**\n Проверяет, закрыла ли клавиатура часть экрана, 24% подошло к большиству устройств\n Работает на iOS и Android, где софт-клавиатура ресайзит viewport в браузерах\n */\n\nexport function getPreciseKeyboardState(window) {\n  var innerHeight = window.innerHeight,\n      availHeight = window.screen.availHeight;\n  var coveredViewportPercentage = Math.round((1 - innerHeight / availHeight) * 100);\n  return coveredViewportPercentage > 24;\n}\nvar eventOptions = {\n  passive: true,\n  capture: false\n};\nexport function useKeyboard() {\n  var _document$activeEleme3;\n\n  var _useDOM = useDOM(),\n      window = _useDOM.window,\n      document = _useDOM.document;\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      isOpened = _React$useState2[0],\n      setIsOpened = _React$useState2[1];\n\n  var _React$useState3 = React.useState(false),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      isPrecise = _React$useState4[0],\n      setIsPrecise = _React$useState4[1];\n\n  var transitionalTimeout = React.useRef(null);\n  var onFocus = React.useCallback(function (event) {\n    var _document$activeEleme, _document$activeEleme2;\n\n    if (transitionalTimeout.current) {\n      clearTimeout(transitionalTimeout.current);\n    }\n\n    var isOpened = (event === true || event.type === \"focusin\") && ((document === null || document === void 0 ? void 0 : (_document$activeEleme = document.activeElement) === null || _document$activeEleme === void 0 ? void 0 : _document$activeEleme.tagName) === \"INPUT\" || (document === null || document === void 0 ? void 0 : (_document$activeEleme2 = document.activeElement) === null || _document$activeEleme2 === void 0 ? void 0 : _document$activeEleme2.tagName) === \"TEXTAREA\");\n    setIsOpened(isOpened);\n    setIsPrecise(false); // Ожидаем прохождение анимации раскрытия клавиатуры\n\n    transitionalTimeout.current = setTimeout(function () {\n      setIsOpened(isOpened);\n      setIsPrecise(getPreciseKeyboardState(window));\n    }, 300);\n  }, [document === null || document === void 0 ? void 0 : (_document$activeEleme3 = document.activeElement) === null || _document$activeEleme3 === void 0 ? void 0 : _document$activeEleme3.tagName, window]);\n  /**\n   У полей с autoFocus не отлавливаются события focus, для этого вызываем вручную,\n   чтобы иметь хоть какое-то понимание происходящего.\n   */\n\n  React.useEffect(function () {\n    onFocus(true);\n  }, [onFocus]);\n  useGlobalEventListener(document, \"focusout\", onFocus, eventOptions);\n  useGlobalEventListener(document, \"focusin\", onFocus, eventOptions);\n  return {\n    isOpened: isOpened,\n    isPrecise: isPrecise\n  };\n}","map":{"version":3,"mappings":";AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAASC,MAAT;AACA,SAASC,sBAAT;AAOA;AACA;AACA;AACA;;AACA,OAAO,SAASC,uBAAT,CAAiCC,MAAjC,EAAuD;AAC5D,MACEC,WADF,GAGID,MAHJ,CACEC,WADF;AAAA,MAEYC,WAFZ,GAGIF,MAHJ,CAEEG,MACEH,CADQE,WAFZ;AAKA,MAAME,yBAAyB,GAAGC,IAAI,CAACC,KAALD,CAChC,CAAC,IAAIJ,WAAW,GAAGC,WAAnB,IAAkC,GADFG,CAAlC;AAGA,SAAOD,yBAAyB,GAAG,EAAnC;AACD;AAED,IAAMG,YAAY,GAAG;AACnBC,SAAO,EAAE,IADU;AAEnBC,SAAO,EAAE;AAFU,CAArB;AAKA,OAAO,SAASC,WAAT,GAA8C;AAAA;;AACnD,gBAA6Bb,MAAM,EAAnC;AAAA,MAAQG,MAAR,WAAQA,MAAR;AAAA,MAAgBW,QAAhB,WAAgBA,QAAhB;;AAEA,wBAAgCf,KAAK,CAACgB,QAANhB,CAAe,KAAfA,CAAhC;AAAA;AAAA,MAAOiB,QAAP;AAAA,MAAiBC,WAAjB;;AACA,yBAAkClB,KAAK,CAACgB,QAANhB,CAAe,KAAfA,CAAlC;AAAA;AAAA,MAAOmB,SAAP;AAAA,MAAkBC,YAAlB;;AAEA,MAAMC,mBAAmB,GAAGrB,KAAK,CAACsB,MAANtB,CAElB,IAFkBA,CAA5B;AAIA,MAAMuB,OAAO,GAAGvB,KAAK,CAACwB,WAANxB,CACd,UAACyB,KAAD,EAA8B;AAAA;;AAC5B,QAAIJ,mBAAmB,CAACK,OAAxB,EAAiC;AAC/BC,kBAAY,CAACN,mBAAmB,CAACK,OAArB,CAAZC;AACD;;AAED,QAAMV,QAAQ,GACZ,CAACQ,KAAK,KAAK,IAAVA,IAAkBA,KAAK,CAACG,IAANH,KAAe,SAAlC,MACC,SAAQ,SAARV,YAAQ,WAARA,6CAAQ,CAAEc,aAAV,gFAAyBC,OAAzB,MAAqC,OAArC,IACC,SAAQ,SAARf,YAAQ,WAARA,8CAAQ,CAAEc,aAAV,kFAAyBC,OAAzB,MAAqC,UAFvC,CADF;AAIAZ,eAAW,CAACD,QAAD,CAAXC;AACAE,gBAAY,CAAC,KAAD,CAAZA,CAV4B,CAY5B;;AACAC,uBAAmB,CAACK,OAApBL,GAA8BU,UAAU,CAAC,YAAM;AAC7Cb,iBAAW,CAACD,QAAD,CAAXC;AACAE,kBAAY,CAACjB,uBAAuB,CAACC,MAAD,CAAxB,CAAZgB;AAFsC,OAGrC,GAHqC,CAAxCC;AAdY,KAmBd,CAACN,QAAD,SAACA,YAAD,WAACA,GAAD,MAACA,GAAD,0BAACA,QAAQ,CAAEc,aAAX,2DAACG,uBAAyBF,OAA1B,EAAmC1B,MAAnC,CAnBcJ,CAAhB;AAsBA;AACF;AACA;AACA;;AACEA,OAAK,CAACiC,SAANjC,CAAgB,YAAM;AACpBuB,WAAO,CAAC,IAAD,CAAPA;AADF,KAEG,CAACA,OAAD,CAFHvB;AAIAE,wBAAsB,CAACa,QAAD,EAAW,UAAX,EAAuBQ,OAAvB,EAAgCZ,YAAhC,CAAtBT;AACAA,wBAAsB,CAACa,QAAD,EAAW,SAAX,EAAsBQ,OAAtB,EAA+BZ,YAA/B,CAAtBT;AAEA,SAAO;AAAEe,YAAQ,EAARA,QAAF;AAAYE,aAAS,EAATA;AAAZ,GAAP;AACD","names":["React","useDOM","useGlobalEventListener","getPreciseKeyboardState","window","innerHeight","availHeight","screen","coveredViewportPercentage","Math","round","eventOptions","passive","capture","useKeyboard","document","useState","isOpened","setIsOpened","isPrecise","setIsPrecise","transitionalTimeout","useRef","onFocus","useCallback","event","current","clearTimeout","type","activeElement","tagName","setTimeout","_document$activeEleme3","useEffect"],"sources":["../../src/hooks/useKeyboard.ts"],"sourcesContent":["import * as React from \"react\";\nimport { useDOM } from \"../lib/dom\";\nimport { useGlobalEventListener } from \"./useGlobalEventListener\";\n\ninterface SoftwareKeyboardState {\n  isOpened: boolean;\n  isPrecise: boolean;\n}\n\n/**\n Проверяет, закрыла ли клавиатура часть экрана, 24% подошло к большиству устройств\n Работает на iOS и Android, где софт-клавиатура ресайзит viewport в браузерах\n */\nexport function getPreciseKeyboardState(window: any): boolean {\n  const {\n    innerHeight,\n    screen: { availHeight },\n  } = window;\n\n  const coveredViewportPercentage = Math.round(\n    (1 - innerHeight / availHeight) * 100\n  );\n  return coveredViewportPercentage > 24;\n}\n\nconst eventOptions = {\n  passive: true,\n  capture: false,\n};\n\nexport function useKeyboard(): SoftwareKeyboardState {\n  const { window, document } = useDOM();\n\n  const [isOpened, setIsOpened] = React.useState(false);\n  const [isPrecise, setIsPrecise] = React.useState(false);\n\n  const transitionalTimeout = React.useRef<ReturnType<\n    typeof setTimeout\n  > | null>(null);\n\n  const onFocus = React.useCallback(\n    (event: FocusEvent | true) => {\n      if (transitionalTimeout.current) {\n        clearTimeout(transitionalTimeout.current);\n      }\n\n      const isOpened =\n        (event === true || event.type === \"focusin\") &&\n        (document?.activeElement?.tagName === \"INPUT\" ||\n          document?.activeElement?.tagName === \"TEXTAREA\");\n      setIsOpened(isOpened);\n      setIsPrecise(false);\n\n      // Ожидаем прохождение анимации раскрытия клавиатуры\n      transitionalTimeout.current = setTimeout(() => {\n        setIsOpened(isOpened);\n        setIsPrecise(getPreciseKeyboardState(window));\n      }, 300);\n    },\n    [document?.activeElement?.tagName, window]\n  );\n\n  /**\n   У полей с autoFocus не отлавливаются события focus, для этого вызываем вручную,\n   чтобы иметь хоть какое-то понимание происходящего.\n   */\n  React.useEffect(() => {\n    onFocus(true);\n  }, [onFocus]);\n\n  useGlobalEventListener(document, \"focusout\", onFocus, eventOptions);\n  useGlobalEventListener(document, \"focusin\", onFocus, eventOptions);\n\n  return { isOpened, isPrecise };\n}\n"]},"metadata":{},"sourceType":"module"}