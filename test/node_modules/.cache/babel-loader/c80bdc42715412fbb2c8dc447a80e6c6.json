{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _createSuper from \"@babel/runtime/helpers/createSuper\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport * as React from \"react\";\nimport { withDOM } from \"../../lib/dom\";\nimport { multiRef, setRef } from \"../../lib/utils\";\n\nvar CustomScrollView = /*#__PURE__*/function (_React$Component) {\n  _inherits(CustomScrollView, _React$Component);\n\n  var _super = _createSuper(CustomScrollView);\n\n  function CustomScrollView() {\n    var _this;\n\n    _classCallCheck(this, CustomScrollView);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"ratio\", NaN);\n\n    _defineProperty(_assertThisInitialized(_this), \"lastTrackerTop\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"clientHeight\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"trackerHeight\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"scrollHeight\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"transformProp\", \"\");\n\n    _defineProperty(_assertThisInitialized(_this), \"startY\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"trackerTop\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"box\", multiRef(function (e) {\n      return setRef(e, _this.props.boxRef);\n    }));\n\n    _defineProperty(_assertThisInitialized(_this), \"barY\", /*#__PURE__*/React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"trackerY\", /*#__PURE__*/React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"resize\", function () {\n      if (!_this.box.current || !_this.barY.current || !_this.trackerY.current) {\n        return;\n      }\n\n      var clientHeight = _this.box.current.clientHeight;\n      var scrollHeight = _this.box.current.scrollHeight;\n      var ratio = clientHeight / scrollHeight;\n      var trackerHeight = Math.max(clientHeight * ratio, 40);\n      _this.ratio = ratio;\n      _this.clientHeight = clientHeight;\n      _this.scrollHeight = scrollHeight;\n      _this.trackerHeight = trackerHeight;\n\n      if (ratio >= 1) {\n        _this.barY.current.style.display = \"none\";\n      } else {\n        _this.barY.current.style.display = \"\";\n        _this.trackerY.current.style.height = \"\".concat(trackerHeight, \"px\");\n\n        _this.setTrackerPositionFromScroll(_this.box.current.scrollTop);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"scroll\", function () {\n      if (_this.ratio >= 1 || !_this.box.current) {\n        return;\n      }\n\n      _this.setTrackerPositionFromScroll(_this.box.current.scrollTop);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onDragStart\", function (e) {\n      e.preventDefault();\n      _this.startY = e.clientY;\n      _this.trackerTop = _this.lastTrackerTop;\n\n      _this.props.document.addEventListener(\"mousemove\", _this.onMove);\n\n      _this.props.document.addEventListener(\"mouseup\", _this.onUp);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onMove\", function (e) {\n      e.preventDefault();\n      var diff = e.clientY - _this.startY;\n      var position = Math.min(Math.max(_this.trackerTop + diff, 0), _this.clientHeight - _this.trackerHeight);\n\n      _this.setScrollPositionFromTracker(position);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onUp\", function (e) {\n      e.preventDefault();\n\n      _this.props.document.removeEventListener(\"mousemove\", _this.onMove);\n\n      _this.props.document.removeEventListener(\"mouseup\", _this.onUp);\n    });\n\n    return _this;\n  }\n\n  _createClass(CustomScrollView, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.chooseTransformProp();\n      this.resize();\n\n      if (this.props.windowResize) {\n        this.props.window.addEventListener(\"resize\", this.resize);\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      this.resize();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.props.window.removeEventListener(\"resize\", this.resize);\n    }\n  }, {\n    key: \"chooseTransformProp\",\n    value: function chooseTransformProp() {\n      var _this$trackerY$curren;\n\n      var style = (_this$trackerY$curren = this.trackerY.current) === null || _this$trackerY$curren === void 0 ? void 0 : _this$trackerY$curren.style;\n      var prop = \"\";\n\n      if (style !== undefined) {\n        if (\"transform\" in style) {\n          prop = \"transform\";\n        } else if (\"webkitTransform\" in style) {\n          prop = \"webkitTransform\";\n        }\n      }\n\n      this.transformProp = prop;\n    }\n  }, {\n    key: \"setTrackerPosition\",\n    value: function setTrackerPosition(scrollTop) {\n      this.lastTrackerTop = scrollTop;\n\n      if (this.trackerY.current !== null) {\n        this.trackerY.current.style[this.transformProp] = \"translate(0, \".concat(scrollTop, \"px)\");\n      }\n    }\n  }, {\n    key: \"setTrackerPositionFromScroll\",\n    value: function setTrackerPositionFromScroll(scrollTop) {\n      var progress = scrollTop / (this.scrollHeight - this.clientHeight);\n      this.setTrackerPosition((this.clientHeight - this.trackerHeight) * progress);\n    }\n  }, {\n    key: \"setScrollPositionFromTracker\",\n    value: function setScrollPositionFromTracker(trackerTop) {\n      var progress = trackerTop / (this.clientHeight - this.trackerHeight);\n\n      if (this.box.current !== null) {\n        this.box.current.scrollTop = (this.scrollHeight - this.clientHeight) * progress;\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          children = _this$props.children,\n          className = _this$props.className;\n      return createScopedElement(\"div\", {\n        vkuiClass: \"CustomScrollView\",\n        className: className\n      }, createScopedElement(\"div\", {\n        vkuiClass: \"CustomScrollView__barY\",\n        ref: this.barY\n      }, createScopedElement(\"div\", {\n        vkuiClass: \"CustomScrollView__trackerY\",\n        ref: this.trackerY,\n        onMouseDown: this.onDragStart\n      })), createScopedElement(\"div\", {\n        vkuiClass: \"CustomScrollView__box\",\n        tabIndex: -1,\n        ref: this.box,\n        onScroll: this.scroll\n      }, children));\n    }\n  }]);\n\n  return CustomScrollView;\n}(React.Component); // eslint-disable-next-line import/no-default-export\n\n\nexport default withDOM(CustomScrollView);","map":{"version":3,"mappings":"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","names":["React","withDOM","multiRef","setRef","CustomScrollView","NaN","e","_this","props","boxRef","createRef","box","current","barY","trackerY","clientHeight","scrollHeight","ratio","trackerHeight","Math","max","style","display","height","setTrackerPositionFromScroll","scrollTop","preventDefault","startY","clientY","trackerTop","lastTrackerTop","document","addEventListener","onMove","onUp","diff","position","min","setScrollPositionFromTracker","removeEventListener","chooseTransformProp","resize","windowResize","window","_this$trackerY$curren","prop","undefined","transformProp","progress","setTrackerPosition","children","className","createScopedElement","vkuiClass","ref","onMouseDown","onDragStart","tabIndex","onScroll","scroll","Component"],"sources":["../../../src/components/CustomScrollView/CustomScrollView.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { DOMProps, withDOM } from \"../../lib/dom\";\nimport { multiRef, setRef } from \"../../lib/utils\";\nimport \"./CustomScrollView.css\";\n\ninterface Props extends DOMProps {\n  windowResize?: boolean;\n  boxRef?: React.Ref<HTMLDivElement>;\n  className?: HTMLDivElement[\"className\"];\n}\n\nclass CustomScrollView extends React.Component<Props> {\n  private ratio = NaN;\n  private lastTrackerTop = 0;\n  private clientHeight = 0;\n  private trackerHeight = 0;\n  private scrollHeight = 0;\n  private transformProp = \"\";\n\n  private startY = 0;\n  private trackerTop = 0;\n\n  private readonly box = multiRef<HTMLDivElement>((e) =>\n    setRef(e, this.props.boxRef)\n  );\n  private readonly barY = React.createRef<HTMLDivElement>();\n  private readonly trackerY = React.createRef<HTMLDivElement>();\n\n  componentDidMount() {\n    this.chooseTransformProp();\n\n    this.resize();\n\n    if (this.props.windowResize) {\n      this.props.window!.addEventListener(\"resize\", this.resize);\n    }\n  }\n\n  componentDidUpdate() {\n    this.resize();\n  }\n\n  componentWillUnmount() {\n    this.props.window!.removeEventListener(\"resize\", this.resize);\n  }\n\n  chooseTransformProp() {\n    let style = this.trackerY.current?.style;\n    let prop = \"\";\n    if (style !== undefined) {\n      if (\"transform\" in style) {\n        prop = \"transform\";\n      } else if (\"webkitTransform\" in style) {\n        prop = \"webkitTransform\";\n      }\n    }\n    this.transformProp = prop;\n  }\n\n  resize = () => {\n    if (!this.box.current || !this.barY.current || !this.trackerY.current) {\n      return;\n    }\n    const clientHeight = this.box.current.clientHeight;\n    const scrollHeight = this.box.current.scrollHeight;\n    let ratio = clientHeight / scrollHeight;\n    let trackerHeight = Math.max(clientHeight * ratio, 40);\n\n    this.ratio = ratio;\n    this.clientHeight = clientHeight;\n    this.scrollHeight = scrollHeight;\n    this.trackerHeight = trackerHeight;\n\n    if (ratio >= 1) {\n      this.barY.current.style.display = \"none\";\n    } else {\n      this.barY.current.style.display = \"\";\n      this.trackerY.current.style.height = `${trackerHeight}px`;\n      this.setTrackerPositionFromScroll(this.box.current.scrollTop);\n    }\n  };\n\n  scroll = () => {\n    if (this.ratio >= 1 || !this.box.current) {\n      return;\n    }\n\n    this.setTrackerPositionFromScroll(this.box.current.scrollTop);\n  };\n\n  setTrackerPosition(scrollTop: number) {\n    this.lastTrackerTop = scrollTop;\n    if (this.trackerY.current !== null) {\n      (this.trackerY.current.style as any)[\n        this.transformProp\n      ] = `translate(0, ${scrollTop}px)`;\n    }\n  }\n\n  setTrackerPositionFromScroll(scrollTop: number) {\n    const progress = scrollTop / (this.scrollHeight - this.clientHeight);\n    this.setTrackerPosition(\n      (this.clientHeight - this.trackerHeight) * progress\n    );\n  }\n\n  setScrollPositionFromTracker(trackerTop: number) {\n    const progress = trackerTop / (this.clientHeight - this.trackerHeight);\n    if (this.box.current !== null) {\n      this.box.current.scrollTop =\n        (this.scrollHeight - this.clientHeight) * progress;\n    }\n  }\n\n  onDragStart = (e: React.MouseEvent) => {\n    e.preventDefault();\n    this.startY = e.clientY;\n    this.trackerTop = this.lastTrackerTop;\n\n    this.props.document!.addEventListener(\"mousemove\", this.onMove);\n    this.props.document!.addEventListener(\"mouseup\", this.onUp);\n  };\n\n  onMove = (e: MouseEvent) => {\n    e.preventDefault();\n    const diff = e.clientY - this.startY;\n    const position = Math.min(\n      Math.max(this.trackerTop + diff, 0),\n      this.clientHeight - this.trackerHeight\n    );\n\n    this.setScrollPositionFromTracker(position);\n  };\n\n  onUp = (e: MouseEvent) => {\n    e.preventDefault();\n    this.props.document!.removeEventListener(\"mousemove\", this.onMove);\n    this.props.document!.removeEventListener(\"mouseup\", this.onUp);\n  };\n\n  render() {\n    const { children, className } = this.props;\n\n    return (\n      <div vkuiClass=\"CustomScrollView\" className={className}>\n        <div vkuiClass=\"CustomScrollView__barY\" ref={this.barY}>\n          <div\n            vkuiClass=\"CustomScrollView__trackerY\"\n            ref={this.trackerY}\n            onMouseDown={this.onDragStart}\n          />\n        </div>\n\n        <div\n          vkuiClass=\"CustomScrollView__box\"\n          tabIndex={-1}\n          ref={this.box}\n          onScroll={this.scroll}\n        >\n          {children}\n        </div>\n      </div>\n    );\n  }\n}\n\n// eslint-disable-next-line import/no-default-export\nexport default withDOM(CustomScrollView);\n"]},"metadata":{},"sourceType":"module"}