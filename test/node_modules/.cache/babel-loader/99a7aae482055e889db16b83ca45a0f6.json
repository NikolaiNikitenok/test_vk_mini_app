{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nvar CustomStorage = /*#__PURE__*/function () {\n  function CustomStorage() {\n    var _this = this;\n\n    _classCallCheck(this, CustomStorage);\n\n    _defineProperty(this, \"data\", {});\n\n    _defineProperty(this, \"getItem\", function (key) {\n      return _this.data.hasOwnProperty(key) ? _this.data[key] : null;\n    });\n\n    _defineProperty(this, \"keys\", function () {\n      return Object.keys(_this.data);\n    });\n  }\n\n  _createClass(CustomStorage, [{\n    key: \"setItem\",\n    value: function setItem(key, val) {\n      this.data[key] = String(val);\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(id) {\n      delete this.data[id];\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.data = {};\n    }\n  }, {\n    key: \"key\",\n    value: function key(index) {\n      return Object.keys(this.data)[index];\n    }\n  }, {\n    key: \"length\",\n    get: function get() {\n      return Object.keys(this.data).length;\n    }\n  }]);\n\n  return CustomStorage;\n}();\n\nvar dummyKey = 'vk-ls-dummy';\nvar dummyContent = 'test';\nvar ls;\n\nfunction getLocalStorage() {\n  if (ls) {\n    return ls;\n  }\n\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.localStorage.setItem(dummyKey, dummyContent);\n\n    if (dummyContent !== window.localStorage.getItem(dummyKey)) {\n      throw new Error('localStorage is broken');\n    }\n\n    window.localStorage.removeItem(dummyKey);\n    ls = window.localStorage;\n  } catch (e) {\n    ls = new CustomStorage();\n  }\n\n  return ls;\n}\n/**\n * Обертка над localStorage для кода, который может использоваться на других сайтах\n * Firefox блокирует доступ к localStorage для скриптов с других доменов\n */\n\n\nexport var localStorage = {\n  setItem: function setItem(key, val) {\n    return getLocalStorage().setItem(key, val);\n  },\n  getItem: function getItem(key) {\n    return getLocalStorage().getItem(key);\n  },\n  removeItem: function removeItem(key) {\n    return getLocalStorage().removeItem(key);\n  },\n  clear: function clear() {\n    return getLocalStorage().clear();\n  },\n  length: function length() {\n    return getLocalStorage().length;\n  },\n  key: function key(index) {\n    return getLocalStorage().key(index);\n  },\n  keys: function keys() {\n    var storage = getLocalStorage();\n\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: function getPrefixedKeys(prefix) {\n    return localStorage.keys().filter(function (key) {\n      return key.startsWith(prefix);\n    });\n  }\n};\nvar sessionStorageCache;\n\nfunction getSessionStorage() {\n  if (sessionStorageCache) {\n    return sessionStorageCache;\n  }\n\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.sessionStorage.setItem(dummyKey, dummyContent);\n\n    if (dummyContent !== window.sessionStorage.getItem(dummyKey)) {\n      throw new Error('sessionStorage is broken');\n    }\n\n    window.sessionStorage.removeItem(dummyKey);\n    sessionStorageCache = window.sessionStorage;\n  } catch (e) {\n    sessionStorageCache = new CustomStorage();\n  }\n\n  return sessionStorageCache;\n}\n\nexport var sessionStorage = {\n  setItem: function setItem(key, val) {\n    return getSessionStorage().setItem(key, val);\n  },\n  getItem: function getItem(key) {\n    return getSessionStorage().getItem(key);\n  },\n  removeItem: function removeItem(key) {\n    return getSessionStorage().removeItem(key);\n  },\n  clear: function clear() {\n    return getSessionStorage().clear();\n  },\n  length: function length() {\n    return getSessionStorage().length;\n  },\n  key: function key(index) {\n    return getSessionStorage().key(index);\n  },\n  keys: function keys() {\n    var storage = getSessionStorage();\n\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: function getPrefixedKeys(prefix) {\n    return sessionStorage.keys().filter(function (key) {\n      return key.startsWith(prefix);\n    });\n  }\n};","map":{"version":3,"mappings":";;;;IAEMA,a;;;;;;kCAC+B;;qCAMlB,UAACC,GAAD;AAAA,aAAiBC,KAAI,CAACC,IAAL,CAAUC,cAAV,CAAyBH,GAAzB,IAAgCC,KAAI,CAACC,IAAL,CAAUF,GAAV,CAAhC,GAAiD,IAAlE;;;kCAkBH;AAAA,aAAgBI,MAAM,CAACC,IAAPD,CAAYH,KAAI,CAACC,IAAjBE,CAAhB;;;;;;4BAtBCJ,KAAaM,KAAa;AACvC,WAAKJ,IAAL,CAAUF,GAAV,IAAiBO,MAAM,CAACD,GAAD,CAAvB;AACD;;;+BAIiBE,IAAY;AAC5B,aAAO,KAAKN,IAAL,CAAUM,EAAV,CAAP;AACD;;;4BAEc;AACb,WAAKN,IAAL,GAAY,EAAZ;AACD;;;wBAMUO,OAA8B;AACvC,aAAOL,MAAM,CAACC,IAAPD,CAAY,KAAKF,IAAjBE,EAAuBK,KAAvBL,CAAP;AACD;;;wBANmB;AAClB,aAAOA,MAAM,CAACC,IAAPD,CAAY,KAAKF,IAAjBE,EAAuBM,MAA9B;AACD;;;;;;AASH,IAAMC,QAAQ,GAAG,aAAjB;AACA,IAAMC,YAAY,GAAG,MAArB;AAEA,IAAIC,EAAJ;;AAEA,SAASC,eAAT,GAA2B;AACzB,MAAID,EAAJ,EAAQ;AACN,WAAOA,EAAP;AACD;;AACD,MAAI;AACF;AACAE,UAAM,CAACC,YAAPD,CAAoBE,OAApBF,CAA4BJ,QAA5BI,EAAsCH,YAAtCG;;AACA,QAAIH,YAAY,KAAKG,MAAM,CAACC,YAAPD,CAAoBG,OAApBH,CAA4BJ,QAA5BI,CAArB,EAA4D;AAC1D,YAAM,IAAII,KAAJ,CAAU,wBAAV,CAAN;AACD;;AACDJ,UAAM,CAACC,YAAPD,CAAoBK,UAApBL,CAA+BJ,QAA/BI;AACAF,MAAE,GAAGE,MAAM,CAACC,YAAZH;AAPF,IAQE,OAAOQ,CAAP,EAAU;AACVR,MAAE,GAAG,IAAId,aAAJ,EAALc;AACD;;AACD,SAAOA,EAAP;AACD;AAED;;;;;;AAIA,OAAO,IAAMG,YAAY,GAAG;AAC1BC,SAAO,EAAE,iBAACjB,GAAD,EAAcM,GAAd;AAAA,WAA8BQ,eAAe,GAAGG,OAAlBH,CAA0Bd,GAA1Bc,EAA+BR,GAA/BQ,CAA9B;AADiB;AAE1BI,SAAO,EAAE,iBAAClB,GAAD;AAAA,WAAiBc,eAAe,GAAGI,OAAlBJ,CAA0Bd,GAA1Bc,CAAjB;AAFiB;AAG1BM,YAAU,EAAE,oBAACpB,GAAD;AAAA,WAAiBc,eAAe,GAAGM,UAAlBN,CAA6Bd,GAA7Bc,CAAjB;AAHc;AAI1BQ,OAAK,EAAE;AAAA,WAAMR,eAAe,GAAGQ,KAAlBR,EAAN;AAJmB;AAK1BJ,QAAM,EAAE;AAAA,WAAMI,eAAe,GAAGJ,MAAxB;AALkB;AAM1BV,KAAG,EAAE,aAACS,KAAD;AAAA,WAAmBK,eAAe,GAAGd,GAAlBc,CAAsBL,KAAtBK,CAAnB;AANqB;AAO1BT,MAP0B,kBAOT;AACf,QAAMkB,OAAO,GAAGT,eAAe,EAA/B;;AACA,QAAIS,OAAO,YAAYxB,aAAvB,EAAsC;AACpC,aAAOwB,OAAO,CAAClB,IAARkB,EAAP;AADF,WAEO;AACL,aAAOnB,MAAM,CAACC,IAAPD,CAAYmB,OAAZnB,CAAP;AACD;AAbuB;AAe1BoB,iBAAe,EAAE,yBAACC,MAAD;AAAA,WAA8BT,YAAY,CAACX,IAAbW,GAAoBU,MAApBV,CAA2B,UAAChB,GAAD;AAAA,aAASA,GAAG,CAAC2B,UAAJ3B,CAAeyB,MAAfzB,CAAT;AAA3B,MAA9B;AAAA;AAfS,CAArB;AAkBP,IAAI4B,mBAAJ;;AAEA,SAASC,iBAAT,GAA6B;AAC3B,MAAID,mBAAJ,EAAyB;AACvB,WAAOA,mBAAP;AACD;;AACD,MAAI;AACF;AACAb,UAAM,CAACe,cAAPf,CAAsBE,OAAtBF,CAA8BJ,QAA9BI,EAAwCH,YAAxCG;;AACA,QAAIH,YAAY,KAAKG,MAAM,CAACe,cAAPf,CAAsBG,OAAtBH,CAA8BJ,QAA9BI,CAArB,EAA8D;AAC5D,YAAM,IAAII,KAAJ,CAAU,0BAAV,CAAN;AACD;;AACDJ,UAAM,CAACe,cAAPf,CAAsBK,UAAtBL,CAAiCJ,QAAjCI;AACAa,uBAAmB,GAAGb,MAAM,CAACe,cAA7BF;AAPF,IAQE,OAAOP,CAAP,EAAU;AACVO,uBAAmB,GAAG,IAAI7B,aAAJ,EAAtB6B;AACD;;AACD,SAAOA,mBAAP;AACD;;AAED,OAAO,IAAME,cAAc,GAAG;AAC5Bb,SAAO,EAAE,iBAACjB,GAAD,EAAcM,GAAd;AAAA,WAA8BuB,iBAAiB,GAAGZ,OAApBY,CAA4B7B,GAA5B6B,EAAiCvB,GAAjCuB,CAA9B;AADmB;AAE5BX,SAAO,EAAE,iBAAClB,GAAD;AAAA,WAAiB6B,iBAAiB,GAAGX,OAApBW,CAA4B7B,GAA5B6B,CAAjB;AAFmB;AAG5BT,YAAU,EAAE,oBAACpB,GAAD;AAAA,WAAiB6B,iBAAiB,GAAGT,UAApBS,CAA+B7B,GAA/B6B,CAAjB;AAHgB;AAI5BP,OAAK,EAAE;AAAA,WAAMO,iBAAiB,GAAGP,KAApBO,EAAN;AAJqB;AAK5BnB,QAAM,EAAE;AAAA,WAAMmB,iBAAiB,GAAGnB,MAA1B;AALoB;AAM5BV,KAAG,EAAE,aAACS,KAAD;AAAA,WAAmBoB,iBAAiB,GAAG7B,GAApB6B,CAAwBpB,KAAxBoB,CAAnB;AANuB;AAO5BxB,MAP4B,kBAOX;AACf,QAAMkB,OAAO,GAAGM,iBAAiB,EAAjC;;AACA,QAAIN,OAAO,YAAYxB,aAAvB,EAAsC;AACpC,aAAOwB,OAAO,CAAClB,IAARkB,EAAP;AADF,WAEO;AACL,aAAOnB,MAAM,CAACC,IAAPD,CAAYmB,OAAZnB,CAAP;AACD;AAbyB;AAe5BoB,iBAAe,EAAE,yBAACC,MAAD;AAAA,WAA8BK,cAAc,CAACzB,IAAfyB,GAAsBJ,MAAtBI,CAA6B,UAAC9B,GAAD;AAAA,aAASA,GAAG,CAAC2B,UAAJ3B,CAAeyB,MAAfzB,CAAT;AAA7B,MAA9B;AAAA;AAfW,CAAvB","names":["CustomStorage","key","_this","data","hasOwnProperty","Object","keys","val","String","id","index","length","dummyKey","dummyContent","ls","getLocalStorage","window","localStorage","setItem","getItem","Error","removeItem","e","clear","storage","getPrefixedKeys","prefix","filter","startsWith","sessionStorageCache","getSessionStorage","sessionStorage"],"sources":["../../src/storage.ts"],"sourcesContent":["import { Dictionary } from './types';\n\nclass CustomStorage {\n  private data: Dictionary<string> = {};\n\n  public setItem(key: string, val: string) {\n    this.data[key] = String(val);\n  };\n\n  public getItem = (key: string) => this.data.hasOwnProperty(key) ? this.data[key] : null;\n\n  public removeItem(id: string) {\n    delete this.data[id];\n  };\n\n  public clear() {\n    this.data = {};\n  }\n\n  public get length() {\n    return Object.keys(this.data).length;\n  };\n\n  public key(index: number): string | null {\n    return Object.keys(this.data)[index];\n  }\n\n  public keys = (): string[] => Object.keys(this.data);\n}\n\nconst dummyKey = 'vk-ls-dummy';\nconst dummyContent = 'test';\n\nlet ls: CustomStorage | Storage;\n\nfunction getLocalStorage() {\n  if (ls) {\n    return ls;\n  }\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.localStorage.setItem(dummyKey, dummyContent);\n    if (dummyContent !== window.localStorage.getItem(dummyKey)) {\n      throw new Error('localStorage is broken');\n    }\n    window.localStorage.removeItem(dummyKey);\n    ls = window.localStorage;\n  } catch (e) {\n    ls = new CustomStorage();\n  }\n  return ls;\n}\n\n/**\n * Обертка над localStorage для кода, который может использоваться на других сайтах\n * Firefox блокирует доступ к localStorage для скриптов с других доменов\n */\nexport const localStorage = {\n  setItem: (key: string, val: string) => getLocalStorage().setItem(key, val),\n  getItem: (key: string) => getLocalStorage().getItem(key),\n  removeItem: (key: string) => getLocalStorage().removeItem(key),\n  clear: () => getLocalStorage().clear(),\n  length: () => getLocalStorage().length,\n  key: (index: number) => getLocalStorage().key(index),\n  keys(): string[] {\n    const storage = getLocalStorage();\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: (prefix: string): string[] => localStorage.keys().filter((key) => key.startsWith(prefix)),\n};\n\nlet sessionStorageCache: CustomStorage | Storage;\n\nfunction getSessionStorage() {\n  if (sessionStorageCache) {\n    return sessionStorageCache;\n  }\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.sessionStorage.setItem(dummyKey, dummyContent);\n    if (dummyContent !== window.sessionStorage.getItem(dummyKey)) {\n      throw new Error('sessionStorage is broken');\n    }\n    window.sessionStorage.removeItem(dummyKey);\n    sessionStorageCache = window.sessionStorage;\n  } catch (e) {\n    sessionStorageCache = new CustomStorage();\n  }\n  return sessionStorageCache;\n}\n\nexport const sessionStorage = {\n  setItem: (key: string, val: string) => getSessionStorage().setItem(key, val),\n  getItem: (key: string) => getSessionStorage().getItem(key),\n  removeItem: (key: string) => getSessionStorage().removeItem(key),\n  clear: () => getSessionStorage().clear(),\n  length: () => getSessionStorage().length,\n  key: (index: number) => getSessionStorage().key(index),\n  keys(): string[] {\n    const storage = getSessionStorage();\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: (prefix: string): string[] => sessionStorage.keys().filter((key) => key.startsWith(prefix)),\n};\n"]},"metadata":{},"sourceType":"module"}